<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–Ω—å 1: –£–≥–æ–ª—å–Ω–∞—è –î–µ—Ä–µ–≤–Ω—è | –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –ù–∏–∫–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        body {
            background: #0a0a1a url('img/Fon day1 les.png') center/cover no-repeat fixed;
            color: #e0f0ff;
            font-family: 'Press Start 2P', monospace;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* ===== –ö–û–ù–¢–†–û–õ–õ–ï–† –ê–£–î–ò–û ===== */
        .audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(32, 46, 64, 0.9);
            border: 2px solid #4a6fa5;
            border-radius: 25px;
            padding: 10px 15px;
            z-index: 1001;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(74, 111, 165, 0.5);
            transition: all 0.3s ease;
        }

        .audio-controls:hover {
            background: rgba(32, 46, 64, 0.95);
            box-shadow: 0 0 25px rgba(74, 111, 165, 0.7);
        }

        #toggleMusicBtn {
            background: linear-gradient(145deg, #4a6fa5, #2d4460);
            color: #bbdefb;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #2d4460;
        }

        #toggleMusicBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #2d4460;
        }

        #toggleMusicBtn:active {
            transform: translateY(1px);
            box-shadow: 0 3px 0 #2d4460;
        }

        #volumeSlider {
            width: 100px;
            height: 6px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #2d4460, #4a6fa5);
            border-radius: 3px;
            outline: none;
        }

        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #bbdefb;
            border-radius: 50%;
            border: 2px solid #4a6fa5;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        #volumeSlider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #bbdefb;
            border-radius: 50%;
            border: 2px solid #4a6fa5;
            cursor: pointer;
        }

        #volumeValue {
            color: #bbdefb;
            font-size: 12px;
            min-width: 35px;
            text-align: center;
        }
        
        /* ===== –≠–ö–†–ê–ù-–ó–ê–°–¢–ê–í–ö–ê ===== */
        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('Fon day1 les.png') center/cover no-repeat;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: introAppear 1s ease-out;
            overflow: hidden;
        }
        
        .intro-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(74, 111, 165, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(44, 62, 80, 0.3) 0%, transparent 50%),
                linear-gradient(to bottom, rgba(10, 10, 26, 0.9), rgba(10, 26, 42, 0.8));
            z-index: -1;
        }
        
        .intro-content {
            text-align: center;
            max-width: 800px;
            padding: 40px;
            animation: contentAppear 1.5s ease-out 0.5s both;
            position: relative;
            background: rgba(32, 46, 64, 0.7);
            border: 3px solid #4a6fa5;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(74, 111, 165, 0.5);
        }
        
        .intro-title {
            color: #FFD700;
            font-size: 48px;
            margin-bottom: 30px;
            text-shadow: 
                3px 3px 0 #2d4460,
                6px 6px 0 rgba(0, 0, 0, 0.8);
            letter-spacing: 3px;
            animation: titleGlow 3s infinite alternate;
        }
        
        .intro-subtitle {
            color: #4fc3f7;
            font-size: 28px;
            margin-bottom: 50px;
            text-shadow: 2px 2px 0 #2d4460;
            line-height: 1.6;
            animation: subtitleFloat 4s infinite alternate;
        }
        
        .intro-text {
            color: #bbdefb;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 60px;
            text-shadow: 1px 1px 0 #2d4460;
            background: rgba(32, 46, 64, 0.5);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #4a6fa5;
            box-shadow: 0 0 40px rgba(74, 111, 165, 0.3);
            animation: textPulse 5s infinite alternate;
        }
        
        .intro-button {
            background: linear-gradient(145deg, #4a6fa5, #2d4460);
            color: #bbdefb;
            border: none;
            padding: 25px 50px;
            font-family: 'Press Start 2P', monospace;
            font-size: 18px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s;
            text-shadow: 2px 2px 0 #2d4460;
            letter-spacing: 2px;
            box-shadow: 
                0 12px 0 #2d4460,
                0 0 30px rgba(74, 111, 165, 0.5);
            position: relative;
            overflow: hidden;
            animation: buttonPulse 2s infinite alternate;
        }
        
        .intro-button:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 20px 0 #2d4460,
                0 0 50px rgba(74, 111, 165, 0.8);
            background: linear-gradient(145deg, #5d7fb5, #4a6fa5);
        }
        
        .intro-button:active {
            transform: translateY(4px);
            box-shadow: 
                0 8px 0 #2d4460,
                0 0 30px rgba(74, 111, 165, 0.5);
        }
        
        .intro-button::after {
            content: '‚ñ∂';
            margin-left: 15px;
            font-size: 20px;
        }
        
        /* –ü–∞—Ä—è—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã */
        .coal-particle {
            position: absolute;
            background: #2d4460;
            border-radius: 50%;
            pointer-events: none;
            animation: coalFloat linear infinite;
        }
        
        /* ===== –≠–ö–†–ê–ù –í–ò–ó–£–ê–õ–¨–ù–û–ô –ù–û–í–ï–õ–õ–´ ===== */
        .visual-novel-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 900;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.8s ease-out;
        }
        
        .novel-scene {
            width: 90%;
            max-width: 1000px;
            height: 85vh;
            background: #000;
            border: 12px solid #4a6fa5;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 80px rgba(74, 111, 165, 0.8);
            animation: scaleIn 0.7s ease-out;
        }
        
        .scene-video {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center center;
            z-index: 1;
        }
        
        /* ===== –û–ö–ù–û –î–ò–ê–õ–û–ì–ê –° –ê–ù–ò–ú–ê–¶–ò–ï–ô –ü–ï–ß–ê–¢–ê–Æ–©–ï–ì–û–°–Ø –¢–ï–ö–°–¢–ê ===== */
        .dialogue-window {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(32, 46, 64, 0.95);
            border-top: 6px solid #4a6fa5;
            padding: 30px;
            transform: translateY(0);
            transition: transform 0.3s ease;
            backdrop-filter: blur(5px);
            z-index: 3;
        }
        
        .character-name {
            color: #4fc3f7;
            font-size: 20px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #2d4460;
            letter-spacing: 2px;
            border-bottom: 2px solid #4a6fa5;
            padding-bottom: 10px;
            display: inline-block;
        }
        
        /* ===== –ê–ù–ò–ú–ê–¶–ò–ò –ü–ï–ß–ê–¢–ê–Æ–©–ï–ì–û–°–Ø –¢–ï–ö–°–¢–ê ===== */
        .typewriter-container {
            min-height: 140px;
            position: relative;
        }

        .typewriter-text {
            color: #bbdefb;
            font-size: 18px;
            line-height: 1.8;
            text-shadow: 1px 1px 0 #2d4460;
            padding: 15px;
            background: rgba(26, 35, 47, 0.5);
            border-radius: 10px;
            border-left: 4px solid #4a6fa5;
            white-space: normal;
            word-wrap: break-word;
            overflow: hidden;
            min-height: 100%;
            width: 100%;
        }

        .typing-cursor {
            display: inline-block;
            width: 10px;
            height: 24px;
            background: #4fc3f7;
            margin-left: 4px;
            vertical-align: middle;
            animation: blinkCursor 0.7s infinite;
            position: relative;
            top: -2px;
        }

        .typewriter-word {
            display: inline;
            opacity: 0;
            animation: fadeInWord 0.3s forwards;
        }

        @keyframes fadeInWord {
            to {
                opacity: 1;
            }
        }

        .text-complete {
            position: relative;
        }

        .text-complete::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(79, 195, 247, 0.1),
                transparent
            );
            pointer-events: none;
            opacity: 0;
            animation: textShimmer 3s infinite;
        }

        @keyframes textShimmer {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.5; }
        }

        .text-emphasis {
            display: inline-block;
            color: #FFD700;
            animation: textVibrate 0.3s ease-in-out;
        }

        @keyframes textVibrate {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-1px); }
            75% { transform: translateX(1px); }
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è */
        .next-btn {
            position: absolute;
            bottom: 25px;
            right: 30px;
            background: linear-gradient(145deg, #4a6fa5, #2d4460);
            color: #bbdefb;
            border: none;
            padding: 12px 25px;
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 0 #2d4460;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 120px;
        }

        .next-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #2d4460;
            background: linear-gradient(145deg, #5d7fb5, #4a6fa5);
        }

        .next-btn:active {
            transform: translateY(1px);
            box-shadow: 0 4px 0 #2d4460;
        }

        .next-btn.waiting {
            animation: pulseBtn 1.5s infinite;
            background: linear-gradient(145deg, #4a6fa5, #2d4460);
        }

        @keyframes pulseBtn {
            0%, 100% { 
                transform: translateY(0);
                box-shadow: 0 6px 0 #2d4460;
            }
            50% { 
                transform: translateY(-3px);
                box-shadow: 0 9px 0 #2d4460;
            }
        }

        .btn-arrow {
            font-size: 16px;
            transition: transform 0.3s;
        }

        .next-btn:hover .btn-arrow {
            transform: translateX(3px);
        }
        
        /* ===== –û–°–ù–û–í–ù–û–ô –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ===== */
        .game-container {
            display: none;
            width: 100%;
            max-width: 1200px;
            position: relative;
            animation: fadeIn 0.5s ease-out;
        }
        
        .game-content {
            background: rgba(32, 46, 64, 0.9);
            border: 8px solid #4a6fa5;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 
                0 0 60px rgba(74, 111, 165, 0.6),
                inset 0 0 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 80vh;
            backdrop-filter: blur(5px);
        }
        
        /* RPG –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .rpg-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            padding-bottom: 25px;
            border-bottom: 4px solid #4a6fa5;
        }
        
        .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 15px;
        }
        
        .rpg-header h1 {
            color: #FFD700;
            font-size: 32px;
            text-shadow: 3px 3px 0 #2d4460;
            letter-spacing: 2px;
        }
        
        .header-icon {
            font-size: 40px;
            animation: pulse 2s infinite;
        }
        
        .subtitle {
            color: #4fc3f7;
            font-size: 14px;
            letter-spacing: 1.5px;
            opacity: 0.9;
        }
        
        /* RPG –∫–Ω–æ–ø–∫–∏ */
        .rpg-button {
            background: linear-gradient(145deg, #4a6fa5, #2d4460);
            color: #bbdefb;
            border: none;
            padding: 20px 45px;
            font-family: 'Press Start 2P', monospace;
            font-size: 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            text-shadow: 2px 2px 0 #2d4460;
            letter-spacing: 1.5px;
            box-shadow: 
                0 10px 0 #2d4460,
                0 0 20px rgba(74, 111, 165, 0.4);
            display: inline-block;
            margin: 30px;
            min-width: 280px;
            overflow: hidden;
        }
        
        .rpg-button:hover {
            transform: translateY(-6px);
            box-shadow: 
                0 16px 0 #2d4460,
                0 0 35px rgba(74, 111, 165, 0.6);
            background: linear-gradient(145deg, #5d7fb5, #4a6fa5);
        }
        
        .rpg-button:active {
            transform: translateY(2px);
            box-shadow: 
                0 6px 0 #2d4460,
                0 0 15px rgba(74, 111, 165, 0.4);
        }
        
        /* –î–∏–∞–ª–æ–≥ NPC */
        .npc-dialogue {
            background: rgba(26, 35, 47, 0.8);
            border: 4px solid #4a6fa5;
            border-radius: 15px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.4),
                0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .dialogue-text {
            font-size: 18px;
            line-height: 1.8;
            color: #bbdefb;
            text-shadow: 1px 1px 0 #2d4460;
        }
        
        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 40px 0;
            background: rgba(32, 46, 64, 0.8);
            border: 4px solid #4a6fa5;
            border-radius: 15px;
            padding: 25px;
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(26, 35, 47, 0.6);
            border-radius: 10px;
            border: 2px solid #2d4460;
            transition: all 0.3s;
        }
        
        .status-item:hover {
            transform: translateY(-5px);
            border-color: #4fc3f7;
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
        }
        
        .status-label {
            color: #90a4ae;
            font-size: 12px;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .status-value {
            color: #bbdefb;
            font-size: 24px;
            text-shadow: 2px 2px 0 #2d4460;
        }
        
        /* –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ */
        .search-field-container {
            background: rgba(200, 230, 255, 0.15);
            border: 6px solid #4a6fa5;
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            position: relative;
            overflow: hidden;
            min-height: 400px;
            backdrop-filter: blur(3px);
        }
        
        .search-field {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 25px;
            justify-items: center;
            align-items: center;
        }
        
        /* –°—É–≥—Ä–æ–±—ã */
        .snowdrift {
            background: linear-gradient(145deg, #ffffff, #e6f7ff, #ffffff);
            border-radius: 50% 50% 40% 40% / 60% 60% 40% 40%;
            width: 140px;
            height: 140px;
            cursor: pointer;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            box-shadow: 
                inset 0 -15px 20px rgba(200, 230, 255, 0.8),
                inset 0 15px 20px rgba(255, 255, 255, 0.9),
                0 12px 0 #90a4ae,
                0 0 25px rgba(200, 230, 255, 0.3);
            animation: snowdriftFloat 4s ease-in-out infinite alternate;
            overflow: hidden;
        }
        
        /* –û—á–∏—â–µ–Ω–Ω—ã–µ —Å—É–≥—Ä–æ–±—ã */
        .snowdrift.snow-cleared {
            background: linear-gradient(145deg, #cccccc, #aaaaaa, #cccccc);
            cursor: default;
            box-shadow: 
                inset 0 -15px 20px rgba(170, 170, 170, 0.8),
                inset 0 15px 20px rgba(204, 204, 204, 0.9),
                0 5px 0 #666666;
            animation: none;
        }
        
        /* –û–∫–Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .result-window {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(32, 46, 64, 0.98);
            border: 8px solid #4a6fa5;
            border-radius: 20px;
            padding: 50px;
            z-index: 1000;
            text-align: center;
            max-width: 800px;
            width: 90%;
            box-shadow: 
                0 0 80px rgba(74, 111, 165, 0.8),
                inset 0 0 40px rgba(0, 0, 0, 0.4);
            animation: popupAppear 0.5s ease-out;
            backdrop-filter: blur(10px);
        }
        
        .result-title {
            color: #FFD700;
            font-size: 36px;
            margin-bottom: 30px;
            text-shadow: 3px 3px 0 #2d4460;
            letter-spacing: 2px;
        }
        
        .result-text {
            color: #bbdefb;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 40px;
            text-shadow: 1px 1px 0 #2d4460;
            background: rgba(26, 35, 47, 0.5);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #4a6fa5;
        }
        
        .inventory-button {
            background: linear-gradient(145deg, #4CAF50, #2E7D32) !important;
            box-shadow: 
                0 10px 0 #2E7D32,
                0 0 20px rgba(76, 175, 80, 0.4) !important;
        }
        
        .inventory-button:hover {
            background: linear-gradient(145deg, #66BB6A, #388E3C) !important;
            box-shadow: 
                0 16px 0 #2E7D32,
                0 0 35px rgba(76, 175, 80, 0.6) !important;
        }
        
        /* ===== –°–¢–ò–õ–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò–ù–í–ï–ù–¢–ê–†–Ø ===== */
        .inventory-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #1a237e, #0d1930);
            border: 3px solid #4CAF50;
            border-radius: 10px;
            padding: 15px;
            z-index: 10000;
            display: none;
            animation: slideInNotification 0.5s ease-out;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-width: 350px;
            backdrop-filter: blur(10px);
            font-family: 'Press Start 2P', monospace;
        }

        .notification-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification-icon {
            font-size: 30px;
            text-align: center;
            animation: bounce 2s infinite;
        }

        .notification-text {
            text-align: center;
            color: white;
            line-height: 1.4;
        }

        .notification-text strong {
            color: #4CAF50;
            font-size: 12px;
            display: block;
            margin-bottom: 5px;
        }

        #notificationItems {
            color: #FFD700;
            font-size: 14px;
            display: block;
            margin-top: 5px;
        }

        .notification-link {
            display: block;
            text-align: center;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 10px;
            margin-top: 5px;
            transition: all 0.3s;
            border: 1px solid #4CAF50;
        }

        .notification-link:hover {
            background: rgba(76, 175, 80, 0.4);
            transform: translateY(-2px);
        }

        .notification-close {
            position: absolute;
            top: 5px;
            right: 5px;
            background: transparent;
            color: #90a4ae;
            border: none;
            font-size: 16px;
            cursor: pointer;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .notification-close:hover {
            color: white;
            background: rgba(244, 67, 54, 0.3);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes introAppear {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes contentAppear {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes titleGlow {
            0%, 100% { 
                text-shadow: 
                    3px 3px 0 #2d4460,
                    6px 6px 0 rgba(0, 0, 0, 0.8),
                    0 0 10px rgba(255, 215, 0, 0.3);
            }
            50% { 
                text-shadow: 
                    3px 3px 0 #2d4460,
                    6px 6px 0 rgba(0, 0, 0, 0.8),
                    0 0 30px rgba(255, 215, 0, 0.7);
            }
        }
        
        @keyframes subtitleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes textPulse {
            0%, 100% { 
                box-shadow: 0 0 40px rgba(74, 111, 165, 0.3);
                border-color: #4a6fa5;
            }
            50% { 
                box-shadow: 0 0 60px rgba(74, 111, 165, 0.6);
                border-color: #4fc3f7;
            }
        }
        
        @keyframes buttonPulse {
            0%, 100% { 
                box-shadow: 
                    0 12px 0 #2d4460,
                    0 0 30px rgba(74, 111, 165, 0.5);
            }
            50% { 
                box-shadow: 
                    0 12px 0 #2d4460,
                    0 0 50px rgba(74, 111, 165, 0.8);
            }
        }
        
        @keyframes coalFloat {
            0% { 
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { 
                opacity: 0;
                transform: scale(0.9);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes blinkCursor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes snowdriftFloat {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-10px) rotate(1deg); }
        }
        
        @keyframes snowClear {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
                border-radius: 50% 50% 40% 40% / 60% 60% 40% 40%;
            }
            50% { 
                transform: scale(1.15) rotate(8deg);
                opacity: 0.9;
                border-radius: 30% 70% 40% 60% / 50% 50% 50% 50%;
            }
            100% { 
                transform: scale(0.98) rotate(0deg);
                opacity: 1;
                border-radius: 20% 80% 30% 70% / 40% 60% 40% 60%;
            }
        }
        
        @keyframes foundGlow {
            0% { filter: drop-shadow(0 0 5px rgba(79, 195, 247, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(79, 195, 247, 1)); }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes popupAppear {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            70% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.05);
            }
            100% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -20px); }
            20% { opacity: 1; transform: translate(-50%, 0); }
            80% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        @keyframes slideInNotification {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .blink {
            animation: blink 1.2s infinite;
            display: inline-block;
        }
        
        /* –£–≥–ª–æ–≤—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è */
        .corner-decoration {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 4px solid #4a6fa5;
        }
        
        .corner-tl {
            top: -3px;
            left: -3px;
            border-right: none;
            border-bottom: none;
        }
        
        .corner-tr {
            top: -3px;
            right: -3px;
            border-left: none;
            border-bottom: none;
        }
        
        .corner-bl {
            bottom: -3px;
            left: -3px;
            border-right: none;
            border-top: none;
        }
        
        .corner-br {
            bottom: -3px;
            right: -3px;
            border-left: none;
            border-top: none;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .search-field {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .snowdrift {
                width: 100px;
                height: 100px;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .rpg-header h1 {
                font-size: 24px;
            }
            
            .result-title {
                font-size: 28px;
            }
            
            .audio-controls {
                bottom: 10px;
                right: 10px;
                padding: 8px 12px;
            }
            
            #volumeSlider {
                width: 80px;
            }
            
            .typewriter-text {
                font-size: 16px;
                line-height: 1.6;
            }
        }
        
        @media (max-width: 480px) {
            .search-field {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .rpg-button {
                min-width: 240px;
                padding: 15px 30px;
                font-size: 14px;
            }
            
            .intro-title {
                font-size: 36px;
            }
            
            .intro-subtitle {
                font-size: 22px;
            }
            
            .audio-controls {
                flex-direction: column;
                gap: 8px;
                padding: 10px;
            }
            
            #volumeSlider {
                width: 60px;
            }
            
            .typewriter-text {
                font-size: 14px;
                line-height: 1.5;
            }
        }
    </style>
</head>
<body>
    <!-- ===== –≠–ö–†–ê–ù-–ó–ê–°–¢–ê–í–ö–ê ===== -->
    <div class="intro-screen" id="introScreen">
        <div class="intro-content">
            <h1 class="intro-title">–î–ï–ù–¨ 1</h1>
            <div class="intro-subtitle">–£–ì–û–õ–¨–ù–ê–Ø –î–ï–†–ï–í–ù–Ø</div>
            <div class="intro-text">
                <p style="margin-bottom: 20px;">
                    <span style="color: #4fc3f7;">‚ú¶</span> –ì–ª—É–±–æ–∫–æ –≤ –∑–∞—Å–Ω–µ–∂–µ–Ω–Ω—ã—Ö –ª–µ—Å–∞—Ö –°–µ–≤–µ—Ä–Ω—ã—Ö –∑–µ–º–µ–ª—å<br>
                    <span style="color: #4fc3f7;">‚ú¶</span> –°–∫—Ä—ã—Ç–∞ –æ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –≥–ª–∞–∑ –º–∞–ª–µ–Ω—å–∫–∞—è –¥–µ—Ä–µ–≤—É—à–∫–∞...<br>
                    <span style="color: #4fc3f7;">‚ú¶</span> –ú–µ—Å—Ç–æ, –≥–¥–µ –¥—ã–º –æ—Ç –∫—É–∑–Ω–∏—Ü —Å–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Å —É—Ç—Ä–µ–Ω–Ω–∏–º —Ç—É–º–∞–Ω–æ–º<br>
                    <span style="color: #4fc3f7;">‚ú¶</span> –ì–¥–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ª—è–∑–≥–∞ –º–µ—Ç–∞–ª–ª–∞ –∏ —Ç—Ä–µ—Å–∫–∞ —É–≥–ª—è
                </p>
                <p style="color: #FFD700; font-size: 22px; margin-top: 30px;">
                    –ü–†–ò–ö–õ–Æ–ß–ï–ù–ò–Ø –ù–ò–ö–ê –¢–û–õ–¨–ö–û –ù–ê–ß–ò–ù–ê–Æ–¢–°–Ø...
                </p>
            </div>
            <button class="intro-button" id="startIntroBtn">
                –ù–ê–ß–ê–¢–¨ –ò–°–¢–û–†–ò–Æ
            </button>
        </div>
    </div>
    
    <!-- ===== –≠–ö–†–ê–ù –í–ò–ó–£–ê–õ–¨–ù–û–ô –ù–û–í–ï–õ–õ–´ ===== -->
    <div id="visualNovel" class="visual-novel-container">
        <div class="novel-scene">
            <!-- –í–∏–¥–µ–æ —Ñ–æ–Ω -->
            <video id="sceneVideo" class="scene-video" autoplay muted loop playsinline>
                <!-- –í–∏–¥–µ–æ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
            </video>
            
            <!-- –û–∫–Ω–æ –¥–∏–∞–ª–æ–≥–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø–µ—á–∞—Ç–∞—é—â–µ–≥–æ—Å—è —Ç–µ–∫—Å—Ç–∞ -->
            <div class="dialogue-window">
                <div class="character-name" id="speakerName">–ù–ò–ö</div>
                <div class="typewriter-container">
                    <div class="typewriter-text" id="dialogueText"></div>
                </div>
                <button class="next-btn" id="nextBtn">
                    <span class="btn-text">–î–ê–õ–ï–ï</span>
                    <span class="btn-arrow">‚ñ∂</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- ===== –û–°–ù–û–í–ù–û–ô –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ===== -->
    <div class="game-container" id="gameContainer">
        <div class="game-content">
            <!-- –£–≥–ª–æ–≤—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è -->
            <div class="corner-decoration corner-tl"></div>
            <div class="corner-decoration corner-tr"></div>
            <div class="corner-decoration corner-bl"></div>
            <div class="corner-decoration corner-br"></div>
            
            <!-- RPG –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="rpg-header">
                <div class="header-container">
                    <div class="header-icon">üèÆ</div>
                    <h1>–î–ï–ù–¨ 1: –°–õ–£–ß–ê–ô–ù–ê–Ø –ù–ê–•–û–î–ö–ê</h1>
                    <div class="header-icon">üó°Ô∏è</div>
                </div>
                <p class="subtitle">27 –î–ï–ö–ê–ë–†–Ø ‚Ä¢ –î–ï–†–ï–í–ù–Ø –£–ì–û–õ–¨–ù–û–ï –°–ï–†–î–¶–ï ‚Ä¢ –í–ï–ß–ï–† ‚Ä¢ –•–û–õ–û–î–ù–û –ò –¢–£–ú–ê–ù–ù–û</p>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–æ–≤–µ–ª–ª—ã -->
            <div style="text-align: center; margin: 40px 0;">
                <button class="rpg-button" id="startNovelBtn" style="min-width: 350px; background: linear-gradient(145deg, #4a6fa5, #2d4460);">
                    <span style="margin-left: 20px;">‚ñ∂ –ü–ï–†–ï–°–ú–û–¢–†–ï–¢–¨ –ò–°–¢–û–†–ò–Æ</span>
                    <span style="position: absolute; right: 25px; font-size: 24px;">üìñ</span>
                </button>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–ª–æ–≥ -->
            <div class="npc-dialogue">
                <div class="dialogue-text">
                    <div style="margin-bottom: 15px; color: #4fc3f7;">
                        <span class="blink">üèÆ</span> –ò–°–¢–û–†–ò–Ø –ü–†–û–î–û–õ–ñ–ê–ï–¢–°–Ø...
                    </div>
                    <div style="margin-bottom: 15px;">
                        <span class="blink">></span> –ù–ò–ö –î–û–ë–†–ê–õ–°–Ø –î–û –û–ö–†–ê–ò–ù–´ –õ–ï–°–ê, –ì–î–ï –í–ò–î–ï–õ –°–¢–†–ê–ù–ù–û–ï –°–í–ï–ß–ï–ù–ò–ï.
                    </div>
                    <div style="margin-bottom: 15px;">
                        <span class="blink">></span> –¢–ï–ü–ï–†–¨ –ï–ú–£ –ü–†–ï–î–°–¢–û–ò–¢ –û–ë–´–°–ö–ê–¢–¨ –°–ù–ï–ñ–ù–û–ï –ü–û–õ–ï...
                    </div>
                    <div style="margin-bottom: 15px;">
                        <span class="blink">></span> –°–í–ï–¢ –ë–´–õ –ì–î–ï-–¢–û –ó–î–ï–°–¨, –ú–ï–ñ–î–£ –°–£–ì–†–û–ë–ê–ú–ò –ò –£–ü–ê–í–®–ò–ú–ò –î–ï–†–ï–í–¨–Ø–ú–ò.
                    </div>
                    <div style="color: #FFB74D;">
                        <span class="blink">‚ö°</span> –ü–û–ú–û–ì–ò –ù–ò–ö–£ –ù–ê–ô–¢–ò –¢–û, –ß–¢–û –û–ù –ò–©–ï–¢!
                    </div>
                </div>
            </div>
            
            <!-- RPG —Å—Ç–∞—Ç—É—Å –±–∞—Ä -->
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-label">–ü–û–ü–´–¢–ö–ò</div>
                    <div class="status-value" id="attempts">0/10</div>
                </div>
                <div class="status-item">
                    <div class="status-label">–ù–ê–ô–î–ï–ù–û</div>
                    <div class="status-value" id="found">0/2</div>
                </div>
                <div class="status-item">
                    <div class="status-label">–õ–û–ö–ê–¶–ò–Ø</div>
                    <div class="status-value">üèÆ</div>
                </div>
                <div class="status-item">
                    <div class="status-label">–í–†–ï–ú–Ø</div>
                    <div class="status-value">üåô</div>
                </div>
            </div>
            
            <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
            <div class="search-field-container">
                <div class="search-field" id="snowField">
                    <!-- –°—É–≥—Ä–æ–±—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
            <div style="text-align: center; margin-top: 50px; display: flex; flex-wrap: wrap; justify-content: center; gap: 25px;">
                <a href="index.html" class="rpg-button menu-return-button" id="backToMenuBtn">
                    <span style="position: absolute; left: 25px;">üè†</span>
                    <span style="margin-left: 30px;">–í–ï–†–ù–£–¢–¨–°–Ø –í –ú–ï–ù–Æ</span>
                </a>
                <button class="rpg-button" id="replayNovelBtn" style="background: linear-gradient(145deg, #4a6fa5, #2d4460);">
                    <span style="position: absolute; left: 25px;">üìñ</span>
                    <span style="margin-left: 30px;">–ü–ï–†–ï–°–ú–û–¢–†–ï–¢–¨ –ò–°–¢–û–†–ò–Æ</span>
                </button>
                <a href="inventory.html" class="rpg-button" style="background: linear-gradient(145deg, #4CAF50, #2E7D32);">
                    <span style="position: absolute; left: 25px;">üéí</span>
                    <span style="margin-left: 30px;">–ò–ù–í–ï–ù–¢–ê–†–¨</span>
                    <span style="position: absolute; right: 25px;">üó°Ô∏è</span>
                </a>
            </div>
        </div>
    </div>
    
    <!-- ===== –û–ö–ù–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ===== -->
    <!-- –û–∫–Ω–æ –ø–æ–±–µ–¥—ã -->
        <div class="result-window" id="resultWindow">
            <h2 class="result-title">‚ú® –ù–ï–í–ï–†–û–Ø–¢–ù–û! ‚ú®</h2>
            <div class="result-text">
                <span class="blink">></span> –¢–´ –ù–ê–®–Å–õ –î–†–ï–í–ù–ò–ô –ú–ï–ß –ò... –ì–û–í–û–†–Ø–©–£–Æ –ú–´–®–¨?<br>
            </div>
            
            <button class="rpg-button inventory-button" id="continueBtn">
                <span style="position: absolute; left: 25px;">üé¨</span>
                <span style="margin-left: 30px;">–ü–†–û–î–û–õ–ñ–ò–¢–¨ –ò–°–¢–û–†–ò–Æ</span>
                <span style="position: absolute; right: 25px;">‚ú®</span>
            </button>
        </div>
    
    <!-- –û–∫–Ω–æ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ -->
    <div class="result-window" id="gameOverWindow" style="display: none; background: rgba(80, 40, 30, 0.98); border-color: #795548;">
        <h2 class="result-title">üíÄ –¢–ï–ú–ù–ï–ï–¢...</h2>
        <div class="result-text">
            <span class="blink">></span> –°–£–ú–ï–†–ö–ò –°–ì–£–©–ê–Æ–¢–°–Ø, –ò –¢–´ –ù–ò–ß–ï–ì–û –ù–ï –ù–ê–®–Å–õ.<br>
            <span class="blink">></span> –ú–û–ñ–ï–¢ –ë–´–¢–¨, –≠–¢–û –ë–´–õ–ê –ü–†–û–°–¢–û –ò–ì–†–ê –°–í–ï–¢–ê –ò –¢–ï–ù–ò?<br>
            <span class="blink">></span> –ù–û –ß–¢–û-–¢–û –ì–û–í–û–†–ò–¢, –ß–¢–û –¢–ê–ú –î–ï–ô–°–¢–í–ò–¢–ï–õ–¨–ù–û –ë–´–õ–û...<br>
            <span class="blink">></span> –ü–û–ü–†–û–ë–£–ô –ï–©–Å –†–ê–ó –ó–ê–í–¢–†–ê.
        </div>
        <button class="rpg-button" id="retryBtn" style="background: linear-gradient(145deg, #795548, #5D4037);">
            <span style="margin-left: 15px;">üîÑ –ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê</span>
        </button>
    </div>

    <!-- ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –î–û–ë–ê–í–õ–ï–ù–ò–ò –í –ò–ù–í–ï–ù–¢–ê–†–¨ ===== -->
    <div class="inventory-notification" id="inventoryNotification">
        <div class="notification-content">
            <div class="notification-icon">üéÅ</div>
            <div class="notification-text">
                <strong>–ü–†–ï–î–ú–ï–¢–´ –î–û–ë–ê–í–õ–ï–ù–´ –í –ò–ù–í–ï–ù–¢–ê–†–¨!</strong>
                <span id="notificationItems"></span>
            </div>
            <a href="inventory.html" class="notification-link">–û–¢–ö–†–´–¢–¨ –ò–ù–í–ï–ù–¢–ê–†–¨ ‚Üí</a>
        </div>
        <button class="notification-close" onclick="hideInventoryNotification()">√ó</button>
    </div>

    <!-- ===== –ö–û–ù–¢–†–û–õ–õ–ï–† –ê–£–î–ò–û ===== -->
    <div class="audio-controls" id="audioControls">
        <button id="toggleMusicBtn" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">
            <i class="fas fa-music"></i>
        </button>
        <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5" title="–ì—Ä–æ–º–∫–æ—Å—Ç—å">
        <span id="volumeValue">50%</span>
    </div>
    
    <audio id="backgroundMusic" loop>
        <source src="audio/Neo Tantra, Kamasutra, Tantric Music Zone, Deep Love Music - Intimate Revealed [audiovk.com].mp3" type="audio/mpeg">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç audio.
    </audio>

    <script>
        // ========== –°–ò–°–¢–ï–ú–ê –ó–í–£–ö–û–í–´–• –≠–§–§–ï–ö–¢–û–í ==========
        class SoundManager {
            constructor() {
                this.soundEnabled = true;
                this.audioContext = null;
                this.initAudioContext();
            }

            initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Web Audio API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                }
            }

            playPixelSound(type) {
                if (!this.soundEnabled || !this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                let frequency = 440, duration = 0.1;
                
                switch(type) {
                    case 'click': frequency = 220 + Math.random() * 110; duration = 0.05; break;
                    case 'step': frequency = 150 + Math.random() * 50; duration = 0.08; break;
                    case 'success': frequency = 880; duration = 0.2; break;
                    case 'fail': frequency = 110; duration = 0.3; break;
                    case 'stone': frequency = 300; duration = 0.15; break;
                    case 'stone_throw': frequency = 400; duration = 0.3; break;
                    case 'stone_success': frequency = 660; duration = 0.5; break;
                    case 'stone_fail': frequency = 120; duration = 0.6; break;
                    case 'dragon_wake': frequency = 60; duration = 0.8; break;
                    case 'dragon_sleep': frequency = 80; duration = 0.5; break;
                    case 'hover': frequency = 330; duration = 0.03; break;
                    case 'menu_click': frequency = 550; duration = 0.1; break;
                    case 'snow_click': frequency = 200 + Math.random() * 80; duration = 0.08; break;
                    case 'snow_found': frequency = 700; duration = 0.4; break;
                    case 'snow_clear': frequency = 350; duration = 0.2; break;
                    case 'novel_next': frequency = 480; duration = 0.07; break;
                    case 'game_win': 
                        this.playChord([880, 660, 440], 1.0);
                        return;
                    case 'game_lose':
                        this.playChord([110, 90, 70], 1.2);
                        return;
                    case 'inventory_open': frequency = 600; duration = 0.3; break;
                    case 'button_press': frequency = 300; duration = 0.15; break;
                }
                
                this.playSingleSound(frequency, duration);
            }
            
            playChord(frequencies, duration) {
                if (!this.audioContext) return;
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playSingleSound(freq, duration * 0.7);
                    }, index * 100);
                });
            }
            
            playSingleSound(frequency, duration) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                return this.soundEnabled;
            }
        }

        // ========== –§–û–ù–û–í–ê–Ø –ú–£–ó–´–ö–ê ==========
        let backgroundMusic = document.getElementById('backgroundMusic');
        let toggleMusicBtn = document.getElementById('toggleMusicBtn');
        let volumeSlider = document.getElementById('volumeSlider');
        let volumeValue = document.getElementById('volumeValue');
        let isMusicPlaying = false;
        let soundManager;
        
                function initAudio() {
            const savedVolume = localStorage.getItem('bgMusicVolume');
            if (savedVolume !== null) {
                backgroundMusic.volume = parseFloat(savedVolume);
                volumeSlider.value = savedVolume;
                updateVolumeDisplay(savedVolume);
            } else {
                backgroundMusic.volume = 0.5;
                updateVolumeDisplay(0.5);
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –º—É–∑—ã–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
            isMusicPlaying = false;
            
            // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function tryPlayMusic() {
                if (!isMusicPlaying) {
                    const playPromise = backgroundMusic.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log("–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞");
                            isMusicPlaying = true;
                            updateMusicButton();
                        }).catch(error => {
                            console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ", error);
                            isMusicPlaying = false;
                            updateMusicButton();
                        });
                    }
                }
            }
            
            // –ü—Ä–æ–±—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.addEventListener('click', function firstClickHandler() {
                tryPlayMusic();
                // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞
                document.removeEventListener('click', firstClickHandler);
            }, { once: true });
            
            // –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
            window.addEventListener('load', function() {
                tryPlayMusic();
            });
            
            toggleMusicBtn.addEventListener('click', toggleMusic);
            volumeSlider.addEventListener('input', updateVolume);
            
            volumeSlider.addEventListener('change', function() {
                localStorage.setItem('bgMusicVolume', this.value);
            });
            
            updateMusicButton();
            soundManager = new SoundManager();
        }
        
        function toggleMusic() {
            soundManager.playPixelSound('click');
            if (isMusicPlaying) {
                backgroundMusic.pause();
                isMusicPlaying = false;
            } else {
                // –ü—Ä–æ–±—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                }).catch(error => {
                    console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É:", error);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    alert("–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –æ–±–ª–∞—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏");
                });
            }
            updateMusicButton();
        }
        
        function updateVolume() {
            const volume = parseFloat(volumeSlider.value);
            backgroundMusic.volume = volume;
            updateVolumeDisplay(volume);
        }
        
        function updateVolumeDisplay(volume) {
            const percent = Math.round(volume * 100);
            volumeValue.textContent = percent + '%';
            
            if (percent === 0) {
                volumeValue.style.color = '#90a4ae';
            } else if (percent < 30) {
                volumeValue.style.color = '#4fc3f7';
            } else if (percent < 70) {
                volumeValue.style.color = '#bbdefb';
            } else {
                volumeValue.style.color = '#FFD700';
            }
        }
        
        function updateMusicButton() {
            const icon = toggleMusicBtn.querySelector('i');
            if (isMusicPlaying) {
                icon.className = 'fas fa-volume-up';
                toggleMusicBtn.style.background = 'linear-gradient(145deg, #4CAF50, #2E7D32)';
            } else {
                icon.className = 'fas fa-volume-mute';
                toggleMusicBtn.style.background = 'linear-gradient(145deg, #f44336, #c62828)';
            }
        }
        
        // ========== –≠–ö–†–ê–ù-–ó–ê–°–¢–ê–í–ö–ê ==========
        function createIntroParticles() {
            const introScreen = document.getElementById('introScreen');
            if (!introScreen) return;
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'coal-particle';
                
                const size = Math.random() * 8 + 4;
                const x = Math.random() * 100;
                const duration = Math.random() * 20 + 15;
                const delay = Math.random() * 10;
                
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = x + 'vw';
                particle.style.background = `radial-gradient(circle at 30% 30%, #2d4460, #1a2d42, #0f1a28)`;
                particle.style.boxShadow = `inset 0 0 10px rgba(74, 111, 165, 0.5)`;
                particle.style.animationDuration = duration + 's';
                particle.style.animationDelay = delay + 's';
                
                introScreen.appendChild(particle);
            }
        }
        
        function startIntro() {
            const introScreen = document.getElementById('introScreen');
            const visualNovel = document.getElementById('visualNovel');
            
            if (introScreen && visualNovel) {
                introScreen.style.animation = 'fadeOut 1s ease-out forwards';
                
                setTimeout(() => {
                    introScreen.style.display = 'none';
                    visualNovel.style.display = 'flex';
                    startNovel();
                }, 800);
            }
        }
        
        // ========== –í–ò–ó–£–ê–õ–¨–ù–ê–Ø –ù–û–í–ï–õ–õ–ê ==========
        const novelScenes = [
            {
                video: "video/Derevnya.mp4",
                speaker: "–ù–ò–ö",
                text: "–£–≥–æ–ª—å–Ω–æ–µ –°–µ—Ä–¥—Ü–µ... –ú–∞–ª–µ–Ω—å–∫–∞—è –¥–µ—Ä–µ–≤—É—à–∫–∞ –Ω–∞ –∫—Ä–∞—é –ª–µ—Å–∞. –ú–µ—Å—Ç–æ, –≥–¥–µ –∂–∏–∑–Ω—å —Ç–µ—á—ë—Ç –º–µ–¥–ª–µ–Ω–Ω–æ, –∫–∞–∫ —Ä–µ–∫–∞ –ø–æ–¥ –∑–∏–º–Ω–∏–º –ª—å–¥–æ–º."
            },
            {
                video: "video/Derevnya.mp4",
                speaker: "–ù–ò–ö",
                text: "–ó–¥–µ—Å—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ª—è–∑–≥–∞ –º–µ—Ç–∞–ª–ª–∞ –∏ —Ç—Ä–µ—Å–∫–∞ —É–≥–ª—è. –ö—É–∑–Ω–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ä–∞—Å—Å–≤–µ—Ç–∞ –¥–æ –∑–∞–∫–∞—Ç–∞, —Å–æ–≥—Ä–µ–≤–∞—è –¥–µ—Ä–µ–≤–Ω—é —Å–≤–æ–∏–º –∂–∞—Ä–æ–º."
            },
            {
                video: "video/Derevnya.mp4",
                speaker: "–ù–ò–ö",
                text: "–û–ø—è—Ç—å –∫–æ–Ω—á–∏–ª—Å—è —É–≥–æ–ª—å... –û—Ç–µ—Ü –±–æ–ª–µ–µ—Ç, –º–∞—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–∞–≤–µ—Ä–Ω–µ –¥–æ –ø–æ–∑–¥–Ω–µ–π –Ω–æ—á–∏. –ö—Ç–æ –∂–µ –µ—â—ë –ø–æ–π–¥—ë—Ç –≤ –ª–µ—Å –ø–µ—Ä–µ–¥ —Å–∞–º—ã–º –∑–∞–∫—Ä—ã—Ç–∏–µ–º –≤–æ—Ä–æ—Ç?"
            },
            {
                video: "video/Derevnya.mp4",
                speaker: "–ù–ò–ö",
                text: "–£–≥–æ–ª—å–Ω–æ–µ –°–µ—Ä–¥—Ü–µ... –°—Ç—Ä–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ. –î–µ–¥—É—à–∫–∞ –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ –∫–æ–≥–¥–∞-—Ç–æ –∑–¥–µ—Å—å –Ω–∞—à–ª–∏ –æ–≥—Ä–æ–º–Ω—ã–π —É–≥–æ–ª—å–Ω—ã–π –ø–ª–∞—Å—Ç, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ —Å–µ—Ä–¥—Ü–µ."
            },
            {
                video: "video/Doroga v les.mp4",
                speaker: "–ù–ò–ö",
                text: "–£–∂–µ —Å–º–µ—Ä–∫–∞–µ—Ç—Å—è. –ù–∞–¥–æ –±—ã—Å—Ç—Ä–µ–µ, –∞ —Ç–æ –≤–æ—Ä–æ—Ç–∞ –∑–∞–∫—Ä–æ—é—Ç. –õ–µ—Å—Ç –Ω–æ—á—å—é... –Ω–µ —Å–∞–º–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ."
            },
            {
                video: "video/Doroga v les.mp4",
                speaker: "–ù–ò–ö",
                text: "–ß—Ç–æ —ç—Ç–æ? –ö–∞–∂–µ—Ç—Å—è, –º–µ–∂–¥—É –¥–µ—Ä–µ–≤—å—è–º–∏ —á—Ç–æ-—Ç–æ —Å–≤–µ—Ç–∏—Ç—Å—è... –ì–æ–ª—É–±–æ–≤–∞—Ç—ã–π —Å–≤–µ—Ç, –∫–∞–∫ –ø–∞–¥–∞—é—â–∞—è –∑–≤–µ–∑–¥–∞. –ù–æ –∑–≤—ë–∑–¥—ã —Ç–∞–∫ –Ω–µ —Å–≤–µ—Ç—è—Ç."
            },
            {
                video: "video/Doroga v les.mp4",
                speaker: "–ù–ò–ö",
                text: "–ù–∞–¥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –ï—Å–ª–∏ —ç—Ç–æ —á—Ç–æ-—Ç–æ —Ü–µ–Ω–Ω–æ–µ, —Å–º–æ–≥—É –ø–æ–º–æ—á—å —Å–µ–º—å–µ. –ú–æ–∂–µ—Ç, —ç—Ç–æ –∑–Ω–∞–∫? –£–¥–∞—á–∞ –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –ø–æ–≤–µ—Ä–Ω—É–ª–∞—Å—å –∫–æ –º–Ω–µ –ª–∏—Ü–æ–º..."
            }
        ];
        
        const swordFoundScenes = [
            {
                video: "video/Mech naiden.mp4",
                speaker: "–ù–ò–ö",
                text: "–ß—Ç–æ —ç—Ç–æ?! –ü–æ–¥ —Å–Ω–µ–≥–æ–º —á—Ç–æ-—Ç–æ –±–ª–µ—Å—Ç–∏—Ç... –≠—Ç–æ –º–µ—á! –ù–∞—Å—Ç–æ—è—â–∏–π —Å—Ç–∞–ª—å–Ω–æ–π –º–µ—á —Å —Ä–µ–∑–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é!"
            },
            {
                video: "video/Mech naiden.mp4",
                speaker: "–ù–ò–ö",
                text: "–û–Ω —Ç–∞–∫–æ–π —Ç—è–∂—ë–ª—ã–π... –ò —Ö–æ–ª–æ–¥–Ω—ã–π. –ù–æ –Ω–∞ —Ä—É–∫–æ—è—Ç–∏ –µ—Å—Ç—å –∫–∞–∫–∏–µ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã. –Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–µ–ª –Ω–∏—á–µ–≥–æ –ø–æ–¥–æ–±–Ω–æ–≥–æ!"
            },
            {
                video: "video/Mech naiden.mp4",
                speaker: "–Æ–ú–ò",
                text: "–≠–π! –≠—Ç–æ –º–æ–π –º–µ—á! –û—Ç–¥–∞–π –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ!"
            },
            {
                video: "video/Mech naiden.mp4",
                speaker: "–ù–ò–ö",
                text: "–ß—Ç–æ?! –ö—Ç–æ —ç—Ç–æ —Å–∫–∞–∑–∞–ª? –Ø –æ–¥–∏–Ω –≤ –ª–µ—Å—É... –û—Ç–∫—É–¥–∞ —ç—Ç–æ—Ç –≥–æ–ª–æ—Å?"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–Æ–ú–ò",
                text: "–Ø –∑–¥–µ—Å—å! –°–º–æ—Ç—Ä–∏ –ø–æ–¥ –Ω–æ–≥–∏, –Ω–µ—É–º–µ—Ö–∞! –Ø —Ç–∞ —Å–∞–º–∞—è –º—ã—à–∫–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —á—É—Ç—å –Ω–µ —Ä–∞–∑–¥–∞–≤–∏–ª!"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–ù–ò–ö",
                text: "–¢—ã... —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å? –ù–æ —ç—Ç–æ –∂–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ! –ú—ã—à–∏ –Ω–µ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç!"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–Æ–ú–ò",
                text: "–û–±—ã—á–Ω—ã–µ –º—ã—à–∏ ‚Äî –Ω–µ—Ç. –ù–æ —è –Ω–µ –æ–±—ã—á–Ω–∞—è! –Ø ‚Äî —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ —ç—Ç–æ–≥–æ –º–µ—á–∞. –û–Ω –±—ã–ª –∑–∞–∫–æ–ø–∞–Ω –∑–¥–µ—Å—å —Å—Ç–æ –ª–µ—Ç –Ω–∞–∑–∞–¥!"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–ù–ò–ö",
                text: "–°—Ç–æ –ª–µ—Ç... –ù–æ –∑–∞—á–µ–º —Ç—ã –µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∞? –ò –ø–æ—á–µ–º—É —Ç–µ–ø–µ—Ä—å —Ä–µ—à–∏–ª–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è?"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–Æ–ú–ò",
                text: "–ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –µ–≥–æ –Ω–∞—à—ë–ª! –ó–Ω–∞—á–∏—Ç, —Ç—ã ‚Äî –∏–∑–±—Ä–∞–Ω–Ω—ã–π. –ú–µ—á —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç, –∫—Ç–æ –µ–≥–æ –¥–æ—Å—Ç–æ–∏–Ω –Ω–µ—Å—Ç–∏."
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–ù–ò–ö",
                text: "–ò–∑–±—Ä–∞–Ω–Ω—ã–π? –Ø? –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–µ–Ω—å –∏–∑ —É–≥–æ–ª—å–Ω–æ–π –¥–µ—Ä–µ–≤–Ω–∏? –¢—ã —à—É—Ç–∏—à—å!"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–Æ–ú–ò",
                text: "–ù–µ—Ç, –Ω–µ —à—É—á—É. –ú–µ—á —Å–≤–µ—Ç–∏–ª—Å—è –¥–ª—è —Ç–µ–±—è, –Ω–µ —Ç–∞–∫ –ª–∏? –ó–Ω–∞—á–∏—Ç, –æ–Ω —Ç–µ–±—è –≤—ã–±—Ä–∞–ª. –ê —è... —è –ø–æ–π–¥—É —Å —Ç–æ–±–æ–π."
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–ù–ò–ö",
                text: "–°–æ –º–Ω–æ–π? –ù–æ –∫—É–¥–∞? –Ø –ø—Ä–æ—Å—Ç–æ —à–µ–ª –∑–∞ —É–≥–ª—ë–º..."
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–Æ–ú–ò",
                text: "–¢–µ–ø–µ—Ä—å —Ç–≤–æ–π –ø—É—Ç—å –∏–∑–º–µ–Ω–∏–ª—Å—è. –° —ç—Ç–∏–º –º–µ—á–æ–º –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–µ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ. –ò —è –±—É–¥—É —Ç–≤–æ–∏–º –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º!"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–ù–ò–ö",
                text: "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ... –ó–≤—É—á–∏—Ç —Å—Ç—Ä–∞—à–Ω–æ. –ù–æ... –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –õ–∞–¥–Ω–æ, –ø–æ–π–¥—ë–º. –ù–æ –∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–Æ–ú–ò",
                text: "–Æ–º–∏! –ê —Ç–µ–±—è?"
            },
            {
                video: "video/Yumi day1.mp4",
                speaker: "–ù–ò–ö",
                text: "–ù–∏–∫. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ—é... –Ω–∞—à—É –∏—Å—Ç–æ—Ä–∏—é, –Æ–º–∏."
            }
        ];
        
        let currentScene = 0;
        let isTyping = false;
        let currentText = "";
        let currentWords = [];
        let wordIndex = 0;
        let typingInterval;
        let isSwordFoundNovel = false;
        let videoElement = null;
        let lastVideoPath = null;
        
        function initNovel() {
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.addEventListener('mouseenter', () => {
                    if (!isTyping) soundManager.playPixelSound('hover');
                });
                nextBtn.addEventListener('click', () => {
                    if (isTyping) {
                        soundManager.playPixelSound('stone_throw');
                    } else {
                        soundManager.playPixelSound('novel_next');
                    }
                    nextScene();
                });
            }
            
            const replayBtn = document.getElementById('replayNovelBtn');
            if (replayBtn) {
                replayBtn.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                replayBtn.addEventListener('click', () => {
                    soundManager.playPixelSound('button_press');
                    showNovel();
                });
            }
            
            const startNovelBtn = document.getElementById('startNovelBtn');
            if (startNovelBtn) {
                startNovelBtn.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                startNovelBtn.addEventListener('click', () => {
                    soundManager.playPixelSound('button_press');
                    showNovel();
                });
            }
            
            const continueBtn = document.getElementById('continueBtn');
            if (continueBtn) {
                continueBtn.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                continueBtn.addEventListener('click', () => {
                    soundManager.playPixelSound('success');
                    showSwordFoundNovel();
                });
            }
            
            const backToMenuBtn = document.getElementById('backToMenuBtn');
            if (backToMenuBtn) {
                backToMenuBtn.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                backToMenuBtn.addEventListener('click', () => soundManager.playPixelSound('menu_click'));
            }
            
            const retryBtn = document.getElementById('retryBtn');
            if (retryBtn) {
                retryBtn.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                retryBtn.addEventListener('click', () => soundManager.playPixelSound('click'));
            }
            
            videoElement = document.getElementById('sceneVideo');
            
            if (videoElement) {
                videoElement.autoplay = true;
                videoElement.muted = true;
                videoElement.loop = true;
                videoElement.playsinline = true;
            }
        }
        
        function showNovel() {
            const gameContainer = document.getElementById('gameContainer');
            const visualNovel = document.getElementById('visualNovel');
            
            if (gameContainer && visualNovel) {
                gameContainer.style.display = 'none';
                visualNovel.style.display = 'flex';
                currentScene = 0;
                isSwordFoundNovel = false;
                loadScene(currentScene);
            }
        }
        
        function showSwordFoundNovel() {
            const gameContainer = document.getElementById('gameContainer');
            const visualNovel = document.getElementById('visualNovel');
            const resultWindow = document.getElementById('resultWindow');
            
            if (gameContainer && visualNovel && resultWindow) {
                resultWindow.style.display = 'none';
                gameContainer.style.display = 'none';
                visualNovel.style.display = 'flex';
                currentScene = 0;
                isSwordFoundNovel = true;
                loadScene(currentScene);
            }
        }
        
        function startNovel() {
            currentScene = 0;
            isSwordFoundNovel = false;
            loadScene(currentScene);
        }
        
        function loadScene(sceneIndex) {
            const scenes = isSwordFoundNovel ? swordFoundScenes : novelScenes;
            
            if (sceneIndex >= scenes.length) {
                endNovel();
                return;
            }
            
            const scene = scenes[sceneIndex];
            const speaker = document.getElementById('speakerName');
            
            if (speaker) speaker.textContent = scene.speaker;
            
            if (videoElement && scene.video) {
                const newVideoPath = scene.video;
                
                if (lastVideoPath !== newVideoPath) {
                    lastVideoPath = newVideoPath;
                    videoElement.src = newVideoPath;
                    videoElement.load();
                    
                    const playPromise = videoElement.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log(`–í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è: ${newVideoPath}`);
                        }).catch(e => {
                            console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ");
                            videoElement.controls = true;
                        });
                    }
                }
            }
            
            startTyping(scene.text);
        }
        
        function splitTextIntoWords(text) {
            const words = [];
            const regex = /([^\s]+|\s+)/g;
            const tokens = text.match(regex) || [];
            
            tokens.forEach(token => {
                if (token.trim() === '') {
                    words.push({
                        text: token,
                        isSpace: true
                    });
                } else {
                    words.push({
                        text: token,
                        isWord: true
                    });
                }
            });
            
            return words;
        }
        
                function startTyping(text) {
            const dialogueText = document.getElementById('dialogueText');
            if (!dialogueText) return;
            
            if (typingInterval) {
                clearInterval(typingInterval);
            }
            
            isTyping = true;
            currentText = text;
            wordIndex = 0;
            
            dialogueText.innerHTML = '';
            dialogueText.className = 'typewriter-text';
            
            currentWords = splitTextIntoWords(text);
            
            const cursor = document.createElement('span');
            cursor.className = 'typing-cursor';
            dialogueText.appendChild(cursor);
            
            // –£–ë–†–ê–ù –ó–í–£–ö –ù–ê–ß–ê–õ–ê –ü–ï–ß–ê–¢–ò
            // soundManager.playPixelSound('click');
            
            updateNextButton();
            
            typingInterval = setInterval(() => {
                typeNextWord(dialogueText, cursor);
            }, 80);
        }
        
        function typeNextWord(dialogueText, cursor) {
            if (wordIndex >= currentWords.length) {
                finishTyping(dialogueText, cursor);
                return;
            }
            
            const wordData = currentWords[wordIndex];
            
            if (cursor && cursor.parentNode) {
                cursor.remove();
            }
            
            let displayText = wordData.text;
            
            displayText = displayText
                .replace(/‚ú®/g, '<span class="text-emphasis">‚ú®</span>')
                .replace(/‚ö°/g, '<span class="text-emphasis">‚ö°</span>')
                .replace(/üó°Ô∏è/g, '<span class="text-emphasis">üó°Ô∏è</span>')
                .replace(/üê≠/g, '<span class="text-emphasis">üê≠</span>')
                .replace(/!/g, '<span class="text-emphasis">!</span>')
                .replace(/\?/g, '<span class="text-emphasis">?</span>');
            
            const wordSpan = document.createElement('span');
            wordSpan.className = 'typewriter-word';
            wordSpan.innerHTML = displayText;
            
            if (wordData.isSpace) {
                wordSpan.style.whiteSpace = 'pre';
            }
            
            dialogueText.appendChild(wordSpan);
            dialogueText.appendChild(cursor);
            
            // –£–ë–†–ê–ù –ó–í–£–ö –ü–ï–ß–ê–¢–ò –°–õ–û–í–ê
            // if (wordData.isWord) {
            //     soundManager.playPixelSound('click');
            // }
            
            wordIndex++;
            
            if (wordIndex >= currentWords.length) {
                setTimeout(() => {
                    finishTyping(dialogueText, cursor);
                }, 300);
            }
        }
        
        function finishTyping(dialogueText, cursor) {
            clearInterval(typingInterval);
            isTyping = false;
            
            if (cursor && cursor.parentNode) {
                cursor.remove();
            }
            
            dialogueText.className = 'typewriter-text text-complete';
            
            // –£–ë–†–ê–ù –ó–í–£–ö –ó–ê–í–ï–†–®–ï–ù–ò–Ø –ü–ï–ß–ê–¢–ò
            // soundManager.playPixelSound('success');
            
            updateNextButton();
        }
        
        function skipTyping() {
            if (!isTyping) return;
            
            clearInterval(typingInterval);
            isTyping = false;
            
            const dialogueText = document.getElementById('dialogueText');
            if (dialogueText) {
                const cursor = dialogueText.querySelector('.typing-cursor');
                if (cursor) cursor.remove();
                
                dialogueText.innerHTML = currentText;
                dialogueText.className = 'typewriter-text text-complete';
                
                // –£–ë–†–ê–ù –ó–í–£–ö –ü–†–û–ü–£–°–ö–ê
                // soundManager.playPixelSound('stone_success');
            }
            
            updateNextButton();
        }
        
        function updateNextButton() {
            const nextBtn = document.getElementById('nextBtn');
            if (!nextBtn) return;
            
            if (isTyping) {
                nextBtn.classList.add('waiting');
                nextBtn.querySelector('.btn-text').textContent = '–ü–†–û–ü–£–°–¢–ò–¢–¨';
                nextBtn.querySelector('.btn-arrow').textContent = '‚è©';
            } else {
                nextBtn.classList.remove('waiting');
                nextBtn.querySelector('.btn-text').textContent = '–î–ê–õ–ï–ï';
                nextBtn.querySelector('.btn-arrow').textContent = '‚ñ∂';
            }
        }
        
        function nextScene() {
            if (isTyping) {
                skipTyping();
                return;
            }
            
            currentScene++;
            loadScene(currentScene);
        }
        
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        const config = {
            totalSnowdrifts: 10,
            maxAttempts: 10,
            swordFoundOnAttempt: Math.floor(Math.random() * 10) + 1,
            swordPosition: null,
            mousePosition: null
        };
        
        let attempts = 0;
        let foundSword = false;
        let foundMouse = false;
        let gameActive = false;
        let gameCompleted = false;
        
        function startGame() {
            gameActive = true;
            gameCompleted = false;
            attempts = 0;
            foundSword = false;
            foundMouse = false;
            
            config.swordFoundOnAttempt = Math.floor(Math.random() * 10) + 1;
            
            createSnowdrifts();
            updateStatus();
            
            document.getElementById('resultWindow').style.display = 'none';
            document.getElementById('gameOverWindow').style.display = 'none';
        }
        
        function createSnowdrifts() {
            const field = document.getElementById('snowField');
            if (!field) return;
            
            field.innerHTML = '';
            
            config.swordPosition = Math.floor(Math.random() * config.totalSnowdrifts);
            config.mousePosition = Math.floor(Math.random() * config.totalSnowdrifts);
            
            while (config.mousePosition === config.swordPosition) {
                config.mousePosition = Math.floor(Math.random() * config.totalSnowdrifts);
            }
            
            for (let i = 0; i < config.totalSnowdrifts; i++) {
                const snowdrift = document.createElement('div');
                snowdrift.className = 'snowdrift';
                snowdrift.dataset.index = i;
                snowdrift.style.animationDelay = `${i * 0.2}s`;
                
                if (i === config.swordPosition) {
                    const swordIcon = document.createElement('div');
                    swordIcon.innerHTML = 'üó°Ô∏è';
                    swordIcon.id = 'sword' + i;
                    swordIcon.style.cssText = `
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        font-size: 40px;
                        opacity: 0;
                        z-index: 4;
                        pointer-events: none;
                        transition: opacity 0.5s ease;
                    `;
                    snowdrift.appendChild(swordIcon);
                }
                
                if (i === config.mousePosition) {
                    const mouseIcon = document.createElement('div');
                    mouseIcon.innerHTML = 'üê≠';
                    mouseIcon.id = 'mouse' + i;
                    mouseIcon.style.cssText = `
                        position: absolute;
                        top: 30%;
                        left: 30%;
                        transform: translate(-50%, -50%);
                        font-size: 30px;
                        opacity: 0;
                        z-index: 4;
                        pointer-events: none;
                        transition: opacity 0.5s ease;
                    `;
                    snowdrift.appendChild(mouseIcon);
                }
                
                snowdrift.addEventListener('mouseenter', () => {
                    if (!snowdrift.classList.contains('snow-cleared') && gameActive) {
                        soundManager.playPixelSound('hover');
                    }
                });
                
                snowdrift.addEventListener('click', () => handleSnowdriftClick(i, snowdrift));
                field.appendChild(snowdrift);
            }
        }
        
        function handleSnowdriftClick(index, element) {
            if (!gameActive || attempts >= config.maxAttempts) return;
            if (element.classList.contains('snow-cleared')) return;
            
            soundManager.playPixelSound('snow_click');
            
            attempts++;
            
            element.classList.add('snow-cleared');
            element.style.animation = 'snowClear 0.8s ease-out';
            element.style.pointerEvents = 'none';
            
            if (index === config.swordPosition) {
                foundSword = true;
                soundManager.playPixelSound('snow_found');
                showFoundItem(element, 'üó°Ô∏è', '–î–†–ï–í–ù–ò–ô –ú–ï–ß –ù–ê–ô–î–ï–ù!', '#4fc3f7');
                const swordIcon = document.getElementById('sword' + index);
                if (swordIcon) {
                    swordIcon.style.opacity = '1';
                    swordIcon.style.animation = 'foundGlow 1.5s infinite alternate';
                }
            }
            
            if (attempts === config.swordFoundOnAttempt && !foundSword) {
                const allSnowdrifts = document.querySelectorAll('.snowdrift');
                for (let i = 0; i < allSnowdrifts.length; i++) {
                    if (i === config.swordPosition && !allSnowdrifts[i].classList.contains('snow-cleared')) {
                        setTimeout(() => {
                            allSnowdrifts[i].classList.add('snow-cleared');
                            allSnowdrifts[i].style.animation = 'snowClear 0.8s ease-out';
                            allSnowdrifts[i].style.pointerEvents = 'none';
                            
                            foundSword = true;
                            soundManager.playPixelSound('snow_found');
                            const swordIcon = document.getElementById('sword' + i);
                            if (swordIcon) {
                                swordIcon.style.opacity = '1';
                                swordIcon.style.animation = 'foundGlow 1.5s infinite alternate';
                            }
                        }, 500);
                        break;
                    }
                }
            }
            
            if (index === config.mousePosition && !foundMouse) {
                foundMouse = true;
                soundManager.playPixelSound('snow_found');
                showFoundItem(element, 'üê≠', '–ú–´–®–ö–ê –Æ–ú–ò –ù–ê–ô–î–ï–ù–ê!', '#FFB74D');
                const mouseIcon = document.getElementById('mouse' + index);
                if (mouseIcon) {
                    mouseIcon.style.opacity = '1';
                    mouseIcon.style.animation = 'foundGlow 1.5s infinite alternate';
                }
            }
            
            updateStatus();
            
            if (foundSword && foundMouse) {
                gameActive = false;
                gameCompleted = true;
                setTimeout(() => {
                    soundManager.playPixelSound('game_win');
                    showResultWindow(true);
                }, 1500);
            } else if (attempts >= config.maxAttempts) {
                if (foundSword) {
                    gameActive = false;
                    gameCompleted = true;
                    setTimeout(() => {
                        soundManager.playPixelSound('game_win');
                        showResultWindow(true);
                    }, 1500);
                } else {
                    foundSword = true;
                    gameActive = false;
                    gameCompleted = true;
                    setTimeout(() => {
                        soundManager.playPixelSound('game_win');
                        showResultWindow(true);
                    }, 1500);
                }
            }
        }
        
        function showFoundItem(element, icon, text, color) {
            const popup = document.createElement('div');
            popup.innerHTML = `
                <div style="font-size: 50px; margin-bottom: 10px;">${icon}</div>
                <div style="font-size: 12px;">${text}</div>
            `;
            popup.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(32, 46, 64, 0.9);
                color: ${color};
                padding: 20px;
                border-radius: 10px;
                border: 3px solid ${color};
                text-align: center;
                z-index: 10;
                animation: popupAppear 0.5s ease-out;
                pointer-events: none;
            `;
            
            element.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 2000);
        }
        
        function showResultWindow(isWin) {
            if (isWin) {
                document.getElementById('resultWindow').style.display = 'block';
                createConfetti();
            } else {
                document.getElementById('gameOverWindow').style.display = 'none';
            }
        }
        
        function createConfetti() {
            const colors = ['#4fc3f7', '#FFD700', '#4CAF50', '#FF4081'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    top: -20px;
                    left: ${Math.random() * 100}vw;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    z-index: 1001;
                    pointer-events: none;
                `;
                
                document.body.appendChild(confetti);
                
                const animation = confetti.animate([
                    { 
                        transform: `translateY(0) rotate(0deg)`,
                        opacity: 1 
                    },
                    { 
                        transform: `translateY(${window.innerHeight + 100}px) rotate(${Math.random() * 360}deg)`,
                        opacity: 0 
                    }
                ], {
                    duration: Math.random() * 3000 + 2000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });
                
                animation.onfinish = () => {
                    confetti.remove();
                };
            }
        }
        
        function updateStatus() {
            const attemptsEl = document.getElementById('attempts');
            const foundEl = document.getElementById('found');
            
            if (attemptsEl) {
                attemptsEl.textContent = `${attempts}/${config.maxAttempts}`;
                
                attemptsEl.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    attemptsEl.style.transform = 'scale(1)';
                }, 200);
            }
            
            if (foundEl) {
                const foundCount = (foundSword ? 1 : 0) + (foundMouse ? 1 : 0);
                foundEl.textContent = `${foundCount}/2`;
                
                if (foundCount > 0) {
                    foundEl.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        foundEl.style.transform = 'scale(1)';
                    }, 300);
                }
            }
        }
        
        // ========== –ò–ù–í–ï–ù–¢–ê–†–¨ –ò –°–û–•–†–ê–ù–ï–ù–ò–ï ==========
        function saveProgress() {
            console.log("üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–Ω—è 1...");
            
            localStorage.setItem('day1_completed', 'true');
            localStorage.setItem('sword_found', 'true');
            localStorage.setItem('mouse_found', foundMouse ? 'true' : 'false');
            localStorage.setItem('day1_attempts', attempts);
            localStorage.setItem('day1_sword_found_on', config.swordFoundOnAttempt);
            
            let inventory = JSON.parse(localStorage.getItem('winterAdventureInventory')) || [];
            
            const swordName = '–î—Ä–µ–≤–Ω–∏–π –ú–µ—á üó°Ô∏è';
            const mouseName = '–ú—ã—à–∫–∞ –Æ–º–∏ üê≠';
            let addedItems = [];
            
            if (!inventory.includes(swordName)) {
                inventory.push(swordName);
                addedItems.push(swordName);
                localStorage.setItem('lastAddedItem', `${swordName}|${Date.now()}`);
            }
            
            if (foundMouse && !inventory.includes(mouseName)) {
                inventory.push(mouseName);
                addedItems.push(mouseName);
            }
            
            localStorage.setItem('winterAdventureInventory', JSON.stringify(inventory));
            
            let progress = JSON.parse(localStorage.getItem('adventProgress')) || {
                adventDays: {},
                totalDays: 5,
                lastUpdated: Date.now()
            };
            
            progress.adventDays['day1'] = {
                completed: true,
                completionDate: Date.now(),
                attempts: attempts,
                foundSword: true,
                foundMouse: foundMouse
            };
            
            localStorage.setItem('adventProgress', JSON.stringify(progress));
            
            if (addedItems.length > 0) {
                showInventoryNotification(addedItems);
            }
            
            console.log("‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!");
        }
        
        function showInventoryNotification(items) {
            const notification = document.getElementById('inventoryNotification');
            const itemsElement = document.getElementById('notificationItems');
            
            if (notification && itemsElement) {
                let itemsText = '';
                if (items.length === 2) {
                    itemsText = `${items[0]}<br>${items[1]}`;
                } else if (items.length === 1) {
                    itemsText = items[0];
                }
                
                itemsElement.innerHTML = itemsText;
                notification.style.display = 'block';
                
                setTimeout(hideInventoryNotification, 10000);
            }
        }
        
        function hideInventoryNotification() {
            const notification = document.getElementById('inventoryNotification');
            if (notification) {
                notification.style.animation = 'slideInNotification 0.5s ease-out reverse';
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.animation = 'slideInNotification 0.5s ease-out';
                }, 500);
            }
        }
        
        function endNovel() {
            const visualNovel = document.getElementById('visualNovel');
            const gameContainer = document.getElementById('gameContainer');
            
            if (visualNovel && gameContainer) {
                if (videoElement) {
                    videoElement.pause();
                    videoElement.src = '';
                    lastVideoPath = null;
                }
                
                visualNovel.style.display = 'none';
                
                if (isSwordFoundNovel) {
                    saveProgress();
                    
                    document.getElementById('resultWindow').style.display = 'block';
                    document.getElementById('continueBtn').innerHTML = `
                        <span style="position: absolute; left: 25px;">üéí</span>
                        <span style="margin-left: 30px;">–ü–ï–†–ï–ô–¢–ò –í –ò–ù–í–ï–ù–¢–ê–†–¨</span>
                        <span style="position: absolute; right: 25px;">‚ú®</span>
                    `;
                    
                    document.getElementById('continueBtn').onclick = function() {
                        soundManager.playPixelSound('inventory_open');
                        window.location.href = 'inventory.html';
                    };
                    
                } else {
                    gameContainer.style.display = 'block';
                    document.getElementById('resultWindow').style.display = 'none';
                    document.getElementById('gameOverWindow').style.display = 'none';
                    
                    if (!gameCompleted) {
                        startGame();
                    }
                }
            }
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            initAudio();
            createIntroParticles();
            initNovel();
            
            const startIntroBtn = document.getElementById('startIntroBtn');
            if (startIntroBtn) {
                startIntroBtn.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                startIntroBtn.addEventListener('click', () => {
                    soundManager.playPixelSound('menu_click');
                    startIntro();
                });
            }
            
            const rpgButtons = document.querySelectorAll('.rpg-button');
            rpgButtons.forEach(button => {
                button.addEventListener('mouseenter', () => soundManager.playPixelSound('hover'));
                button.addEventListener('click', () => soundManager.playPixelSound('button_press'));
            });
            
            if (!localStorage.getItem('winterAdventureInventory')) {
                localStorage.setItem('winterAdventureInventory', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('adventProgress')) {
                localStorage.setItem('adventProgress', JSON.stringify({
                    adventDays: {},
                    totalDays: 5,
                    lastUpdated: Date.now()
                }));
            }
            
            const dayCompleted = localStorage.getItem('day1_completed') === 'true';
            if (dayCompleted) {
                const introScreen = document.getElementById('introScreen');
                const gameContainer = document.getElementById('gameContainer');
                
                if (introScreen) introScreen.style.display = 'none';
                if (gameContainer) {
                    gameContainer.style.display = 'block';
                    
                    const attemptsUsed = localStorage.getItem('day1_attempts') || '?';
                    const swordFoundOn = localStorage.getItem('day1_sword_found_on') || '?';
                    const mouseFound = localStorage.getItem('mouse_found') === 'true';
                    
                    let inventory = JSON.parse(localStorage.getItem('winterAdventureInventory')) || [];
                    const hasSword = inventory.includes('–î—Ä–µ–≤–Ω–∏–π –ú–µ—á üó°Ô∏è');
                    const hasMouse = inventory.includes('–ú—ã—à–∫–∞ –Æ–º–∏ üê≠');
                    
                    const dialogueElement = document.querySelector('.npc-dialogue');
                    if (dialogueElement) {
                        dialogueElement.innerHTML = `
                            <div class="dialogue-text" style="color: #4CAF50;">
                                <div style="margin-bottom: 15px; font-size: 24px;">‚ú® –î–ï–ù–¨ 1 –ó–ê–í–ï–†–®–Å–ù ‚ú®</div>
                                <div style="margin-bottom: 10px;">
                                    ${hasSword ? 'üó°Ô∏è –î—Ä–µ–≤–Ω–∏–π –ú–µ—á –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ' : '‚ùå –ú–µ—á –Ω–µ –Ω–∞–π–¥–µ–Ω'}
                                </div>
                                ${mouseFound ? 
                                    `<div style="margin-bottom: 10px;">
                                        ${hasMouse ? 'üê≠ –ú—ã—à–∫–∞ –Æ–º–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ' : '‚ùå –Æ–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}
                                    </div>` 
                                    : ''
                                }
                            </div>
                        `;
                    }
                    
                    const searchContainer = document.querySelector('.search-field-container');
                    if (searchContainer) {
                        searchContainer.style.opacity = '0.5';
                        searchContainer.style.pointerEvents = 'none';
                        searchContainer.innerHTML = 
                            '<div style="text-align: center; padding: 50px; color: #90a4ae;">–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</div>';
                    }
                    
                    const attemptsElement = document.getElementById('attempts');
                    const foundElement = document.getElementById('found');
                    
                    if (attemptsElement) attemptsElement.textContent = `${attemptsUsed}/${config.maxAttempts}`;
                    if (foundElement) {
                        foundElement.textContent = mouseFound ? '2/2' : '1/2';
                        foundElement.style.color = mouseFound ? '#4CAF50' : '#FFB74D';
                    }
                }
            } else {
                document.getElementById('resultWindow').style.display = 'none';
                document.getElementById('gameOverWindow').style.display = 'none';
            }
            
            const notificationClose = document.querySelector('.notification-close');
            if (notificationClose) {
                notificationClose.addEventListener('click', hideInventoryNotification);
            }
        });
    </script>
</body>
</html>