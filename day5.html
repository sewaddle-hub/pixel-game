<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ù–∏–∫–∞ - –î–µ–Ω—å 5</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', cursive;
        }
        
        body {
            background: #0a001a;
            color: #e0d0ff;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-image: url('img/Fon day 5 ylica.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }
        
        body.castle-bg {
            background-image: url('img/Fon day5 zamok.png');
        }
        
        body.final-bg {
            background-image: url('img/Fon day 5 ylica.png');
            animation: finalGlow 3s infinite alternate;
        }
        
        @keyframes finalGlow {
            0% { background-color: rgba(10, 0, 26, 0.3); }
            100% { background-color: rgba(154, 0, 255, 0.1); }
        }
        
        .game-container {
            background: rgba(10, 0, 26, 0.85);
            border: 3px solid #8a2be2;
            border-radius: 10px;
            padding: 20px;
            max-width: 1000px;
            width: 100%;
            max-height: 95vh;
            box-shadow: 0 0 30px rgba(154, 0, 255, 0.7);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .scene {
            display: none;
            flex-direction: column;
            gap: 20px;
            flex: 1;
            min-height: 0;
        }
        .scene.active {
            display: flex;
        }
        
        /* –ó–∞—Å—Ç–∞–≤–∫–∞ */
        .title-scene {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 30px;
            padding: 40px;
        }
        
        .title-text {
            color: #ffcc00;
            font-size: 28px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
            margin-bottom: 10px;
            animation: titlePulse 2s infinite;
        }
        
        @keyframes titlePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .subtitle {
            color: #00ffff;
            font-size: 16px;
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #4b0082, #8a2be2);
            border: 3px solid #00ffff;
            color: white;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .start-btn:hover {
            background: linear-gradient(45deg, #8a2be2, #ff00ff);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.7);
        }
        
        /* –£–í–ï–õ–ò–ß–ï–ù–ù–´–ô –í–ò–î–ï–û-–ö–û–ù–¢–ï–ô–ù–ï–† */
        .video-container {
            width: 100%;
            height: 450px;
            border: 3px solid #8a2be2;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
            flex-shrink: 0;
        }
        
        .video-frame {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .dialog-box {
            background: rgba(20, 0, 40, 0.95);
            border: 3px solid #8a2be2;
            border-radius: 8px;
            padding: 20px;
            min-height: 120px;
            flex-shrink: 0;
        }
        
        .dialog-text {
            font-size: 14px;
            line-height: 1.6;
            color: #f0e0ff;
            min-height: 60px;
        }
        
        .character {
            color: #ff00ff;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        
        .response {
            color: #00ffff;
            font-style: italic;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-shrink: 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #4b0082, #8a2be2);
            border: 2px solid #00ffff;
            color: white;
            padding: 12px 25px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .btn:hover {
            background: linear-gradient(45deg, #8a2be2, #ff00ff);
            transform: scale(1.05);
        }
        
        .qte-game-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .attack-theme {
            color: #ff5555;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .qte-progress-container {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ff5555;
            border-radius: 8px;
            padding: 10px;
        }
        
        .qte-progress-text {
            text-align: center;
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #330000;
            border: 1px solid #ff0000;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff9900);
            width: 0%;
            transition: width 0.2s;
        }
        
        .qte-keys {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .qte-key {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #550000, #220000);
            border: 3px solid #880000;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #ff6666;
            cursor: pointer;
            transition: 0.1s;
        }
        
        .qte-key.active {
            background: radial-gradient(circle, #ff0000, #990000);
            border-color: #ff9900;
            transform: scale(1.1);
            color: white;
        }
        
        .qte-key.pressed {
            background: radial-gradient(circle, #00ff00, #009900);
            border-color: #00ff00;
            transform: scale(1.05);
            color: white;
        }
        
        .qte-timer {
            color: #ffcc00;
            text-align: center;
            margin-top: 10px;
        }
        
        .focus-scene {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
        }
        
        .focus-main-text {
            color: #ffcc00;
            text-align: center;
            font-size: 20px;
        }
        
        .focus-area {
            width: 90%;
            max-width: 400px;
            height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .hold-button {
            width: 180px;
            height: 70px;
            background: linear-gradient(45deg, #008800, #00aa00);
            border: 3px solid #00ff00;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            z-index: 2;
        }
        
        .hold-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 10px;
            background: linear-gradient(90deg, #ffff00, #ffcc00);
        }
        
        .hold-phrase {
            position: absolute;
            color: #aaffaa;
            font-size: 12px;
            animation: floatUp 2s ease-out forwards;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
        
        .choice-scene {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .choice-title {
            color: #ffcc00;
            text-align: center;
            font-size: 18px;
        }
        
        .memories-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .memory-choice {
            width: 120px;
            height: 120px;
            background: rgba(0, 100, 0, 0.7);
            border: 2px solid #00ff00;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            padding: 10px;
        }
        
        .memory-choice:hover {
            background: rgba(0, 200, 0, 0.8);
            transform: scale(1.05);
        }
        
        .memory-choice.selected {
            background: rgba(255, 255, 0, 0.9);
            border-color: #ffff00;
            transform: scale(1.08);
        }
        
        .memory-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .memory-label {
            font-size: 10px;
            color: white;
            text-align: center;
        }
        
        .retry-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .retry-modal.active {
            display: flex;
        }
        
        .retry-box {
            background: rgba(20, 0, 40, 0.95);
            border: 3px solid #ff5555;
            border-radius: 10px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
        }
        
        .retry-title {
            color: #ffcc00;
            margin-bottom: 15px;
        }
        
        .retry-btn {
            background: linear-gradient(45deg, #ff0000, #ff5500);
            border: 2px solid #ffcc00;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .typing-cursor {
            display: inline-block;
            width: 6px;
            height: 14px;
            background-color: #ff00ff;
            margin-left: 2px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .instruction-box {
            background: rgba(0, 50, 100, 0.9);
            border: 3px solid #00ffff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }
        
        .instruction-text {
            color: #aaffff;
            font-size: 12px;
            line-height: 1.5;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º */
        .sound-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }
        
        .sound-btn {
            background: rgba(20, 0, 40, 0.8);
            border: 2px solid #8a2be2;
            color: #00ffff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: 0.3s;
        }
        
        .sound-btn:hover {
            background: rgba(40, 0, 80, 0.9);
            transform: scale(1.1);
        }
        
        .sound-btn.muted {
            color: #ff5555;
            border-color: #ff5555;
        }
        
        /* –ú–∏–∫—à–µ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç–∏ */
        .volume-mixer {
            background: rgba(20, 0, 40, 0.9);
            border: 2px solid #8a2be2;
            border-radius: 10px;
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 10px;
            min-width: 200px;
            box-shadow: 0 0 20px rgba(154, 0, 255, 0.5);
        }
        
        .volume-mixer.active {
            display: flex;
        }
        
        .volume-control {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .volume-label {
            color: #00ffff;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .volume-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #330066;
            border-radius: 4px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #8a2be2;
            border-radius: 50%;
            border: 2px solid #00ffff;
            cursor: pointer;
        }
        
        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #8a2be2;
            border-radius: 50%;
            border: 2px solid #00ffff;
            cursor: pointer;
        }
        
        .final-message {
            color: #ffcc00;
            text-align: center;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
            animation: pulse 2s infinite;
            margin: 20px 0;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .home-text {
            color: #aaffaa;
            text-align: center;
            font-size: 14px;
            line-height: 1.6;
            margin: 15px 0;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, #008080, #00cccc);
            border: 2px solid #00ffff;
            color: white;
            padding: 12px 25px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .menu-btn:hover {
            background: linear-gradient(45deg, #00cccc, #00ffff);
            transform: scale(1.05);
        }
        
        /* –û–∫–æ—à–∫–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è - –ë–û–õ–¨–®–û–ï –ò –ü–û –¶–ï–ù–¢–†–£ */
        .congrats-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .congrats-modal.active {
            display: flex;
        }
        
        .congrats-box {
            background: linear-gradient(135deg, rgba(20, 0, 40, 0.98), rgba(10, 0, 26, 0.98));
            border: 6px solid #ffcc00;
            border-radius: 20px;
            padding: 40px 35px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            text-align: center;
            box-shadow: 0 0 80px rgba(255, 204, 0, 0.7), 0 0 40px rgba(255, 0, 255, 0.5);
            animation: congratsAppear 1s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        @keyframes congratsAppear {
            0% {
                transform: scale(0.7);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .congrats-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #ffcc00, #ff00ff, #00ffff, #ffcc00);
            z-index: -1;
            border-radius: 25px;
            opacity: 0.3;
            animation: borderGlow 4s linear infinite;
        }
        
        @keyframes borderGlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        .congrats-title {
            color: #ffcc00;
            font-size: 32px;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 204, 0, 0.9);
            line-height: 1.3;
            padding-bottom: 15px;
            border-bottom: 3px solid rgba(255, 204, 0, 0.3);
            animation: titleGlow 3s infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 0 0 15px rgba(255, 204, 0, 0.7); }
            100% { text-shadow: 0 0 25px rgba(255, 204, 0, 1), 0 0 15px rgba(255, 0, 255, 0.5); }
        }
        
        .congrats-message-container {
            flex: 1;
            overflow-y: auto;
            padding: 0 10px 15px 0;
            margin-bottom: 20px;
            max-height: 55vh;
        }
        
        .congrats-message-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .congrats-message-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }
        
        .congrats-message-container::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ffcc00, #ff9900);
            border-radius: 4px;
        }
        
        .congrats-message {
            color: #ffcc99;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 25px;
            text-align: left;
            padding: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border-left: 6px solid #ffcc00;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .congrats-message ul {
            padding-left: 30px;
            margin: 20px 0;
        }
        
        .congrats-message li {
            margin-bottom: 12px;
            font-size: 16px;
            line-height: 1.6;
            color: #aaffff;
            position: relative;
        }
        
        .congrats-message li::before {
            content: '‚ú®';
            position: absolute;
            left: -25px;
            top: 0;
        }
        
        .congrats-message br {
            margin-bottom: 10px;
            display: block;
        }
        
        .congrats-signature {
            color: #ff00ff;
            font-size: 24px;
            text-align: right;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 3px solid rgba(255, 204, 0, 0.3);
            animation: signatureGlow 3s infinite alternate;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.7);
        }
        
        @keyframes signatureGlow {
            0% { 
                text-shadow: 0 0 10px rgba(255, 0, 255, 0.7);
                transform: translateX(0);
            }
            100% { 
                text-shadow: 0 0 20px rgba(255, 0, 255, 1), 0 0 10px rgba(255, 204, 0, 0.5);
                transform: translateX(-10px);
            }
        }
        
        .close-congrats-btn {
            background: linear-gradient(45deg, #4b0082, #8a2be2);
            border: 4px solid #ffcc00;
            color: white;
            padding: 18px 50px;
            font-size: 16px;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.5);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .close-congrats-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }
        
        .close-congrats-btn:hover {
            background: linear-gradient(45deg, #8a2be2, #ff00ff);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.8);
        }
        
        .close-congrats-btn:hover::before {
            left: 100%;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 900px) {
            .congrats-box {
                max-width: 95%;
                padding: 30px 25px;
                max-height: 90vh;
            }
            
            .congrats-title {
                font-size: 28px;
                margin-bottom: 20px;
            }
            
            .congrats-message {
                font-size: 16px;
                padding: 20px;
                line-height: 1.7;
            }
            
            .congrats-message li {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .congrats-signature {
                font-size: 20px;
                margin-top: 20px;
            }
            
            .close-congrats-btn {
                padding: 15px 30px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 600px) {
            .congrats-box {
                padding: 25px 20px;
                width: 98%;
            }
            
            .congrats-title {
                font-size: 24px;
                margin-bottom: 15px;
            }
            
            .congrats-message {
                font-size: 14px;
                padding: 15px;
                line-height: 1.6;
            }
            
            .congrats-message-container {
                max-height: 60vh;
            }
            
            .congrats-message li {
                font-size: 13px;
                margin-bottom: 8px;
            }
            
            .congrats-signature {
                font-size: 18px;
                margin-top: 15px;
                padding-top: 15px;
            }
            
            .close-congrats-btn {
                padding: 12px 25px;
                font-size: 13px;
            }
            
            .game-container {
                padding: 15px;
                max-height: 90vh;
            }
            
            .video-container {
                height: 300px;
            }
        }
        
        @media (max-height: 700px) {
            .congrats-box {
                max-height: 85vh;
            }
            
            .congrats-message-container {
                max-height: 50vh;
            }
        }
    </style>
</head>
<body id="page-body">
    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º -->
    <div class="sound-control">
        <div class="sound-btn" id="sound-btn" onclick="toggleSoundPanel()" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º">‚ô™</div>
        <div class="volume-mixer" id="volume-mixer">
            <div class="volume-control">
                <div class="volume-label">
                    <span>–≠–º–±–∏–µ–Ω—Ç</span>
                    <span id="ambient-volume-value">50%</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="volume-slider" id="ambient-volume">
            </div>
            <div class="volume-control">
                <div class="volume-label">
                    <span>QTE –ú—É–∑—ã–∫–∞</span>
                    <span id="qte-volume-value">50%</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="volume-slider" id="qte-volume">
            </div>
            <div class="volume-control">
                <div class="volume-label">
                    <span>–ó–≤—É–∫–∏ –∫–Ω–æ–ø–æ–∫</span>
                    <span id="sfx-volume-value">70%</span>
                </div>
                <input type="range" min="0" max="100" value="70" class="volume-slider" id="sfx-volume">
            </div>
        </div>
    </div>
    
    <!-- –û–∫–æ—à–∫–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è - –ë–û–õ–¨–®–û–ï –ò –ü–û –¶–ï–ù–¢–†–£ -->
    <div class="congrats-modal" id="congrats-modal">
        <div class="congrats-box">
            <div class="congrats-title">üéÑ –° –ù–û–í–´–ú –ì–û–î–û–ú! üéÑ</div>
            
            <div class="congrats-message-container">
                <div class="congrats-message">
                    –î–æ—Ä–æ–≥–æ–π –ù–∏–∫–∏—Ç–∞,<br><br>
                    
                    –≠—Ç–æ—Ç –≥–æ–¥ –±—ã–ª —Ä–∞–∑–Ω—ã–º, –∏ —Ç—è–∂–µ–ª—ã–º –∏ –∏–Ω–æ–≥–¥–∞ —Ä–∞–¥–æ—Å—Ç–Ω—ã–º. –ö–∞–∫ –∏ –ª—é–±–æ–π –ø—É—Ç—å. –ù–æ —Ç—ã –ø—Ä–æ—à—ë–ª –µ–≥–æ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–∂–∏–ª, –∞ –ø—Ä–æ–∂–∏–ª.<br><br>
                    
                    –¢—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª—Å—è –ª–∏—Ü–æ–º –∫ –ª–∏—Ü—É —Å–æ —Å–≤–æ–∏–º–∏ —Ç–µ–Ω—è–º–∏, –ø—Ä–∏–Ω—è–ª —Å–≤–æ–∏ –Ω–µ—É–¥–∞—á–∏ –∫–∞–∫ —á–∞—Å—Ç—å –ø—É—Ç–∏, –∏ –≤ —ç—Ç–æ–º ‚Äî –Ω–∞—Å—Ç–æ—è—â–∞—è —Å–∏–ª–∞. –ö–∞–∂–¥—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ –≤–ø–µ—Ä—ë–¥, –∫–∞–∂–¥–∞—è –ø—Ä–µ–æ–¥–æ–ª—ë–Ω–Ω–∞—è —Ç—Ä—É–¥–Ω–æ—Å—Ç—å, –∫–∞–∂–¥–∞—è —É–ª—ã–±–∫–∞ —Å–∫–≤–æ–∑—å —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ ‚Äî –≤—Å—ë —ç—Ç–æ –∏ –µ—Å—Ç—å –∂–∏–∑–Ω—å.<br><br>
                    
                    –ü—É—Å—Ç—å –≤ –Ω–æ–≤–æ–º –≥–æ–¥—É —Ç—ã:
                    <ul>
                        <li>–ß–∞—â–µ –±—É–¥–µ—à—å –≤–∏–¥–µ—Ç—å —Å–≤–µ—Ç —Ç–∞–º, –≥–¥–µ —Ä–∞–Ω—å—à–µ –∑–∞–º–µ—á–∞–ª —Ç–æ–ª—å–∫–æ —Ç–µ–º–Ω–æ—Ç—É</li>
                        <li>–ü–æ–º–Ω–∏—Ç—å, —á—Ç–æ —Ç–≤–æ—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Å–ø–µ—Ö–æ–≤ –∏–ª–∏ –Ω–µ—É–¥–∞—á</li>
                        <li>–ü–æ–∑–≤–æ–ª–∏—à—å —Å–µ–±–µ –±—ã—Ç—å —Å–æ–±–æ–π - –∏ —è –ø—Ä–∏–º—É —Ç–µ–±—è –ª—é–±—ã–º</li>
                        <li>–ù–∞–π–¥–µ—à—å —Ä–∞–¥–æ—Å—Ç—å –≤ –ø—Ä–æ—Å—Ç—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –∂–∏–∑–Ω—å –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–π</li>
                    </ul>
                    
                    –¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å –≤—Å–µ–≥–æ —Ö–æ—Ä–æ—à–µ–≥–æ. –¢—ã –¥–æ—Å—Ç–æ–∏–Ω –ª—é–±–≤–∏. –¢—ã ‚Äî —ç—Ç–æ —Ç—ã, –∏ –≤ —ç—Ç–æ–º —Ç–≤–æ—è —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è —Å–∏–ª–∞.<br><br>
                    
                    –ü—É—Å—Ç—å –Ω–æ–≤—ã–π –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å—ë—Ç —Ç–µ–±–µ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –º–µ—á—Ç—ã, –Ω–æ –∏ —Å–∏–ª—ã –¥–ª—è –∏—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è, –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã, –Ω–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏–¥—Ç–∏ –∫ –Ω–∏–º. –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —Å–º—ã—Å–ª–æ–º, —Ç–µ–ø–ª–æ–º –∏ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —á—É–¥–µ—Å–∞–º–∏.
                </div>
            </div>
            
            <div class="congrats-signature">
                –Ø –ª—é–±–ª—é —Ç–µ–±—è,<br>
                —Ç–≤–æ—è –Æ–º–∏ üíñ
            </div>
            <button class="close-congrats-btn" onclick="closeCongrats()">‚ù§Ô∏è –°–ü–ê–°–ò–ë–û, –Æ–ú–ò!</button>
        </div>
    </div>
    
    <div class="game-container">
        <!-- –°—Ü–µ–Ω–∞ 0: –ó–∞—Å—Ç–∞–≤–∫–∞ -->
        <div class="scene active" id="scene0">
            <div class="title-scene">
                <div class="title-text">–î–µ–Ω—å 5</div>
                <div class="subtitle">–§–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–∏—Å–∫–∏ –¢–µ–Ω–∏</div>
                <div class="subtitle">–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ù–∏–∫–∞</div>
                <div style="color: #ffaaaa; font-size: 12px; margin-top: 30px; line-height: 1.8; max-width: 600px;">
                    –ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–æ—á—å –≥–æ–¥–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –∫–æ–Ω—Ü—É.<br>
                    –ù–∏–∫ –∏ –Æ–º–∏ —Å—Ç–æ—è—Ç –Ω–∞ –ø–æ—Ä–æ–≥–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø—ã—Ç–∞–Ω–∏—è.<br>
                    –¢–µ–Ω—å, –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è—é—â–∞—è –≤—Å–µ –Ω–µ—É–¥–∞—á–∏ –≥–æ–¥–∞, –∂–¥—ë—Ç –∏—Ö –≤ –∑–∞–º–∫–µ.<br>
                    –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è —Å –Ω–µ–π –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è...
                </div>
                <button class="start-btn" onclick="startGame()">–ù–ê–ß–ê–¢–¨</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 1 -->
        <div class="scene" id="scene1">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Yumi y kostra.mp4" type="video/mp4">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-1" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-1" onclick="nextReplique(1)">–í—Å—Ç–∞—Ç—å</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 2 -->
        <div class="scene" id="scene2">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Pyt k zamky.mp4" type="video/mp4">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-2" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-2" onclick="nextReplique(2)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 3 -->
        <div class="scene" id="scene3">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Pyt k zamky.mp4" type="video/mp4">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-3" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-3" onclick="nextReplique(3)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 4 -->
        <div class="scene" id="scene4">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Vorota otkrity.mp4" type="video/mp4">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-4" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-4" onclick="nextReplique(4)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 5 (–¢–µ–Ω—å –≥–æ–≤–æ—Ä–∏—Ç "–ù–∏–∫") -->
        <div class="scene" id="scene5">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten na trone.mp4" type="video/mp4">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-5" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-5" onclick="nextReplique(5)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 6 -->
        <div class="scene" id="scene6">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten idet.mp4" type="video/mp4">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-6" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-6" onclick="nextReplique(6)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 7: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–µ—Ä–µ–¥ QTE -->
        <div class="scene" id="scene7">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten atakyet.mp4.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            
            <div class="dialog-box">
                <div class="instruction-box">
                    <div class="instruction-text">
                        ‚öîÔ∏è –°–ï–ô–ß–ê–° –ù–ê–ß–ù–Å–¢–°–Ø –ú–ò–ù–ò-–ò–ì–†–ê ‚öîÔ∏è<br><br>
                        –ë—ã—Å—Ç—Ä–æ –Ω–∞–∂–∏–º–∞–π –ø–æ—è–≤–ª—è—é—â–∏–µ—Å—è –∫–Ω–æ–ø–∫–∏ Q, T, E,<br>
                        —á—Ç–æ–±—ã –æ—Ç–±–∏—Ç—å –∞—Ç–∞–∫–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –º—ã—Å–ª–µ–π.<br>
                        –£ —Ç–µ–±—è –µ—Å—Ç—å 60 —Å–µ–∫—É–Ω–¥!
                    </div>
                </div>
                
                <div id="dialog-text-7" class="dialog-text">
                    <span class="character">–¢–µ–Ω—å:</span> –¢—ã —Ç–∞–∫ –¥–µ–ª–∞–ª –≤–µ—Å—å –≥–æ–¥...
                </div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-7" onclick="startQTEGame()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 8: QTE –§–∞–∑–∞ 1 -->
        <div class="scene" id="scene8">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline id="game-video">
                    <source src="video/Ten atakyet.mp4.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            
            <div class="dialog-box">
                <div class="qte-game-container">
                    <div class="qte-phase1 active" id="qte-phase1">
                        <div class="attack-theme">‚öîÔ∏è –û–¢–ë–ï–ô –ù–ï–£–î–ê–ß–ò –ò –°–¢–†–ê–•–ò ‚öîÔ∏è</div>
                        
                        <div class="qte-progress-container">
                            <div class="qte-progress-text">
                                –û–¢–ë–ò–¢–û –ê–¢–ê–ö: <span id="qte-score">0</span> / <span id="qte-target">20</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                        </div>
                        
                        <div class="qte-keys" id="qte-keys">
                            <div class="qte-key" id="key-Q" onclick="handleQTEClick('Q')">
                                Q
                                <div style="font-size: 10px; margin-top: 5px;">–ë–´–°–¢–†–û –†–ï–ê–ì–ò–†–£–ô</div>
                            </div>
                            <div class="qte-key" id="key-T" onclick="handleQTEClick('T')">
                                T
                                <div style="font-size: 10px; margin-top: 5px;">–ü–†–û–¢–ò–í–û–°–¢–û–ô</div>
                            </div>
                            <div class="qte-key" id="key-E" onclick="handleQTEClick('E')">
                                E
                                <div style="font-size: 10px; margin-top: 5px;">–í–´–î–ï–†–ñ–ö–ê</div>
                            </div>
                        </div>
                        
                        <div class="qte-timer" id="qte-timer">‚è± –û–°–¢–ê–õ–û–°–¨: 60 –°–ï–ö</div>
                        
                        <div id="phase1-dialog" class="dialog-text">
                            <span class="character">–¢–µ–Ω—å:</span> –ö–∞–∂–¥–∞—è –Ω–µ—É–¥–∞—á–∞ –ø—ã—Ç–∞–ª–∞—Å—å —Å–ª–æ–º–∏—Ç—å —Ç–µ–±—è...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 9: QTE –§–∞–∑–∞ 2 -->
        <div class="scene" id="scene9">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten letaet vokryg.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            
            <div class="dialog-box">
                <div class="focus-scene active" id="focus-scene">
                    <div class="focus-main-text">–°–û–°–†–ï–î–û–¢–û–ß–¨–°–Ø –ù–ê –í–ê–ñ–ù–û–ú</div>
                    
                    <div class="focus-area">
                        <div style="text-align: center; margin-bottom: 15px; color: #aaffaa;">
                            –£–¥–µ—Ä–∂–∏–≤–∞–π –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –æ—Å–º—ã—Å–ª–∏—Ç—å –∏ –æ—Ç–ø—É—Å—Ç–∏—Ç—å
                        </div>
                        
                        <div class="hold-button" id="hold-button" onmousedown="startHold()" onmouseup="stopHold()" ontouchstart="startHold()" ontouchend="stopHold()">
                            –£–î–ï–†–ñ–ò–í–ê–ô
                            <div class="hold-progress" id="hold-progress"></div>
                        </div>
                    </div>
                    
                    <div id="focus-dialog" class="dialog-text">
                        <span class="character">–¢–µ–Ω—å:</span> –ù–µ –≤—Å—ë –±—ã–ª–æ —Ç–≤–æ–µ–π –≤–∏–Ω–æ–π...
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 10: –í—ã–±–æ—Ä –ø–∞–º—è—Ç–∏ -->
        <div class="scene" id="scene10">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten letaet vokryg.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            
            <div class="dialog-box">
                <div class="choice-scene active" id="choice-scene">
                    <div class="choice-title">üåü –í–´–ë–ï–†–ò –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï üåü</div>
                    
                    <div id="choice-dialog" class="dialog-text">
                        <span class="character">–Æ–º–∏:</span> –í—ã–±–µ—Ä–∏ —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å...
                    </div>
                    
                    <div class="memories-container" id="memories-container">
                        <!-- –ü–∞–º—è—Ç–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 11 -->
        <div class="scene" id="scene11">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten yspokoilas.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-11" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-11" onclick="nextReplique(11)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 12: –¢–µ–Ω—å —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è -->
        <div class="scene" id="scene12">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Ten rastvoryaetsya.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-12" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-12" onclick="nextReplique(12)">–î–∞–ª–µ–µ</button>
            </div>
        </div>

        <!-- –°—Ü–µ–Ω–∞ 13: –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –¥–æ–º–æ–π -->
        <div class="scene" id="scene13">
            <div class="video-container">
                <video class="video-frame" autoplay muted loop playsinline>
                    <source src="video/Final Tmy.mp4" type="video/mp4" onerror="handleVideoError(this)">
                </video>
            </div>
            <div class="dialog-box">
                <div id="dialog-text-13" class="dialog-text"></div>
            </div>
            <div class="controls">
                <button class="btn" id="next-btn-13" onclick="nextReplique(13)">–î–∞–ª–µ–µ</button>
            </div>
        </div>
    </div>

    <!-- –û–∫–æ—à–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ -->
    <div class="retry-modal" id="retry-modal">
        <div class="retry-box">
            <div class="retry-title">‚è± –í–†–ï–ú–Ø –í–´–®–õ–û!</div>
            <div style="color: #ffaaaa; margin-bottom: 20px;">
                –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!
            </div>
            <button class="retry-btn" onclick="retryQTE()">–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê</button>
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ –¥–ª—è —ç–º–±–∏–µ–Ω—Ç–∞ -->
    <audio id="ambient-audio" loop>
        <source src="audio/Floating Thru Space (Ambient Music For Sleep) - An Angel's Caress [audiovk.com].mp3" type="audio/mp3">
        <source src="audio/ambient.ogg" type="audio/ogg">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
    </audio>

    <!-- –ê—É–¥–∏–æ –¥–ª—è QTE –∏–≥—Ä—ã -->
    <audio id="qte-audio" loop>
        <!-- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –∞—É–¥–∏–æ—Ñ–∞–π–ª –¥–ª—è QTE -->
        <source src="audio/qte-music.mp3" type="audio/mp3">
        <source src="audio/qte-music.ogg" type="audio/ogg">
    </audio>

    <!-- –ó–≤—É–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ -->
    <audio id="btn-sound" preload="auto">
        <source src="audio/button-click.mp3" type="audio/mp3">
        <source src="audio/button-click.ogg" type="audio/ogg">
    </audio>
    
    <audio id="qte-hit-sound" preload="auto">
        <source src="audio/qte-hit.mp3" type="video/mp3">
        <source src="audio/qte-hit.ogg" type="audio/ogg">
    </audio>
    
    <audio id="select-sound" preload="auto">
        <source src="audio/select.mp3" type="audio/mp3">
        <source src="audio/select.ogg" type="audio/ogg">
    </audio>

    <script>
        const repliques = {
            1: [
                {char: "–Æ–º–∏:", text: "–ù–∏–∫‚Ä¶ —Ç—ã –ø—Ä–æ—Å–Ω—É–ª—Å—è."},
                {char: "", text: "...", resp: "(–ù–∏–∫ –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞)"},
                {char: "–ù–∏–∫:", text: "–Æ–º–∏? –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?"},
                {char: "–Æ–º–∏:", text: "–ú–Ω–µ —Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ –¥–∞–ª—å—à–µ —É–∂–µ –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –∏–¥—Ç–∏."},
                {char: "–ù–∏–∫:", text: "–ù–æ –º—ã –∏–¥—ë–º, –≤–µ—Ä–Ω–æ?"},
                {char: "–Æ–º–∏:", text: "–î–∞. –ú—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–π–¥—ë–º.", resp: "(–ö–æ—Å—Ç–µ—Ä –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –≥–∞—Å–Ω–µ—Ç)"}
            ],
            2: [
                {char: "–ù–∏–∫:", text: "–ß—Ç–æ —ç—Ç–æ —Ç–∞–º, –≤–¥–∞–ª–µ–∫–µ?"},
                {char: "–Æ–º–∏:", text: "–ù–∏–∫‚Ä¶ —Ç–∞–º –Ω–µ –≤–∏–¥–Ω–æ –Ω–∏ —Å—Ç–µ–Ω, –Ω–∏ —Å—Ç—Ä–∞–∂–µ–π."},
                {char: "–ù–∏–∫:", text: "–°—Ç—Ä–∞–Ω–Ω–æ‚Ä¶ –±—É–¥—Ç–æ –æ–Ω –∂–¥—ë—Ç."},
                {char: "–Æ–º–∏:", text: "–û–Ω–∞ –Ω–µ –ø—Ä—è—á–µ—Ç—Å—è. –û–Ω–∞ –∂–¥—ë—Ç –Ω–µ –≥–æ—Å—Ç—è‚Ä¶ –∞ —Ç–µ–±—è.", resp: "(–§–∏–æ–ª–µ—Ç–æ–≤—ã–µ –º–æ–ª–Ω–∏–∏ –æ—á–µ—Ä—á–∏–≤–∞—é—Ç —Å–∏–ª—É—ç—Ç)"}
            ],
            3: [
                {char: "–ù–∏–∫:", text: "–Æ–º–∏, —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å?"},
                {char: "–Æ–º–∏:", text: "–î–∞‚Ä¶ —ç—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ. –ù–∏ –æ–¥–Ω–∞ –¢–µ–Ω—å —Ä–∞–Ω—å—à–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–ª–∞ –ø–æ–¥–æ–π—Ç–∏ —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ.", resp: "(–ó–µ–º–ª—è –ø—É–ª—å—Å–∏—Ä—É–µ—Ç –ø–æ–¥ –Ω–æ–≥–∞–º–∏)"},
                {char: "–ù–∏–∫:", text: "–ë—É–¥—Ç–æ –æ–Ω–∞ –∑–Ω–∞–ª–∞, —á—Ç–æ –º—ã –ø—Ä–∏–¥—ë–º."},
                {char: "–Æ–º–∏:", text: "–ù–µ –º—ã‚Ä¶ —Ç—ã. –û–Ω–∞ –∂–¥–∞–ª–∞ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è."}
            ],
            4: [
                {char: "–ù–∏–∫:", text: "–í–æ—Ä–æ—Ç–∞ –æ—Ç–∫—Ä—ã—Ç—ã‚Ä¶"},
                {char: "–Æ–º–∏:", text: "–û–Ω–∞ –∂–¥–∞–ª–∞.", resp: "(–ú–µ—Ç–∞–ª–ª –≤–æ—Ä–æ—Ç —Ö–æ–ª–æ–¥–Ω—ã–π, –Ω–æ –Ω–µ –ª–µ–¥–µ–Ω—è—â–∏–π)"},
                {char: "–ù–∏–∫:", text: "–Ø –ø–æ–º–Ω—é‚Ä¶ –∫–∞–∫ –±–æ—è–ª—Å—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –¥–≤–µ—Ä–µ–π."},
                {char: "–Æ–º–∏:", text: "–ê —Ç–µ–ø–µ—Ä—å –æ–Ω–∏ —Ä–∞—Å–ø–∞—Ö–Ω—É—Ç—ã."},
                {char: "–ù–∏–∫:", text: "–¢–µ–ø–µ—Ä—å —è –Ω–µ –±–æ—é—Å—å.", resp: "(–ò –≤–Ω—É—Ç—Ä–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ç—ã —Å–∞–º)"}
            ],
            5: [
                {char: "–¢–µ–Ω—å:", text: "–ù–∏–∫."},
                {char: "–ù–∏–∫:", text: "–¢—ã‚Ä¶"},
                {char: "–¢–µ–Ω—å:", text: "–Ø –Ω–µ —Å—Ç–∞–≤–∏–ª–∞ –ø—Ä–µ–≥—Ä–∞–¥. –ù–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ.", resp: "(–ù–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–æ–º –ø–æ–ª—É –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –æ–±–±–∞)"},
                {char: "–ù–∏–∫:", text: "–ü–æ—á–µ–º—É?"},
                {char: "–¢–µ–Ω—å:", text: "–¢—ã –±—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ—à—ë–ª. –Ø –∑–Ω–∞–ª–∞ ‚Äî —Ç—ã –ø—Ä–∏–¥—ë—à—å –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–æ—á—å –≥–æ–¥–∞."}
            ],
            6: [
                {char: "–¢–µ–Ω—å:", text: "–Ø ‚Äî –≤—Å—ë, —á—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –∑–∞ —ç—Ç–æ—Ç –≥–æ–¥.", resp: "(–¢—Ä–æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç–∞—è—Ç—å)"},
                {char: "–ù–∏–∫:", text: "–í—Å–µ –Ω–µ—É–¥–∞—á–∏‚Ä¶"},
                {char: "–¢–µ–Ω—å:", text: "–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏, –≥–¥–µ —Ç—ã –¥–µ–ª–∞–ª –º–∞–∫—Å–∏–º—É–º‚Ä¶ –Ω–æ —ç—Ç–æ–≥–æ –æ–∫–∞–∑–∞–ª–æ—Å—å –º–∞–ª–æ."},
                {char: "–ù–∏–∫:", text: "–ò –≤—Å–µ –º–æ–º–µ–Ω—Ç—ã, –≥–¥–µ —è –≤–∏–Ω–∏–ª —Å–µ–±—è‚Ä¶"},
                {char: "–¢–µ–Ω—å:", text: "–°–∏–ª—å–Ω–µ–µ, —á–µ–º –Ω—É–∂–Ω–æ. –î–∞.", resp: "(–ò —É—Ç—Ä–æ, –Ω–∞—á–∏–Ω–∞–≤—à–µ–µ—Å—è —Å —ç—Ç–æ–π –º—ã—Å–ª–∏)"}
            ],
            7: [
                {char: "–¢–µ–Ω—å:", text: "–¢—ã —Ç–∞–∫ –¥–µ–ª–∞–ª –≤–µ—Å—å –≥–æ–¥...", resp: "(–≥–æ—Ç–æ–≤—å—Å—è –∫ –±–æ—Ä—å–±–µ)"}
            ],
            11: [
                {char: "–¢–µ–Ω—å:", text: "–Ø –∂–¥–∞–ª–∞‚Ä¶"},
                {char: "–ù–∏–∫:", text: "–ß–µ–≥–æ?"},
                {char: "–¢–µ–Ω—å:", text: "–ß—Ç–æ–±—ã —Ç—ã –±–æ–ª—å—à–µ –Ω–µ –Ω—ë—Å —ç—Ç–æ –æ–¥–∏–Ω.", resp: "(–ï—ë –≥–æ–ª–æ—Å —Å—Ç–∞–ª —Ç–∏—à–µ –∏ –º—è–≥—á–µ)"},
                {char: "–ù–∏–∫:", text: "–ù–æ —ç—Ç–æ –∂–µ –º–æ—è –±–æ–ª—å‚Ä¶"},
                {char: "–¢–µ–Ω—å:", text: "–ö–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–≤–æ–µ–π. –¢—ã –¥–µ–ª–∏–ª –µ—ë —Å –º–∏—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–∂–µ —Å—Ç–∞—Ä–∞–ª—Å—è."}
            ],
            12: [
                {char: "–Æ–º–∏:", text: "–¢–µ–Ω—å —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è‚Ä¶", resp: "(–ó–æ–ª–æ—Ç–æ–π —Å–≤–µ—Ç –Ω–∞–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ª)"},
                {char: "–ù–∏–∫:", text: "–û–Ω–∞‚Ä¶ —É—Ö–æ–¥–∏—Ç."},
                {char: "–Æ–º–∏:", text: "–ù–µ—Ç. –û–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—å—é —Ç–µ–±—è.", resp: "(–°–≤–µ—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Ä—á–µ)"},
                {char: "–ù–∏–∫:", text: "–ë–æ–ª—å—à–µ –Ω–µ –∫–∞–∫ —Ç—è–∂–µ—Å—Ç—å‚Ä¶"},
                {char: "–Æ–º–∏:", text: "–ê –∫–∞–∫ –æ–ø—ã—Ç. –ö–∞–∫ –ø—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø—Ä–æ—à—ë–ª."}
            ],
            13: [
                {char: "", text: "–ò—Ö —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–æ –¥–æ–º–æ–π, –≤ –¥–µ—Ä–µ–≤–Ω—é –£–≥–æ–ª—å–Ω–æ–µ –°–µ—Ä–¥—Ü–µ.", resp: "(–í–æ–∫—Ä—É–≥ –∑–Ω–∞–∫–æ–º—ã–µ —Å—Ç–µ–Ω—ã –∏ —Ç–µ–ø–ª—ã–π —Å–≤–µ—Ç)"},
                {char: "–Æ–º–∏:", text: "–ú—ã‚Ä¶ –¥–æ–º–∞."},
                {char: "–ù–∏–∫:", text: "–ú–∏—Ä –¢–µ–Ω–∏ —Ä–∞—Å—Ç–≤–æ—Ä–∏–ª—Å—è."},
                {char: "–Æ–º–∏:", text: "–ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –ø—Ä–∏–Ω—è–ª –µ—ë. –ù–µ –∫–∞–∫ –≤—Ä–∞–≥–∞‚Ä¶"},
                {char: "–ù–∏–∫:", text: "–ê –∫–∞–∫ —á–∞—Å—Ç—å —Å–µ–±—è."},
                {char: "", text: "–° –ù–û–í–´–ú –ì–û–î–û–ú."},
                {char: "", text: "–ò –°–û –í–°–ï–ú, –ß–¢–û –í –ù–Å–ú –ë–£–î–ï–¢."}
            ]
        };

        let currentScene = 0;
        let currentReplique = {};
        let isTyping = false;
        let shadowAppeared = false;
        
        let qteScore = 0;
        let qteTarget = 20;
        let qteTime = 60;
        let qteInterval;
        let attackInterval;
        let activeKey = null;
        
        let holdProgress = 0;
        let holdInterval;
        let isHolding = false;
        let selectedMemory = null;
        let holdPhrases = ["–Ø —Å–º–æ–≥—É", "–≠—Ç–æ –ø—Ä–æ–π–¥—ë—Ç", "–Ø —Å–ø—Ä–∞–≤–ª—é—Å—å", "–Ø –¥–æ—Å—Ç–æ–∏–Ω", "–í—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ", "–Ø —Å–∏–ª—å–Ω–µ–µ"];
        
        // –ê—É–¥–∏–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let ambientAudio = document.getElementById('ambient-audio');
        let qteAudio = document.getElementById('qte-audio');
        let btnSound = document.getElementById('btn-sound');
        let qteHitSound = document.getElementById('qte-hit-sound');
        let selectSound = document.getElementById('select-sound');
        let isSoundOn = true;
        let ambientVolume = 0.5;
        let qteVolume = 0.5;
        let sfxVolume = 0.7;
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ (–∫–∞–∫ –≤ –ø–µ—Ä–≤–æ–π –∏–≥—Ä–µ)
        let audioContext;
        let pixelSoundEnabled = true;

        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Web Audio API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                pixelSoundEnabled = false;
            }
        }

        function playPixelSound(type) {
            if (!pixelSoundEnabled || !audioContext || !isSoundOn) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            let frequency = 440, duration = 0.1;
            
            switch(type) {
                case 'click': frequency = 220 + Math.random() * 110; duration = 0.05; break;
                case 'step': frequency = 150 + Math.random() * 50; duration = 0.08; break;
                case 'success': frequency = 880; duration = 0.2; break;
                case 'fail': frequency = 110; duration = 0.3; break;
                case 'hover': frequency = 330; duration = 0.03; break;
                case 'menu_click': frequency = 550; duration = 0.1; break;
                case 'select': frequency = 660; duration = 0.15; break;
                case 'qte_hit': frequency = 440 + Math.random() * 220; duration = 0.1; break;
            }
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.1 * sfxVolume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        const memories = [
            {emoji: "‚ú®", label: "–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã"},
            {emoji: "‚ù§Ô∏è", label: "–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ"},
            {emoji: "üåü", label: "–õ–∏—á–Ω—ã–π —Ä–æ—Å—Ç"},
            {emoji: "ü§ù", label: "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–ª–∏–∑–∫–∏—Ö"}
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            initAudio();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–µ—Ä–æ–≤ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            setupVolumeControls();
            
            // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —ç–º–±–∏–µ–Ω—Ç–∞ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–∏–∫—à–µ—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', (e) => {
                const mixer = document.getElementById('volume-mixer');
                const soundBtn = document.getElementById('sound-btn');
                if (mixer && soundBtn && !mixer.contains(e.target) && !soundBtn.contains(e.target)) {
                    mixer.classList.remove('active');
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤—É–∫–∏ –Ω–∞ –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn') || 
                    e.target.classList.contains('start-btn') || 
                    e.target.classList.contains('retry-btn') ||
                    e.target.classList.contains('menu-btn') ||
                    e.target.classList.contains('close-congrats-btn')) {
                    playButtonSound();
                    playPixelSound('click');
                    
                    // –ï—Å–ª–∏ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ
                    if (audioContext && audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                }
            });
            
            // –ó–≤—É–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ (–∫–∞–∫ –≤ –ø–µ—Ä–≤–æ–π –∏–≥—Ä–µ)
            document.querySelectorAll('.btn, .start-btn, .retry-btn, .menu-btn, .qte-key, .memory-choice, .hold-button, .close-congrats-btn').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    playPixelSound('hover');
                });
            });
        });

        function setupVolumeControls() {
            const ambientSlider = document.getElementById('ambient-volume');
            const qteSlider = document.getElementById('qte-volume');
            const sfxSlider = document.getElementById('sfx-volume');
            const ambientValue = document.getElementById('ambient-volume-value');
            const qteValue = document.getElementById('qte-volume-value');
            const sfxValue = document.getElementById('sfx-volume-value');
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            const savedAmbient = localStorage.getItem('ambientVolume');
            const savedQTE = localStorage.getItem('qteVolume');
            const savedSFX = localStorage.getItem('sfxVolume');
            
            if (savedAmbient) {
                ambientVolume = parseFloat(savedAmbient);
                ambientSlider.value = ambientVolume * 100;
                ambientValue.textContent = `${Math.round(ambientVolume * 100)}%`;
            }
            
            if (savedQTE) {
                qteVolume = parseFloat(savedQTE);
                qteSlider.value = qteVolume * 100;
                qteValue.textContent = `${Math.round(qteVolume * 100)}%`;
            }
            
            if (savedSFX) {
                sfxVolume = parseFloat(savedSFX);
                sfxSlider.value = sfxVolume * 100;
                sfxValue.textContent = `${Math.round(sfxVolume * 100)}%`;
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
            ambientSlider.addEventListener('input', function() {
                ambientVolume = this.value / 100;
                ambientValue.textContent = `${this.value}%`;
                if (ambientAudio) {
                    ambientAudio.volume = ambientVolume;
                }
                localStorage.setItem('ambientVolume', ambientVolume);
            });
            
            qteSlider.addEventListener('input', function() {
                qteVolume = this.value / 100;
                qteValue.textContent = `${this.value}%`;
                if (qteAudio) {
                    qteAudio.volume = qteVolume;
                }
                localStorage.setItem('qteVolume', qteVolume);
            });
            
            sfxSlider.addEventListener('input', function() {
                sfxVolume = this.value / 100;
                sfxValue.textContent = `${this.value}%`;
                localStorage.setItem('sfxVolume', sfxVolume);
            });
        }

        function playButtonSound() {
            if (btnSound && isSoundOn) {
                btnSound.volume = sfxVolume;
                btnSound.currentTime = 0;
                btnSound.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –∫–Ω–æ–ø–∫–∏:", e));
            }
        }

        function playQTESound() {
            if (qteHitSound && isSoundOn) {
                qteHitSound.volume = sfxVolume;
                qteHitSound.currentTime = 0;
                qteHitSound.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è QTE –∑–≤—É–∫–∞:", e));
            }
            // –¢–∞–∫–∂–µ –∏–≥—Ä–∞–µ–º –ø–∏–∫—Å–µ–ª—å–Ω—ã–π –∑–≤—É–∫
            playPixelSound('qte_hit');
        }

        function playSelectSound() {
            if (selectSound && isSoundOn) {
                selectSound.volume = sfxVolume;
                selectSound.currentTime = 0;
                selectSound.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤—ã–±–æ—Ä–∞:", e));
            }
            // –¢–∞–∫–∂–µ –∏–≥—Ä–∞–µ–º –ø–∏–∫—Å–µ–ª—å–Ω—ã–π –∑–≤—É–∫
            playPixelSound('select');
        }

        function toggleSoundPanel() {
            const mixer = document.getElementById('volume-mixer');
            const soundBtn = document.getElementById('sound-btn');
            
            if (mixer.classList.contains('active')) {
                mixer.classList.remove('active');
            } else {
                mixer.classList.add('active');
            }
        }

        function playAmbient() {
            if (ambientAudio && isSoundOn) {
                ambientAudio.volume = ambientVolume;
                ambientAudio.play().catch(e => {
                    console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —ç–º–±–∏–µ–Ω—Ç–∞:", e);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
                    document.getElementById('sound-btn').textContent = '‚ñ∂Ô∏è';
                    document.getElementById('sound-btn').title = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞';
                });
            }
        }

        function playQTEMusic() {
            if (qteAudio && isSoundOn) {
                qteAudio.volume = qteVolume;
                qteAudio.currentTime = 0;
                qteAudio.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è QTE –º—É–∑—ã–∫–∏:", e));
            }
            
            // –ü—Ä–∏–≥–ª—É—à–∞–µ–º —ç–º–±–∏–µ–Ω—Ç –≤–æ –≤—Ä–µ–º—è QTE
            if (ambientAudio) {
                ambientAudio.volume = ambientVolume * 0.3;
            }
        }

        function stopQTEMusic() {
            if (qteAudio) {
                qteAudio.pause();
                qteAudio.currentTime = 0;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –≥—Ä–æ–º–∫–æ—Å—Ç—å —ç–º–±–∏–µ–Ω—Ç–∞
            if (ambientAudio && isSoundOn) {
                ambientAudio.volume = ambientVolume;
                if (ambientAudio.paused) {
                    ambientAudio.play();
                }
            }
        }

        function handleVideoError(videoElement) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:", videoElement.src);
            videoElement.style.display = 'none';
            videoElement.parentElement.style.background = '#000';
            videoElement.parentElement.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">–í–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å</div>';
        }

        function setBackground(type) {
            const body = document.getElementById('page-body');
            if (type === 'street') {
                body.classList.remove('castle-bg', 'final-bg');
            } else if (type === 'castle') {
                body.classList.remove('final-bg');
                body.classList.add('castle-bg');
            } else if (type === 'final') {
                body.classList.remove('castle-bg');
                body.classList.add('final-bg');
            }
        }

        function typeText(element, text, callback) {
            if (isTyping) return;
            isTyping = true;
            
            element.innerHTML = '';
            
            let i = 0;
            let currentHTML = '';
            
            function processNextChar() {
                if (i < text.length) {
                    const char = text.charAt(i);
                    currentHTML += char;
                    element.innerHTML = currentHTML + '<span class="typing-cursor"></span>';
                    i++;
                    setTimeout(processNextChar, 10);
                } else {
                    element.innerHTML = currentHTML;
                    isTyping = false;
                    if (callback) callback();
                }
            }
            
            processNextChar();
        }

        function showReplique(sceneNum, index) {
            if (!repliques[sceneNum]) return;
            if (index >= repliques[sceneNum].length) return;
            
            const replique = repliques[sceneNum][index];
            const dialogBox = document.getElementById(`dialog-text-${sceneNum}`);
            const nextBtn = document.getElementById(`next-btn-${sceneNum}`);
            
            if (!dialogBox) return;
            nextBtn.style.display = 'none';
            
            let htmlContent = '';
            if (replique.char) {
                htmlContent += `<span class="character">${replique.char}</span> `;
            }
            htmlContent += replique.text;
            if (replique.resp) {
                htmlContent += `<div class="response">${replique.resp}</div>`;
            }
            
            typeText(dialogBox, htmlContent, () => {
                nextBtn.style.display = 'block';
            });
            
            currentReplique[sceneNum] = index;
            
            if (sceneNum === 5 && index === 0 && replique.char === "–¢–µ–Ω—å:" && replique.text === "–ù–∏–∫.") {
                if (!shadowAppeared) {
                    shadowAppeared = true;
                    // –§–æ–Ω –∑–∞–º–∫–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¢–û–õ–¨–ö–û –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏ –¢–µ–Ω–∏
                    setTimeout(() => {
                        setBackground('castle');
                    }, 500);
                }
            }
        }

        function startGame() {
            playPixelSound('menu_click');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —ç–º–±–∏–µ–Ω—Ç
            if (ambientAudio && isSoundOn) {
                ambientAudio.volume = ambientVolume;
                ambientAudio.play().catch(e => {
                    console.log("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —ç–º–±–∏–µ–Ω—Ç–∞:", e);
                });
            }
            
            goToScene(1);
        }

        function nextReplique(sceneNum) {
            if (isTyping) {
                const dialogBox = document.getElementById(`dialog-text-${sceneNum}`);
                const replique = repliques[sceneNum][currentReplique[sceneNum] || 0];
                
                if (replique) {
                    let htmlContent = '';
                    if (replique.char) {
                        htmlContent += `<span class="character">${replique.char}</span> `;
                    }
                    htmlContent += replique.text;
                    if (replique.resp) {
                        htmlContent += `<div class="response">${replique.resp}</div>`;
                    }
                    
                    dialogBox.innerHTML = htmlContent;
                    isTyping = false;
                    const nextBtn = document.getElementById(`next-btn-${sceneNum}`);
                    nextBtn.style.display = 'block';
                }
                return;
            }
            
            const currentIndex = currentReplique[sceneNum] || 0;
            const nextIndex = currentIndex + 1;
            
            if (nextIndex < repliques[sceneNum].length) {
                showReplique(sceneNum, nextIndex);
            } else {
                if (sceneNum === 1) {
                    // –ü–æ—Å–ª–µ —Å—Ü–µ–Ω—ã 1 –º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É "–í—Å—Ç–∞—Ç—å" –Ω–∞ "–î–∞–ª–µ–µ" –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω
                    document.getElementById('next-btn-2').textContent = '–î–∞–ª–µ–µ';
                    document.getElementById('next-btn-3').textContent = '–î–∞–ª–µ–µ';
                    document.getElementById('next-btn-4').textContent = '–î–∞–ª–µ–µ';
                    document.getElementById('next-btn-5').textContent = '–î–∞–ª–µ–µ';
                    document.getElementById('next-btn-6').textContent = '–î–∞–ª–µ–µ';
                    goToScene(2);
                } else if (sceneNum === 6) {
                    goToScene(7);
                } else if (sceneNum === 10) {
                    goToScene(11);
                } else if (sceneNum === 13) {
                    // –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
                    document.getElementById('dialog-text-13').innerHTML = `
                        <div class="home-text">
                            –ú–∏—Ä –¢–µ–Ω–∏ —Ä–∞—Å—Ç–≤–æ—Ä–∏–ª—Å—è, –∏ –∏—Ö —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–æ –¥–æ–º–æ–π,<br>
                            –≤ –¥–µ—Ä–µ–≤–Ω—é –£–≥–æ–ª—å–Ω–æ–µ –°–µ—Ä–¥—Ü–µ. –í—Å—ë —Ö–æ—Ä–æ—à–æ.
                        </div>
                        <div class="final-message">–° –ù–û–í–´–ú –ì–û–î–û–ú</div>
                        <div class="final-message" style="font-size: 20px;">–ò –°–û –í–°–ï–ú, –ß–¢–û –í –ù–Å–ú –ë–£–î–ï–¢</div>
                    `;
                    document.querySelector('#scene13 .controls').innerHTML = `
                        <button class="btn" onclick="showCongrats()">‚ù§Ô∏è –ü–†–û–ß–ò–¢–ê–¢–¨ –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–ï –û–¢ –Æ–ú–ò</button>
                    `;
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω
                    setBackground('final');
                } else {
                    goToScene(sceneNum + 1);
                }
            }
        }

        function showCongrats() {
            playPixelSound('select');
            document.getElementById('congrats-modal').classList.add('active');
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –∑–≤—É–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
            playPixelSound('success');
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Å–æ–æ–±—â–µ–Ω–∏—è
            const congratsContainer = document.querySelector('.congrats-message-container');
            if (congratsContainer) {
                congratsContainer.scrollTop = 0;
            }
        }

        function closeCongrats() {
            playPixelSound('click');
            document.getElementById('congrats-modal').classList.remove('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é
            document.querySelector('#scene13 .controls').innerHTML = `
                <a href="index1.html" class="menu-btn">–í–ï–†–ù–£–¢–¨–°–Ø –í –ú–ï–ù–Æ</a>
                <button class="btn" onclick="restartGame()">–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û</button>
            `;
        }

        function goToScene(num) {
            if (qteInterval) clearInterval(qteInterval);
            if (attackInterval) clearInterval(attackInterval);
            if (holdInterval) clearInterval(holdInterval);
            
            qteScore = 0;
            qteTime = 60;
            holdProgress = 0;
            isHolding = false;
            selectedMemory = null;
            
            document.querySelectorAll('.video-frame').forEach(video => {
                video.pause();
            });
            
            document.querySelectorAll('.scene').forEach(scene => {
                scene.classList.remove('active');
            });
            
            // –í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï —Å–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏
            // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥—Ä—É–≥–æ–π —Å—Ü–µ–Ω–µ (num –Ω–µ —Ä–∞–≤–µ–Ω 0)
            if (num !== 0 && num !== 13) {
                document.getElementById('congrats-modal').classList.remove('active');
            }
            
            currentScene = num;
            const nextScene = document.getElementById(`scene${num}`);
            if (!nextScene) return;
            
            nextScene.classList.add('active');
            
            const video = nextScene.querySelector('.video-frame');
            if (video) {
                video.currentTime = 0;
                video.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ:", e));
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ü–µ–Ω—ã
            if (num >= 8 && num <= 9) {
                // QTE —Å—Ü–µ–Ω—ã - –≤–∫–ª—é—á–∞–µ–º –±–æ–µ–≤—É—é –º—É–∑—ã–∫—É
                playQTEMusic();
            } else {
                // –û–±—ã—á–Ω—ã–µ —Å—Ü–µ–Ω—ã - –≤—ã–∫–ª—é—á–∞–µ–º QTE –º—É–∑—ã–∫—É, –≤–∫–ª—é—á–∞–µ–º —ç–º–±–∏–µ–Ω—Ç
                stopQTEMusic();
                if (ambientAudio && isSoundOn && ambientAudio.paused) {
                    playAmbient();
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ü–µ–Ω—ã
                if (num === 13) {
                    // –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞
                    setBackground('final');
                } else if (num >= 5 && num <= 12) {
                    // –°—Ü–µ–Ω—ã —Å 5 –ø–æ 12 - –∑–∞–º–æ–∫
                    // –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ —Å—Ü–µ–Ω—ã 11 –∏ 12, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–±—ã—Ç—ã
                    setBackground('castle');
                } else if (num <= 4) {
                    // –°—Ü–µ–Ω—ã —Å 1 –ø–æ 4 - —É–ª–∏—Ü–∞
                    setBackground('street');
                }
            }
            
            if (num !== 0 && num !== 8 && num !== 9 && num !== 10) {
                currentReplique[num] = 0;
                showReplique(num, 0);
            }
            
            if (num === 10) {
                setTimeout(() => {
                    createMemories();
                }, 500);
            }
            
            document.getElementById('retry-modal').classList.remove('active');
        }

        function startQTEGame() {
            goToScene(8);
            startQTEPhase1();
        }

        function startQTEPhase1() {
            qteScore = 0;
            qteTime = 60;
            
            updateQTEStats();
            updateTimer();
            
            qteInterval = setInterval(() => {
                qteTime--;
                updateTimer();
                
                if (qteTime <= 0) {
                    clearInterval(qteInterval);
                    clearInterval(attackInterval);
                    stopQTEMusic();
                    
                    setTimeout(() => {
                        document.getElementById('retry-modal').classList.add('active');
                    }, 1000);
                }
            }, 1000);
            
            setTimeout(() => {
                activateRandomAttack();
            }, 500);
            
            attackInterval = setInterval(() => {
                activateRandomAttack();
            }, 1500);
        }

        function activateRandomAttack() {
            if (activeKey) {
                const keyElement = document.getElementById(`key-${activeKey}`);
                if (keyElement) {
                    keyElement.classList.remove('active');
                }
            }
            
            const keys = ['Q', 'T', 'E'];
            activeKey = keys[Math.floor(Math.random() * keys.length)];
            
            const keyElement = document.getElementById(`key-${activeKey}`);
            if (keyElement) {
                keyElement.classList.add('active');
                
                setTimeout(() => {
                    if (keyElement.classList.contains('active')) {
                        keyElement.classList.remove('active');
                        activeKey = null;
                    }
                }, 1200);
            }
        }

        function handleQTEClick(key) {
            const keyElement = document.getElementById(`key-${key}`);
            if (!keyElement) return;
            
            if (keyElement.classList.contains('active')) {
                keyElement.classList.remove('active');
                keyElement.classList.add('pressed');
                
                qteScore++;
                playQTESound(); // –ó–≤—É–∫ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏
                
                setTimeout(() => {
                    keyElement.classList.remove('pressed');
                }, 200);
                
                updateQTEStats();
                
                if (qteScore >= qteTarget) {
                    clearInterval(qteInterval);
                    clearInterval(attackInterval);
                    stopQTEMusic();
                    setTimeout(() => {
                        playPixelSound('success');
                        goToScene(9);
                    }, 1000);
                }
            }
        }

        function handleKeyPress(event) {
            const key = event.key.toUpperCase();
            if (key === 'Q' || key === 'T' || key === 'E') {
                handleQTEClick(key);
            }
        }

        function updateQTEStats() {
            document.getElementById('qte-score').textContent = qteScore;
            
            const progress = (qteScore / qteTarget) * 100;
            const fillElement = document.getElementById('progress-fill');
            if (fillElement) {
                fillElement.style.width = `${Math.min(100, progress)}%`;
            }
        }

        function updateTimer() {
            const timerElement = document.getElementById('qte-timer');
            if (timerElement) {
                timerElement.textContent = `‚è± –û–°–¢–ê–õ–û–°–¨: ${qteTime} –°–ï–ö`;
            }
        }

        function retryQTE() {
            document.getElementById('retry-modal').classList.remove('active');
            startQTEPhase1();
        }

        function createHoldPhrase() {
            if (!isHolding) return;
            
            const focusArea = document.querySelector('.focus-area');
            if (!focusArea) return;
            
            const phrase = holdPhrases[Math.floor(Math.random() * holdPhrases.length)];
            const phraseElement = document.createElement('div');
            phraseElement.className = 'hold-phrase';
            phraseElement.textContent = phrase;
            
            const x = Math.random() * (focusArea.offsetWidth - 60) + 30;
            const y = Math.random() * (focusArea.offsetHeight - 30) + 15;
            
            phraseElement.style.left = `${x}px`;
            phraseElement.style.top = `${y}px`;
            
            focusArea.appendChild(phraseElement);
            
            setTimeout(() => {
                phraseElement.remove();
            }, 2000);
        }

        function startHold() {
            if (isHolding) return;
            
            isHolding = true;
            const holdButton = document.getElementById('hold-button');
            holdButton.classList.add('holding');
            
            holdInterval = setInterval(() => {
                if (isHolding) {
                    holdProgress += 1.5;
                    if (holdProgress >= 100) {
                        holdProgress = 100;
                        clearInterval(holdInterval);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
                        holdButton.textContent = '‚úì –û–°–ú–´–°–õ–ï–ù–û!';
                        holdButton.style.cursor = 'default';
                        holdButton.style.background = 'linear-gradient(45deg, #00aa00, #00ff00)';
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            playPixelSound('success');
                            goToScene(10);
                        }, 1500);
                    }
                    
                    const holdProgressBar = document.getElementById('hold-progress');
                    if (holdProgressBar) {
                        holdProgressBar.style.width = `${holdProgress}%`;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ—Ä–∞–∑—ã —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
                    if (Math.random() < 0.3) {
                        createHoldPhrase();
                    }
                }
            }, 50);
        }

        function stopHold() {
            if (!isHolding) return;
            
            isHolding = false;
            const holdButton = document.getElementById('hold-button');
            holdButton.classList.remove('holding');
            clearInterval(holdInterval);
        }

        function createMemories() {
            const container = document.getElementById('memories-container');
            container.innerHTML = '';
            
            const warningDiv = document.createElement('div');
            warningDiv.style.color = '#ffcc00';
            warningDiv.style.fontSize = '10px';
            warningDiv.style.marginBottom = '10px';
            warningDiv.style.textAlign = 'center';
            warningDiv.textContent = '–í—ã–±–µ—Ä–∏ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ';
            container.parentNode.insertBefore(warningDiv, container);
            
            memories.forEach((memory, index) => {
                const memoryElement = document.createElement('div');
                memoryElement.className = 'memory-choice';
                memoryElement.dataset.index = index;
                memoryElement.innerHTML = `
                    <div class="memory-emoji">${memory.emoji}</div>
                    <div class="memory-label">${memory.label}</div>
                `;
                
                memoryElement.onclick = function() {
                    playSelectSound(); // –ó–≤—É–∫ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–∞–º—è—Ç–∏
                    playPixelSound('select'); // –ü–∏–∫—Å–µ–ª—å–Ω—ã–π –∑–≤—É–∫
                    
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞
                    const allMemories = document.querySelectorAll('.memory-choice');
                    allMemories.forEach(m => m.classList.remove('selected'));
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
                    this.classList.add('selected');
                    selectedMemory = this;
                    
                    warningDiv.style.color = '#00ff00';
                    warningDiv.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${memory.label}`;
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        playPixelSound('menu_click');
                        goToScene(11);
                    }, 2000);
                };
                
                container.appendChild(memoryElement);
            });
        }

        function restartGame() {
            currentReplique = {};
            isTyping = false;
            shadowAppeared = false;
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ
            if (ambientAudio) {
                ambientAudio.currentTime = 0;
                ambientAudio.volume = ambientVolume;
                if (isSoundOn) {
                    ambientAudio.play();
                }
            }
            
            if (qteAudio) {
                qteAudio.pause();
                qteAudio.currentTime = 0;
                qteAudio.volume = qteVolume;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É "–í—Å—Ç–∞—Ç—å" –Ω–∞ –º–µ—Å—Ç–æ
            document.getElementById('next-btn-1').textContent = '–í—Å—Ç–∞—Ç—å';
            
            setBackground('street');
            goToScene(0); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –∑–∞—Å—Ç–∞–≤–∫–µ
        }
    </script>
</body>
</html>