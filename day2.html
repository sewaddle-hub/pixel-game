<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—â–µ—Ä–∞ –î—Ä–∞–∫–æ–Ω–∞: –¢–∏—Ö–∞—è –∫—Ä–∞–∂–∞</title>
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        background: #000 url('img/Fon day2 Peshchera.svg') no-repeat center center fixed;
        background-size: cover;
        color: #ffcc00;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        font-family: 'Press Start 2P', 'Courier New', Courier, monospace;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: -1;
    }

    /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏... */
    .game-title,
    .title-subtitle,
    .cutscene-text,
    .character-name,
    .dialogue-choice,
    .game-btn,
    .start-button,
    .cutscene-next-btn,
    .start-minigame-btn,
    .continue-btn,
    .hint-text,
    .stat-value,
    .alertness-percent,
    .event-description,
    .minigame-description,
    .stone-result-description,
    .choice-btn,
    .choice-details,
    .choice-outcome,
    .sound-toggle,
    #dragonStatus,
    #stepCounter,
    #alertnessPercent,
    #waitButton,
    #stepButton,
    #stoneButton,
    #startMinigameBtn,
    .minigame-title {
        font-family: 'Press Start 2P', 'Courier New', Courier, monospace !important;
        font-weight: normal;
        letter-spacing: 0.5px;
    }

    .choice-header,
    .event-title,
    .stone-result-title,
    .music-toggle,
    .volume-value {
        font-family: 'Orbitron', sans-serif !important;
        font-weight: bold;
    }

    .stat-title,
    .alertness-label {
        font-family: 'Press Start 2P', 'Courier New', Courier, monospace !important;
        font-weight: normal;
        letter-spacing: 0.5px;
    }

    .minigame-title {
        font-family: 'Press Start 2P', 'Courier New', Courier, monospace !important;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 1.8rem;
        margin-bottom: 15px;
        text-shadow: 0 0 10px #ff6600;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(255, 102, 0, 0.5);
        color: #ffcc00;
    }

    .pixel-border-video {
        border: 4px solid;
        border-image: 
            repeating-linear-gradient(
                45deg,
                #ffcc00 0px,
                #ff6600 10px,
                #cc3300 20px,
                #ffcc00 30px
            ) 10;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        border-radius: 0;
    }

    .pixel-filter {
        filter: 
            blur(0.5px) 
            contrast(1.2) 
            saturate(1.1);
    }
    
    .start-minigame-btn {
        background: linear-gradient(135deg, #8B4513, #A0522D);
        border: 4px solid #FFD700;
        color: #FFD700;
        padding: 20px 40px;
        font-size: 1.1rem;
        cursor: pointer;
        margin-top: 30px;
        border-radius: 10px;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
        letter-spacing: 2px;
        text-transform: uppercase;
        text-shadow: 2px 2px 0 #000;
        box-shadow: 0 5px 15px rgba(139, 69, 19, 0.5);
        animation: pulseGlow 2s infinite alternate;
    }

    @keyframes pulseGlow {
        0% {
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.5);
            transform: scale(1);
        }
        100% {
            box-shadow: 0 5px 25px rgba(139, 69, 19, 0.8), 0 0 30px rgba(255, 215, 0, 0.4);
            transform: scale(1.02);
        }
    }

    .start-minigame-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 25px rgba(139, 69, 19, 0.7), 0 0 40px rgba(255, 215, 0, 0.6);
        background: linear-gradient(135deg, #A0522D, #8B4513);
    }

    .start-minigame-btn:active {
        transform: translateY(0) scale(1);
    }

    .start-minigame-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .start-minigame-btn:hover::before {
        left: 100%;
    }
    
    .game-title {
        font-size: 2.5rem;
        margin-bottom: 30px;
        color: #ff6600;
        text-shadow: 0 0 15px #ff3300;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .title-subtitle,
    .cutscene-text,
    .event-description,
    .minigame-description,
    .hint-text,
    .stone-result-description {
        line-height: 1.6;
        font-size: 1rem;
    }
    
    .stat-title,
    .alertness-label,
    .choice-header {
        font-size: 0.9rem;
    }
    
    .stat-value,
    .alertness-percent {
        font-size: 1.2rem;
    }
    
    .game-container {
        width: 100%;
        max-width: 1400px;
        height: 95vh;
        max-height: 800px;
        display: flex;
        flex-direction: column;
    }
    
    .title-screen {
        text-align: center;
        padding: 40px;
        background: rgba(0, 0, 0, 0.9);
        border: 4px solid #8B4513;
        border-radius: 15px;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: radial-gradient(circle at center, #331100 0%, #000000 100%);
    }
    
    .title-subtitle {
        color: #ff9966;
        font-size: 1rem;
        margin-bottom: 30px;
        line-height: 1.6;
        max-width: 800px;
    }
    
    .start-button {
        background: linear-gradient(135deg, #8B4513, #A0522D);
        border: 3px solid #FFD700;
        color: #FFD700;
        padding: 20px 50px;
        font-size: 1.2rem;
        cursor: pointer;
        margin-top: 30px;
        border-radius: 8px;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
        letter-spacing: 1px;
        text-shadow: 1px 1px 0 #000;
        box-shadow: 0 4px 0 #5D2900;
    }
    
    .start-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 #5D2900;
        background: linear-gradient(135deg, #A0522D, #8B4513);
    }
    
    .start-button:active {
        transform: translateY(1px);
        box-shadow: 0 2px 0 #5D2900;
    }
    
    .cutscene-screen {
        display: none;
        flex: 1;
        flex-direction: column;
        background: #000;
        border: 4px solid #8B4513;
        border-radius: 10px;
        overflow: hidden;
        height: 100%;
        background: linear-gradient(to bottom, #1a0a0a, #331100);
    }
    
    .cutscene-video-container {
        flex: 1;
        min-height: 400px;
        background: #000;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .cutscene-video {
        width: 100%;
        height: 100%;
        max-height: 500px;
        object-fit: contain;
        display: none;
    }
    
    .cutscene-video.active {
        display: block;
    }
    
    .cutscene-text-container {
        flex: 0 0 auto;
        background: rgba(40, 10, 0, 0.95);
        border-top: 4px solid #8B4513;
        padding: 20px;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .cutscene-text {
        color: #ffcc99;
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 20px;
    }
    
    .character-name {
        color: #ff9966;
        font-size: 1rem;
        margin-bottom: 10px;
        display: block;
    }
    
    .cutscene-next-btn {
        background: linear-gradient(135deg, #8B4513, #A0522D);
        border: 3px solid #FFD700;
        color: #FFD700;
        padding: 15px 40px;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 8px;
        align-self: flex-end;
        transition: all 0.2s;
        letter-spacing: 1px;
        text-shadow: 1px 1px 0 #000;
        box-shadow: 0 4px 0 #5D2900;
    }
    
    .cutscene-next-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 #5D2900;
        background: linear-gradient(135deg, #A0522D, #8B4513);
    }
    
    .cutscene-next-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 0 #5D2900;
    }
    
    .dialogue-choices {
        display: none;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .dialogue-choice {
        background: rgba(102, 0, 0, 0.7);
        border: 3px solid #ff6600;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: left;
        line-height: 1.4;
        color: white;
        font-size: 0.8rem;
    }
    
    .dialogue-choice:hover {
        transform: translateY(-3px);
        border-color: #ffcc00;
        box-shadow: 0 5px 20px rgba(255, 102, 0, 0.4);
        background: rgba(153, 0, 0, 0.7);
    }
    
    .game-scene {
        display: none;
        flex: 1;
        flex-direction: row;
        background: #000;
        border: 4px solid #8B4513;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        background: linear-gradient(to right, #1a0a0a, #331100);
    }
    
    .video-column {
        flex: 0 0 65%;
        position: relative;
        background: #000;
    }
    
    .dragon-video-main {
        width: 100%;
        height: 100%;
        position: relative;
        background: #000;
        max-height: 600px;
        width: 95%;
    }
    
    .dragon-video-wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .dragon-video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: none;
    }
    
    .dragon-video.active {
        display: block;
    }
    
    .video-fallback {
        color: #ff6600;
        font-size: 2rem;
        text-align: center;
        display: none;
    }
    
    .ui-column {
        flex: 0 0 35%;
        background: rgba(20, 0, 0, 0.95);
        border-left: 4px solid #8B4513;
        padding: 20px;
        display: flex;
        flex-direction: column;
    }
    
    .game-stats {
        background: rgba(255, 102, 0, 0.1);
        padding: 15px;
        border-radius: 8px;
        border: 2px solid rgba(255, 102, 0, 0.3);
        margin-bottom: 15px;
    }
    
    .stat-title {
        color: #ff9966;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .stat-value {
        color: #ffcc00;
        font-size: 1.2rem;
        margin-bottom: 5px;
    }
    
    .alertness-container {
        margin-top: 10px;
    }
    
    .alertness-label {
        color: #ff9966;
        font-size: 0.9rem;
        margin-bottom: 5px;
        display: block;
    }
    
    .alertness-bar {
        width: 100%;
        height: 20px;
        background: #330000;
        border: 2px solid #ff6600;
        border-radius: 4px;
        overflow: hidden;
        position: relative;
        margin-bottom: 5px;
    }
    
    .alertness-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #660000, #ff3300);
        transition: width 0.5s;
    }
    
    .alertness-percent {
        color: #ffcc00;
        font-size: 1.2rem;
        display: block;
        text-align: right;
        padding-right: 5px;
        margin-top: 5px;
    }
    
    .hint-box {
        background: rgba(255, 107, 107, 0.1);
        padding: 20px;
        border-radius: 10px;
        border: 3px solid rgba(255, 107, 107, 0.3);
        margin-bottom: 15px;
        min-height: 140px;
        display: flex;
        align-items: center;
        gap: 25px;
    }
    
    .yumi-icon {
        width: 140px;
        height: 140px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        border: 3px solid rgba(255, 102, 0, 0.7);
        overflow: hidden;
        position: relative;
    }
    
    .yumi-icon::before {
        content: '';
        position: absolute;
        top: -5px;
        left: -5px;
        right: -5px;
        bottom: -5px;
        background: linear-gradient(45deg, #ff6600, #ffcc00, #ff6600);
        border-radius: 12px;
        z-index: -1;
        opacity: 0.3;
        animation: glowBorder 3s infinite alternate;
    }
    
    @keyframes glowBorder {
        from { opacity: 0.2; }
        to { opacity: 0.5; }
    }
    
    .yumi-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 0 5px rgba(255, 204, 0, 0.5));
        transition: all 0.3s ease;
    }
    
    .hint-text {
        color: white;
        font-size: 1rem;
        line-height: 1.5;
        transition: all 0.3s;
        flex: 1;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        border-left: 4px solid rgba(255, 102, 0, 0.5);
    }
    
    .controls {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .control-row {
        display: flex;
        gap: 10px;
    }
    
    .game-btn {
        flex: 1;
        padding: 15px;
        background: linear-gradient(135deg, #8B4513, #A0522D);
        border: 3px solid #FFD700;
        color: #FFD700;
        font-size: 0.8rem;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
        letter-spacing: 1px;
        text-shadow: 1px 1px 0 #000;
        box-shadow: 0 4px 0 #5D2900;
    }
    
    .game-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%);
        transition: width 0.3s, height 0.3s;
    }
    
    .game-btn:active::before {
        width: 200px;
        height: 200px;
    }
    
    .game-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 #5D2900;
        background: linear-gradient(135deg, #A0522D, #8B4513);
    }
    
    .game-btn:active:not(:disabled) {
        transform: translateY(1px);
        box-shadow: 0 2px 0 #5D2900;
    }
    
    .game-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        background: linear-gradient(135deg, #444444, #222222);
        border-color: #666666;
        box-shadow: 0 2px 0 #222222;
    }
    
    .stone-btn {
        background: linear-gradient(135deg, #666666, #333333);
        border: 3px solid #999999;
        box-shadow: 0 4px 0 #222222;
    }
    
    .stone-btn:disabled {
        background: linear-gradient(135deg, #444444, #222222);
        border-color: #666666;
        box-shadow: 0 2px 0 #222222;
    }
    
    .event-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        padding: 20px;
    }
    
    .event-box {
        background: linear-gradient(135deg, rgba(30, 15, 0, 0.95), rgba(20, 10, 0, 0.95));
        border: 4px solid #ff6600;
        border-radius: 15px;
        padding: 25px;
        max-width: 700px;
        width: 95%;
        text-align: center;
        box-shadow: 0 0 40px rgba(255, 102, 0, 0.7);
    }
    
    .event-title {
        color: #ffcc00;
        font-size: 1.5rem;
        margin-bottom: 15px;
        text-shadow: 0 0 10px #ff6600;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(255, 102, 0, 0.5);
    }
    
    .event-description {
        color: #ffcc99;
        font-size: 0.9rem;
        margin-bottom: 25px;
        line-height: 1.6;
        background: rgba(0, 0, 0, 0.4);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 102, 0, 0.3);
    }
    
    .choices-comparison {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
    }
    
    .choice-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-radius: 10px;
        overflow: hidden;
        border: 3px solid transparent;
    }
    
    .choice-column.risky {
        border-color: #FF9800;
        background: rgba(255, 152, 0, 0.1);
    }
    
    .choice-column.safe {
        border-color: #4CAF50;
        background: rgba(76, 175, 80, 0.1);
    }
    
    .choice-header {
        padding: 15px;
        font-weight: bold;
        font-size: 0.9rem;
    }
    
    .risky .choice-header {
        background: linear-gradient(135deg, #FF9800, #F57C00);
        color: #000000;
    }
    
    .safe .choice-header {
        background: linear-gradient(135deg, #4CAF50, #2E7D32);
        color: #000000;
    }
    
    .choice-details {
        padding: 15px;
        text-align: left;
        flex-grow: 1;
        color: #ffffff;
        font-size: 0.8rem;
        line-height: 1.5;
    }
    
    .choice-details ul {
        list-style: none;
        padding-left: 0;
        margin: 10px 0;
    }
    
    .choice-details li {
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
    }
    
    .choice-details li::before {
        content: '‚Ä¢';
        position: absolute;
        left: 0;
        color: #ffcc00;
    }
    
    .choice-outcome {
        padding: 10px;
        font-size: 0.8rem;
        font-weight: bold;
        border-top: 2px solid rgba(255, 255, 255, 0.2);
        color: #ffffff;
    }
    
    .risky .choice-outcome {
        background: rgba(255, 152, 0, 0.2);
    }
    
    .safe .choice-outcome {
        background: rgba(76, 175, 80, 0.2);
    }
    
    .choice-buttons {
        display: flex;
        gap: 15px;
    }
    
    .choice-btn {
        flex: 1;
        padding: 18px;
        font-size: 0.9rem;
        cursor: pointer;
        border-radius: 8px;
        border: 3px solid;
        transition: all 0.2s;
        font-weight: bold;
        letter-spacing: 1px;
        box-shadow: 0 4px 0 rgba(0,0,0,0.3);
    }
    
    .choice-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 rgba(0,0,0,0.3);
    }
    
    .choice-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 0 rgba(0,0,0,0.3);
    }
    
    .btn-risky {
        background: linear-gradient(135deg, #FF9800, #F57C00);
        border-color: #FFB74D;
        color: #000000;
    }
    
    .btn-risky:hover {
        background: linear-gradient(135deg, #FFB74D, #FF9800);
        box-shadow: 0 6px 0 rgba(255, 152, 0, 0.6);
    }
    
    .btn-safe {
        background: linear-gradient(135deg, #4CAF50, #2E7D32);
        border-color: #81C784;
        color: #000000;
    }
    
    .btn-safe:hover {
        background: linear-gradient(135deg, #66BB6A, #4CAF50);
        box-shadow: 0 6px 0 rgba(76, 175, 80, 0.6);
    }
    
    .risk-badge {
        display: inline-block;
        background: #ff3333;
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        margin-left: 5px;
    }
    
    .safe-badge {
        display: inline-block;
        background: #33cc33;
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        margin-left: 5px;
    }
    
    .shake {
        animation: shake 0.5s;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .pulse-success {
        animation: pulseSuccess 0.5s;
    }
    
    @keyframes pulseSuccess {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .pulse-fail {
        animation: pulseFail 0.5s;
    }
    
    @keyframes pulseFail {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .sound-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.8);
        border: 2px solid #ffcc00;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.8rem;
        z-index: 1000;
        transition: all 0.2s;
        letter-spacing: 1px;
    }
    
    .sound-toggle:hover {
        background: rgba(255,102,0,0.8);
        transform: translateY(-2px);
    }
    
    .pixel-border {
        image-rendering: pixelated;
        border-style: solid;
        border-width: 4px;
        border-image: repeating-linear-gradient(45deg, #ffcc00, #ff6600 10px) 10;
    }
    
    .btn-pixel {
        image-rendering: pixelated;
        position: relative;
    }
    
    .btn-pixel::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        right: -2px;
        bottom: -2px;
        background: rgba(0,0,0,0.3);
        z-index: -1;
        border-radius: 8px;
    }
    
    .glow {
        animation: glow 2s infinite alternate;
    }
    
    @keyframes glow {
        from { box-shadow: 0 0 10px #ff6600; }
        to { box-shadow: 0 0 20px #ffcc00, 0 0 30px #ff6600; }
    }
    
    .pixel-text {
        text-shadow: 2px 2px 0 #000,
                    -2px -2px 0 #000,
                    2px -2px 0 #000,
                    -2px 2px 0 #000;
    }
    
    .music-controls {
        position: absolute;
        top: 20px;
        right: 120px;
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0,0,0,0.8);
        padding: 10px 15px;
        border-radius: 8px;
        border: 2px solid #00ccff;
        z-index: 1000;
    }
    
    .music-toggle {
        background: transparent;
        border: none;
        color: white;
        padding: 0;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s;
        flex-shrink: 0;
    }
    
    .music-toggle:hover {
        color: #00ccff;
        transform: translateY(-2px);
    }
    
    .volume-slider-container {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 100px;
    }
    
    .volume-icon {
        color: white;
        font-size: 1rem;
        flex-shrink: 0;
    }
    
    .volume-slider {
        width: 100%;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        background: #330000;
        border-radius: 4px;
        border: 1px solid #00ccff;
        outline: none;
        cursor: pointer;
    }
    
    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: #00ccff;
        border-radius: 50%;
        border: 2px solid #ffffff;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 204, 255, 0.8);
    }
    
    .volume-slider::-moz-range-thumb {
        width: 18px;
        height: 18px;
        background: #00ccff;
        border-radius: 50%;
        border: 2px solid #ffffff;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 204, 255, 0.8);
    }
    
    .volume-value {
        color: white;
        font-size: 0.7rem;
        min-width: 30px;
        text-align: center;
    }
    
    .stone-throw-effect {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 4rem;
        z-index: 50;
        animation: stoneThrow 1.5s ease-out;
        pointer-events: none;
    }
    
    @keyframes stoneThrow {
        0% {
            transform: translate(-50%, -50%) scale(0.5);
            opacity: 1;
        }
        50% {
            transform: translate(100%, -100%) scale(1);
            opacity: 0.8;
        }
        100% {
            transform: translate(200%, -200%) scale(1.5);
            opacity: 0;
        }
    }
    
    .stone-result-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 90;
        padding: 20px;
    }
    
    .stone-result-box {
        background: linear-gradient(135deg, rgba(30, 15, 0, 0.95), rgba(20, 10, 0, 0.95));
        border: 4px solid;
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 95%;
        text-align: center;
        animation: resultAppear 0.5s ease-out;
    }
    
    @keyframes resultAppear {
        0% {
            transform: scale(0.8);
            opacity: 0;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    .stone-result-title {
        font-size: 1.8rem;
        margin-bottom: 20px;
        text-shadow: 0 0 10px currentColor;
    }
    
    .stone-result-description {
        font-size: 1rem;
        margin-bottom: 25px;
        line-height: 1.6;
    }
    
    .result-success {
        border-color: #4CAF50;
        box-shadow: 0 0 40px rgba(76, 175, 80, 0.7);
    }
    
    .result-success .stone-result-title {
        color: #4CAF50;
    }
    
    .result-fail {
        border-color: #F44336;
        box-shadow: 0 0 40px rgba(244, 67, 54, 0.7);
    }
    
    .result-fail .stone-result-title {
        color: #F44336;
    }
    
    .continue-btn {
        background: linear-gradient(135deg, #8B4513, #A0522D);
        border: 3px solid #FFD700;
        color: #FFD700;
        padding: 15px 30px;
        font-size: 0.9rem;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
        margin-top: 20px;
        letter-spacing: 1px;
        text-shadow: 1px 1px 0 #000;
        box-shadow: 0 4px 0 #5D2900;
    }
    
    .continue-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 #5D2900;
        background: linear-gradient(135deg, #A0522D, #8B4513);
    }
    
    .continue-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 0 #5D2900;
    }
    
    .music-controls .music-toggle[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.7rem;
        white-space: nowrap;
        z-index: 1001;
    }
    
    .volume-slider-container:hover::after {
        content: "–ì—Ä–æ–º–∫–æ—Å—Ç—å —ç–º–±–∏–µ–Ω—Ç–∞";
        position: absolute;
        bottom: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.7rem;
        white-space: nowrap;
        z-index: 1001;
    }
    
    .scale-up {
        animation: scaleUp 0.5s ease-out;
    }
    
    @keyframes scaleUp {
        0% { transform: scale(0.9); opacity: 0.7; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    .yumi-img.changing {
        animation: spriteChange 0.3s ease;
    }
    
    @keyframes spriteChange {
        0% { opacity: 0.5; transform: scale(0.95); }
        50% { opacity: 0.8; transform: scale(1.05); }
        100% { opacity: 1; transform: scale(1); }
    }

    .minigame-intro {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 200;
        padding: 20px;
    }

    .minigame-box {
        background: linear-gradient(135deg, rgba(30, 15, 0, 0.95), rgba(20, 10, 0, 0.95));
        border: 4px solid #ff6600;
        border-radius: 15px;
        padding: 25px;
        max-width: 700px;
        width: 95%;
        text-align: center;
        box-shadow: 0 0 40px rgba(255, 102, 0, 0.7);
    }

    .minigame-description {
        color: #ffcc99;
        font-size: 1rem;
        margin-bottom: 25px;
        line-height: 1.6;
        background: rgba(0, 0, 0, 0.4);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 102, 0, 0.3);
    }

    .cutscene-next-btn {
        font-family: 'Press Start 2P', 'Courier New', Courier, monospace !important;
    }

    .fade-transition {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }

    .fade-in {
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
    }

    .final-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        padding: 40px;
        text-align: center;
    }

    .final-message {
        background: rgba(0, 0, 0, 0.9);
        padding: 40px;
        border-radius: 15px;
        border: 4px solid #ffcc00;
        max-width: 800px;
        width: 100%;
        box-shadow: 0 0 50px rgba(255, 204, 0, 0.5);
        animation: finalAppear 1s ease-out;
    }

    @keyframes finalAppear {
        0% {
            transform: scale(0.8);
            opacity: 0;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .final-title {
        color: #ffcc00;
        font-size: 2.5rem;
        margin-bottom: 30px;
        text-shadow: 0 0 15px #ff3300;
        font-family: 'Press Start 2P', monospace;
    }

    .final-text {
        color: #ffcc99;
        font-size: 1.2rem;
        line-height: 1.8;
        margin-bottom: 40px;
        font-family: 'Press Start 2P', monospace;
    }

    .return-button {
        background: linear-gradient(135deg, #8B4513, #A0522D);
        border: 4px solid #FFD700;
        color: #FFD700;
        padding: 20px 50px;
        font-size: 1.2rem;
        cursor: pointer;
        border-radius: 10px;
        transition: all 0.3s;
        font-family: 'Press Start 2P', monospace;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 2px 2px 0 #000;
        box-shadow: 0 5px 0 #5D2900;
        margin-top: 20px;
        animation: pulseReturn 2s infinite alternate;
    }

    @keyframes pulseReturn {
        0% {
            transform: scale(1);
            box-shadow: 0 5px 0 #5D2900;
        }
        100% {
            transform: scale(1.05);
            box-shadow: 0 5px 0 #5D2900, 0 0 30px rgba(255, 215, 0, 0.5);
        }
    }

    .return-button:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 0 #5D2900, 0 0 40px rgba(255, 215, 0, 0.7);
        background: linear-gradient(135deg, #A0522D, #8B4513);
    }

    .return-button:active {
        transform: translateY(2px) scale(1);
        box-shadow: 0 2px 0 #5D2900;
    }
</style>
</head>
<body>
    <button class="sound-toggle" id="soundToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã">üîä –í–ö–õ</button>
    
    <div class="music-controls" id="musicControls">
        <button class="music-toggle" id="musicToggle" title="–≠–º–±–∏–µ–Ω—Ç –ø–µ—â–µ—Ä—ã: –í–ö–õ">üéµ</button>
        <div class="volume-slider-container">
            <div class="volume-icon">üîä</div>
            <input type="range" min="0" max="100" value="8" class="volume-slider" id="volumeSlider">
            <div class="volume-value" id="volumeValue">8%</div>
        </div>
    </div>
    
    <div class="game-container">
        <!-- –≠–ö–†–ê–ù –ó–ê–°–¢–ê–í–ö–ò -->
        <div class="title-screen" id="titleScreen">
            <h1 class="game-title pixel-text">üêâ –ü–ï–©–ï–†–ê –î–†–ê–ö–û–ù–ê: –¢–ò–•–ê–Ø –ö–†–ê–ñ–ê</h1>
            <p class="title-subtitle">
                –õ–µ–¥—è–Ω–æ–π –ü–∏–∫ ‚Äî —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç —ç—Ç—É –≥–æ—Ä—É –∏–∑-–∑–∞ –µ—ë –≤–µ—á–Ω–æ –∑–∞—Å–Ω–µ–∂–µ–Ω–Ω–æ–π –≤–µ—Ä—à–∏–Ω—ã.<br><br>
                –ù–æ —Ç–µ, –∫—Ç–æ —Å–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –µ–≥–æ –≥–ª—É–±–∏–Ω—ã, –∑–Ω–∞—é—Ç –ø—Ä–∞–≤–¥—É: –ø–æ–¥ –ª–µ–¥—è–Ω–æ–π –∫–æ—Ä–∫–æ–π —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è 
                –æ–≥–Ω–µ–Ω–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ –≥–æ—Ä—ã. –ó–¥–µ—Å—å, –≤ —Ä–∞—Å–∫–∞–ª—ë–Ω–Ω—ã—Ö –ø–µ—â–µ—Ä–∞—Ö, –≥–¥–µ –∫–∞–º–Ω–∏ —Å–≤–µ—Ç—è—Ç—Å—è 
                –±–∞–≥—Ä–æ–≤—ã–º —Å–≤–µ—Ç–æ–º, —Å–ø–∏—Ç –¥—Ä–µ–≤–Ω–∏–π —Å—Ç—Ä–∞–∂ ‚Äî –¥—Ä–∞–∫–æ–Ω –∏–∑—É–º—Ä—É–¥–Ω—ã—Ö —á–µ—à—É–π, –æ—Ö—Ä–∞–Ω—è—é—â–∏–π 
                —Å–∞–º–æ—Ü–≤–µ—Ç—ã, —á—Ç–æ –ø—ã–ª–∞—é—Ç –∏–∑–Ω—É—Ç—Ä–∏ –∞–ª—ã–º –æ–≥–Ω—ë–º.<br><br>
                –ì–æ–≤–æ—Ä—è—Ç, –æ–Ω –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç –∫—Ä–∏–∫–∞ ‚Äî –∏–ª–∏ –æ—Ç –∫—Ä–∞–∂–∏.
            </p>
            <button class="start-button btn-pixel" id="startButton">
                ‚ñ∂ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
            </button>
        </div>
        
        <!-- –≠–ö–†–ê–ù –ö–ê–¢–°–¶–ï–ù–´ -->
        <div class="cutscene-screen" id="cutsceneScreen">
            <div class="cutscene-video-container">
                <video class="cutscene-video" id="cutsceneVideo1" loop muted playsinline>
    <source src="video/Nik idet po peshere.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo2" loop muted playsinline>
    <source src="video/Nik obnarujil drakona.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo3" loop muted playsinline>
    <source src="video/ogony.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo4" loop muted playsinline>
    <source src="video/presledyet.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo5" loop muted playsinline>
    <source src="video/Ybegaut.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo6" loop muted playsinline>
    <source src="video/Deeper tunnel.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo7" loop muted playsinline>
    <source src="video/Underground lake.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo8" loop muted playsinline>
    <source src="video/Crystal in hands.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo9" loop muted playsinline>
    <source src="video/Climbing out.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo10" loop muted playsinline>
    <source src="video/Exit on mountainside.mp4" type="video/mp4">
</video>
<video class="cutscene-video" id="cutsceneVideo11" loop muted playsinline>
    <source src="video/Final.mp4" type="video/mp4">
</video>
            </div>
            
            <div class="cutscene-text-container" id="cutsceneTextContainer">
                <div class="cutscene-text" id="cutsceneText">
                    –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ü–µ–Ω—ã...
                </div>
                
                <div class="dialogue-choices" id="dialogueChoices">
                    <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
                
                <button class="cutscene-next-btn btn-pixel" id="cutsceneNextBtn">
                    ‚ñ∂ –î–ê–õ–ï–ï
                </button>
            </div>
        </div>
        
        <!-- –ò–ì–†–û–í–ê–Ø –°–¶–ï–ù–ê (–ú–ò–ù–ò-–ò–ì–†–ê) -->
        <div class="game-scene" id="gameScene">
            <!-- –õ–ï–í–ê–Ø –ß–ê–°–¢–¨ - –í–ò–î–ï–û –î–†–ê–ö–û–ù–ê -->
            <div class="video-column">
                <div class="dragon-video-main">
                    <div class="dragon-video-wrapper">
                        <video class="dragon-video" id="dragonSleepVideo" loop muted playsinline>
                            <source src="video/spit.mp4" type="video/mp4">
                        </video>
                        <video class="dragon-video" id="dragonRestlessVideo" loop muted playsinline>
                            <source src="video/vorochaetsya.mp4" type="video/mp4">
                        </video>
                        <video class="dragon-video" id="dragonAwakeVideo" loop muted playsinline>
                            <source src="video/smotrit.mp4" type="video/mp4">
                        </video>
                        <div class="video-fallback" id="videoFallback">
                            üêâ<br>
                            <div style="font-size: 1rem; margin-top: 20px;">
                                –í–∏–¥–µ–æ –¥—Ä–∞–∫–æ–Ω–∞
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ - –ò–ù–¢–ï–†–§–ï–ô–° -->
            <div class="ui-column">
                <!-- –°–¢–ê–¢–£–° -->
                <div class="game-stats">
                    <div class="stat-title">–°–¢–†–ê–ñ –ü–ï–©–ï–†–´</div>
                    <div class="stat-value pixel-text" id="dragonStatus">–ì–õ–£–ë–û–ö–û –°–ü–ò–¢</div>
                    
                    <div class="stat-title" style="margin-top: 15px;">–®–ê–ì–ò</div>
                    <div class="stat-value pixel-text" id="stepCounter">0/30</div>
                    
                    <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –ë–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò -->
                    <div class="alertness-container">
                        <div class="stat-title">–ë–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨</div>
                        <div class="alertness-bar">
                            <div class="alertness-fill" id="alertnessFill"></div>
                        </div>
                        <div class="alertness-percent pixel-text" id="alertnessPercent">0%</div>
                    </div>
                </div>
                
                <!-- –ü–ê–ù–ï–õ–¨ –ü–û–î–°–ö–ê–ó–û–ö -->
                <div class="hint-box">
                    <div class="yumi-icon" id="yumiIcon">
                        <img src="img/Yumi sitting.svg" alt="–Æ–º–∏" class="yumi-img float" id="yumiImage">
                    </div>
                    <div class="hint-text" id="hintText">
                        –¢–∏—à–µ... –ù–∞—á–∏–Ω–∞–µ–º –ø—É—Ç—å...
                    </div>
                </div>
                
                <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï -->
                <div class="controls" id="controlsContainer">
                    <div class="control-row">
                        <button class="game-btn btn-pixel" id="waitButton">
                            ‚è∏Ô∏è –ü–û–î–û–ñ–î–ê–¢–¨
                        </button>
                        <button class="game-btn btn-pixel" id="stepButton">
                            üë£ –®–ê–ì –í–ü–ï–†–Å–î
                        </button>
                    </div>
                    <!-- –ö–Ω–æ–ø–∫–∞ –∫–∞–º–Ω—è –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ 15 —à–∞–≥–µ -->
                    <button class="game-btn stone-btn btn-pixel" id="stoneButton" style="display: none;">
                        ü™® –ö–ò–ù–£–¢–¨ –ö–ê–ú–ï–ù–¨
                    </button>
                </div>
            </div>
            
            <!-- –ó–ê–°–¢–ê–í–ö–ê –ü–ï–†–ï–î –ú–ò–ù–ò-–ò–ì–†–û–ô -->
            <div class="minigame-intro" id="minigameIntro">
                <div class="minigame-box">
                    <div class="minigame-title pixel-text">–í–ù–ò–ú–ê–ù–ò–ï: –î–†–ê–ö–û–ù –í–ü–ï–†–ï–î–ò!</div>
                    <div class="minigame-description">
                        –ù–∏–∫ –Ω–∞–∫–ª–æ–Ω—è–µ—Ç—Å—è –∫ –Æ–º–∏, –≥–æ–≤–æ—Ä–∏—Ç –ø–æ—á—Ç–∏ –±–µ–∑ –∑–≤—É–∫–∞, —Ç–æ–ª—å–∫–æ –≥—É–±–∞–º–∏:<br><br>
                        <em>"–ó–∞–ø–æ–º–Ω–∏: –ª—é–±–æ–µ –ø–∞–¥–µ–Ω–∏–µ –∫–∞–º–Ω—è, –ª—é–±–æ–π —Å–∫—Ä–∏–ø ‚Äî –∫–æ–Ω–µ—Ü. –ú—ã –Ω–µ –±–µ–∂–∏–º. –ú—ã –Ω–µ –¥—ã—à–∏–º –≥—Ä–æ–º–∫–æ. –ú—ã ‚Äî —Ç–µ–Ω—å."</em><br><br>
                        –í–ø–µ—Ä–µ–¥–∏ —Å–ø—è—â–∏–π –¥—Ä–∞–∫–æ–Ω. –ù—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ 30 —à–∞–≥–æ–≤ –¥–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –∏ –Ω–µ —Ä–∞–∑–±—É–¥–∏—Ç—å –µ–≥–æ!
                    </div>
                    <button class="start-minigame-btn btn-pixel" id="startMinigameBtn">
                        ‚ñ∂ –ù–ê–ß–ê–¢–¨ –ü–†–û–•–û–ñ–î–ï–ù–ò–ï
                    </button>
                </div>
            </div>
            
            <!-- –û–í–ï–†–õ–ï–ô –î–õ–Ø –°–û–ë–´–¢–ò–ô -->
            <div class="event-overlay" id="eventOverlay">
                <div class="event-box">
                    <div class="event-title pixel-text" id="eventTitle">–°–û–ë–´–¢–ò–ï</div>
                    <div class="event-description" id="eventDescription">
                        –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è...
                    </div>
                    
                    <!-- –≠–õ–ï–ú–ï–ù–¢ –î–õ–Ø –°–†–ê–í–ù–ï–ù–ò–Ø –í–ê–†–ò–ê–ù–¢–û–í -->
                    <div class="choices-comparison" id="choicesComparison">
                        <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è JavaScript -->
                    </div>
                    
                    <!-- –≠–õ–ï–ú–ï–ù–¢ –î–õ–Ø –ö–ù–û–ü–û–ö –í–´–ë–û–†–ê -->
                    <div class="choice-buttons">
                        <button class="choice-btn btn-risky btn-pixel" id="eventChoice1">
                            –í–´–ë–†–ê–¢–¨ –†–ò–°–ö–û–í–ê–ù–ù–´–ô –ü–£–¢–¨
                        </button>
                        <button class="choice-btn btn-safe btn-pixel" id="eventChoice2">
                            –í–´–ë–†–ê–¢–¨ –ë–ï–ó–û–ü–ê–°–ù–´–ô –ü–£–¢–¨
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –û–í–ï–†–õ–ï–ô –†–ï–ó–£–õ–¨–¢–ê–¢–ê –ë–†–û–°–ö–ê –ö–ê–ú–ù–Ø -->
            <div class="stone-result-overlay" id="stoneResultOverlay">
                <div class="stone-result-box" id="stoneResultBox">
                    <div class="stone-result-title" id="stoneResultTitle">–†–ï–ó–£–õ–¨–¢–ê–¢</div>
                    <div class="stone-result-description" id="stoneResultDescription">
                        –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
                    </div>
                    <button class="continue-btn" id="stoneContinueBtn">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù -->
    <div class="final-screen" id="finalScreen" style="display: none;">
        <div class="final-message">
            <h2 class="final-title">–ü–£–¢–ï–®–ï–°–¢–í–ò–ï –ü–†–û–î–û–õ–ñ–ê–ï–¢–°–Ø...</h2>
            <p class="final-text">
                –ù–∏–∫ –∏ –Æ–º–∏ —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–ª–∏—Å—å –∏–∑ –ø–µ—â–µ—Ä—ã –¥—Ä–∞–∫–æ–Ω–∞ —Å –∑–∞–≤–µ—Ç–Ω—ã–º –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–º.<br><br>
                –ù–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ –∏—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è...<br><br>
                –°–µ—Ä–¥—Ü–µ –ì–æ—Ä—ã, –∫–æ—Ç–æ—Ä–æ–µ –æ–Ω–∏ –∑–∞–±—Ä–∞–ª–∏, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—É—Ç—å –∫ –¥—Ä–µ–≤–Ω–∏–º —Ç–∞–π–Ω–∞–º,<br>
                —Å–∫—Ä—ã—Ç—ã–º –≤ –≥–ª—É–±–∏–Ω–∞—Ö —ç—Ç–æ–≥–æ –º–∏—Ä–∞.
            </p>
            <button class="return-button" id="returnButton">
                üè† –í–ï–†–ù–£–¢–¨–°–Ø –ù–ê –ì–õ–ê–í–ù–£–Æ
            </button>
        </div>
    </div>

    <script>
class DragonStealthGame {
    constructor() {
        this.state = 'menu';
        this.cutsceneIndex = 0;
        
        // –ú–∏–Ω–∏-–∏–≥—Ä–∞
        this.step = 0;
        this.maxSteps = 30;
        this.alertness = 0;
        this.dragonState = 'sleeping';
        this.hasStone = false;
        this.stoneUsed = false;
        this.canAct = true;
        this.videoPlaying = false;
        this.justRestless = false;
        this.soundEnabled = true;
        this.musicEnabled = true;
        this.musicVolume = 0.08;
        this.currentYumiState = 'sitting';
        this.pauseMode = false;
        this.awakeCount = 0;
        this.firstVideoPlayed = false;
        
        this.awakeBlockTimer = null;
        this.awakeBlockDuration = 5000;
        
        this.initAudio();
        
        // –°—Ü–µ–Ω—ã –ø–µ—Ä–µ–¥ –º–∏–Ω–∏-–∏–≥—Ä–æ–π
        this.cutscenes = [
            {
                video: 'cutsceneVideo1',
                text: '–°—Ç–µ–Ω—ã –∏–∑ –∫—Ä–∞—Å–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤–æ–≥–æ –∫–∞–º–Ω—è –ø–æ–∫—Ä—ã—Ç—ã –Ω–∞–ª—ë—Ç–æ–º —Å–µ—Ä—ã. –í –≤–æ–∑–¥—É—Ö–µ –≤–∏—Å–∏—Ç –ª—ë–≥–∫–∞—è –¥—ã–º–∫–∞, –∞ –∏–∑ —Ç—Ä–µ—â–∏–Ω –≤ –ø–æ–ª—É –ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è —Å–ª–∞–±–æ–µ –∫—Ä–∞—Å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo1',
                text: '<span class="character-name">–Æ–ú–ò</span> (–≤—ã—Ç–∏—Ä–∞—è –ø–æ—Ç —Å–æ –ª–±–∞):<br>–ñ–∞—Ä–∫–æ, –∫–∞–∫ –≤ –ø–µ—á–∏... –ò –ø–∞—Ö–Ω–µ—Ç —Å–µ—Ä–æ–π. –≠—Ç–æ —Ç–æ—á–Ω–æ –õ–µ–¥—è–Ω–æ–π –ü–∏–∫?',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo1',
                text: '<span class="character-name">–ù–ò–ö</span> (–∫–∞—Å–∞—è—Å—å —Ç—ë–ø–ª–æ–π —Å—Ç–µ–Ω—ã):<br>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–º–∞–Ω—á–∏–≤–æ. –°–Ω–∞—Ä—É–∂–∏ ‚Äî –ª–µ–¥–Ω–∏–∫, –≤–Ω—É—Ç—Ä–∏ ‚Äî –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ì–æ—Ä–∞ —Å–ø–∏—Ç –ª–∏—à—å —Å–Ω–∞—Ä—É–∂–∏.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo1',
                text: '–û–Ω–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–¥ –∞—Ä–∫–æ–π –∏–∑ –Ω–∞–≥—Ä–µ—Ç–æ–≥–æ –∫–∞–º–Ω—è. –í–æ–∑–¥—É—Ö —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –µ—â—ë –≥–æ—Ä—è—á–µ–µ, –ø–∞—Ö–Ω–µ—Ç —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–æ–π –ø–æ—Ä–æ–¥–æ–π –∏ —Å–µ—Ä–æ–≤–æ–¥–æ—Ä–æ–¥–æ–º.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo1',
                text: '<span class="character-name">–Æ–ú–ò</span> (—à–µ–ø—á–µ—Ç):<br>–¢—ã —Å–ª—ã—à–∞–ª –∏—Å—Ç–æ—Ä–∏–∏? –ì–æ–≤–æ—Ä—è—Ç, —Ç–æ—Ç, –∫—Ç–æ —Ä–∞–∑–±—É–¥–∏—Ç –¥—Ä–∞–∫–æ–Ω–∞‚Ä¶ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–π–¥–µ—Ç –æ—Ç—Å—é–¥–∞.',
                hasChoices: true,
                choices: [
                    {
                        text: 'üî• ¬´–ò—Å—Ç–æ—Ä–∏–∏ ‚Äî –¥–ª—è –¥–µ—Ç–µ–π. –ú—ã –ø—Ä–∏—à–ª–∏ –∑–∞ —Ä–µ–∞–ª—å–Ω–æ–π –¥–æ–±—ã—á–µ–π.¬ª',
                        effect: '+5% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏'
                    },
                    {
                        text: 'üåã ¬´–¢–µ–º —Ç–∏—à–µ –Ω—É–∂–Ω–æ –±—ã—Ç—å. –ñ–∞—Ä–∞ –∏—Å–∫–∞–∂–∞–µ—Ç –∑–≤—É–∫.¬ª',
                        effect: '–ù–∞—á–∞–ª—å–Ω–∞—è –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -5%'
                    },
                    {
                        text: 'üëÇ ¬´–°–ª—É—à–∞–π –µ–≥–æ –¥—ã—Ö–∞–Ω–∏–µ. –†–∏—Ç–º –≥–æ—Ä—è—á–µ–≥–æ –≤–æ–∑–¥—É—Ö–∞ ‚Äî –Ω–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ.¬ª',
                        effect: '–õ—É—á—à–µ–µ —á—É–≤—Å—Ç–≤–æ —Ä–∏—Ç–º–∞'
                    },
                    {
                        text: 'üíé ¬´–ï—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ ‚Äî –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –¥–∞–≤–Ω–æ –±—ã –∑–∞–±—Ä–∞–ª–∏.¬ª',
                        effect: '+10% –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏'
                    }
                ]
            },
            {
                video: 'cutsceneVideo1',
                text: '–ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –ù–∏–∫–∞ –æ–Ω–∏ –ø—Ä–æ–¥–≤–∏–≥–∞—é—Ç—Å—è –≥–ª—É–±–∂–µ. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–∞—Å—Ç—ë—Ç. –ù–∞ —Å—Ç–µ–Ω–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—Ç–ª–æ–∂–µ–Ω–∏—è –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–µ–∫–ª–∞, –∞ –≤ –≤–æ–∑–¥—É—Ö–µ –ø–ª–∞–≤–∞—é—Ç –∏—Å–∫–æ—Ä–∫–∏ –ø–µ–ø–ª–∞.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo1',
                text: '<span class="character-name">–Æ–ú–ò</span> (—à–µ–ø—á–µ—Ç, —É–∫–∞–∑—ã–≤–∞—è –Ω–∞ –ø–æ—Ç–æ–ª–æ–∫):<br>–°–º–æ—Ç—Ä–∏‚Ä¶ —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç—ã. –ù–æ –Ω–µ –ª–µ–¥—è–Ω—ã–µ, –∞ –∏–∑ –æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–æ–π –ª–∞–≤—ã. –ò –æ–Ω–∏ –≤—Å—ë –µ—â—ë —Ç—ë–ø–ª—ã–µ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo1',
                text: '<span class="character-name">–ù–ò–ö</span> (–ø—Ä–∏—Å–º–∞—Ç—Ä–∏–≤–∞—è—Å—å –∫ —É–∑–æ—Ä–∞–º):<br>–î–∞. –í—Å—è –ø–µ—â–µ—Ä–∞ ‚Äî –∫–∞–∫ –≥–∏–≥–∞–Ω—Ç—Å–∫–∞—è –ø–µ—á—å. –ó–Ω–∞—á–∏—Ç, –º—ã –ø–æ—á—Ç–∏ —É —Ü–µ–ª–∏. –î—Ä–∞–∫–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–¥–µ-—Ç–æ –∑–¥–µ—Å—å.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo2',
                text: '–ï—â—ë –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ ‚Äî –∏ –æ–Ω–∏ –≤—ã—Ö–æ–¥—è—Ç –≤ –æ–≥—Ä–æ–º–Ω—ã–π –∑–∞–ª —Å –∫—É–ø–æ–ª–æ–æ–±—Ä–∞–∑–Ω—ã–º –ø–æ—Ç–æ–ª–æ–∫. –í —Ü–µ–Ω—Ç—Ä–µ, –Ω–∞ –Ω–∞–≥—Ä–µ—Ç–æ–π –∫–∞–º–µ–Ω–Ω–æ–π –ø–ª–∏—Ç–µ, —Å–≤–µ—Ä–Ω—É–≤—à–∏—Å—å –∫–æ–ª—å—Ü–∞–º–∏, –ª–µ–∂–∏—Ç –æ–Ω–æ.<br><br><strong>–î–†–ê–ö–û–ù.</strong> –ß–µ—à—É—è –ø–µ—Ä–µ–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑—É–º—Ä—É–¥–Ω–æ-–∑–µ–ª—ë–Ω—ã–º–∏ –∏ –∑–æ–ª–æ—Ç–∏—Å—Ç—ã–º–∏ –æ—Ç—Ç–µ–Ω–∫–∞–º–∏. –ò–∑ –Ω–æ–∑–¥—Ä–µ–π –≤—ã—Ö–æ–¥–∏—Ç —Ç—ë–ø–ª—ã–π –ø–∞—Ä, –∞ –ø–æ–¥ –±–æ–∫–∞–º–∏ –≤–∏–¥–Ω—ã –Ω–µ–±–æ–ª—å—à–∏–µ —Ç—Ä–µ—â–∏–Ω—ã –≤ –ø–æ–ª—É, –æ—Ç–∫—É–¥–∞ –ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è —Å–ª–∞–±–æ–µ –∫—Ä–∞—Å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –º–∞–≥–º—ã.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo2',
                text: '<span class="character-name">–Æ–ú–ò</span> (–∑–∞–º–∏—Ä–∞—è, —á—É–≤—Å—Ç–≤—É—è –≤–æ–ª–Ω—É —Ç–µ–ø–ª–∞):<br>–û–Ω‚Ä¶ –æ–Ω –¥—ã—à–∏—Ç. –ö–∞–∂–¥—ã–π –≤—ã–¥–æ—Ö ‚Äî –∫–∞–∫ –∏–∑ –∫—É–∑–Ω–µ—á–Ω–æ–≥–æ –≥–æ—Ä–Ω–∞. –ò —Å–º–æ—Ç—Ä–∏ ‚Äî –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ –∫–∞–º–Ω–∏ –Ω–∞–≥—Ä–µ—Ç—ã –¥–æ –∫—Ä–∞—Å–Ω–∞.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo2',
                text: '<span class="character-name">–ù–ò–ö</span> (–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥—ã—Ö–∞—è, –∫–∞–ø–ª–∏ –ø–æ—Ç–∞ –Ω–∞ –ª–±—É):<br>–í–∏–∂—É. –ò –≤–∏–∂—É –∫—Ä–∏—Å—Ç–∞–ª–ª—ã. –ü—Ä—è–º–æ —É –µ–≥–æ –ª–∞–ø. –û–Ω–∏ —Å–≤–µ—Ç—è—Ç—Å—è –∏–∑–Ω—É—Ç—Ä–∏ ‚Äî —Ç–µ–ø–ª–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∏—Ö —Å–≤–µ—á–µ–Ω–∏–µ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo2',
                text: '–ú–µ–∂–¥—É –ø–µ—Ä–µ–¥–Ω–∏–º–∏ –ª–∞–ø–∞–º–∏ –¥—Ä–∞–∫–æ–Ω–∞, –≤ –Ω–µ–±–æ–ª—å—à–æ–º —É–≥–ª—É–±–ª–µ–Ω–∏–∏ –≤ –Ω–∞–≥—Ä–µ—Ç–æ–º –∫–∞–º–Ω–µ, –ª–µ–∂–∏—Ç –≥—Ä–æ–∑–¥—å —Å–≤–µ—Ç—è—â–∏—Ö—Å—è —Å–∞–º–æ—Ü–≤–µ—Ç–æ–≤. –û–Ω–∏ –ø—É–ª—å—Å–∏—Ä—É—é—Ç —Ç—ë–ø–ª—ã–º –æ—Ä–∞–Ω–∂–µ–≤–æ-–∫—Ä–∞—Å–Ω—ã–º —Å–≤–µ—Ç–æ–º, –∫–∞–∫ —É–≥–ª–∏ –≤ –∫–æ—Å—Ç—Ä–µ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo2',
                text: '<span class="character-name">–Æ–ú–ò</span>:<br>–¢—Ä–∏–¥—Ü–∞—Ç—å —à–∞–≥–æ–≤, –ù–∏–∫. –í—Å–µ–≥–æ —Ç—Ä–∏–¥—Ü–∞—Ç—å —à–∞–≥–æ–≤‚Ä¶ –ø–æ —Ä–∞—Å–∫–∞–ª—ë–Ω–Ω–æ–º—É –ø–æ–ª—É. –ú–∏–º–æ –Ω–µ–≥–æ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo2',
                text: '<span class="character-name">–ù–ò–ö</span>:<br>–£ –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ. –ñ–∞—Ä–∞ –¥–µ–ª–∞–µ—Ç –≤–æ–∑–¥—É—Ö –ø–ª–æ—Ç–Ω—ã–º ‚Äî –∑–≤—É–∫ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è —Ö—É–∂–µ. –û–Ω —Å–ø–∏—Ç –≥–ª—É–±–æ–∫–∏–º —Å–Ω–æ–º –≤ —Å–≤–æ—ë–º —Ç–µ–ø–ª–µ. –û–Ω –Ω–µ –≤–∏–¥–∏—Ç –Ω–∞—Å. –ù–µ —Å–ª—ã—à–∏—Ç, –µ—Å–ª–∏ –º—ã –±—É–¥–µ–º –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã, –∫–∞–∫ —Ç–µ–Ω—å.',
                hasChoices: false
            }
        ];
        
        // –°—Ü–µ–Ω—ã –ø–æ—Å–ª–µ –º–∏–Ω–∏-–∏–≥—Ä—ã (–¥—Ä–∞–∫–æ–Ω –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)
        this.postMinigameCutscenes = [
            {
                video: 'cutsceneVideo3',
                text: '–†—É–∫–∞ –ù–∏–∫–∞ —Å–∂–∏–º–∞–µ—Ç —Ç—ë–ø–ª—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª. –ê–ª–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è —Å–∞–º–æ—Ü–≤–µ—Ç–∞ –æ—Å–≤–µ—â–∞–µ—Ç –µ–≥–æ –ø–∞–ª—å—Ü—ã —Å—Ç—Ä–∞–Ω–Ω—ã–º, —Ç—Ä–µ–≤–æ–∂–Ω—ã–º —Å–≤–µ—Ç–æ–º.<br><br><span class="character-name">–Æ–ú–ò</span> (—à–µ–ø—á–µ—Ç):<br>–£ –Ω–∞—Å –ø–æ–ª—É—á–∏–ª–æ—Å—å! –î–∞–≤–∞–π –≤—ã–±–∏—Ä–∞—Ç—å—Å—è –æ—Ç—Å—é–¥–∞!',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo3',
                text: '–ù–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Å—Ç–∞–ª–ª –ø–æ–∫–∏–¥–∞–µ—Ç —Å–≤–æ—ë –º–µ—Å—Ç–æ, –≤ –ø–µ—â–µ—Ä–µ —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è. –í–æ–∑–¥—É—Ö —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç—è–∂–µ–ª–µ–µ. –¢–µ–ø–ª–æ, —á—Ç–æ –∏—Å—Ö–æ–¥–∏–ª–æ –æ—Ç –ø–æ–ª–∞, –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—É–ª—å—Å–∏—Ä–æ–≤–∞—Ç—å, —Å–ª–æ–≤–Ω–æ —Å–µ—Ä–¥—Ü–µ —á–µ–≥–æ-—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–∏–ª–æ —Å–≤–æ–π —Ä–∏—Ç–º.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo3',
                text: '<span class="character-name">–î–†–ê–ö–û–ù</span> (—à–µ–≤–µ–ª—å–Ω—É–ª—Å—è –≤–æ —Å–Ω–µ):<br>*–ì–ª—É–±–æ–∫–∏–π –≤–∑–¥–æ—Ö, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ —Ä–∞—Å–∫–∞—Ç—ã –ø–æ–¥–∑–µ–º–Ω–æ–≥–æ –≥—Ä–æ–º–∞*<br><br><span class="character-name">–Æ–ú–ò</span> (—Ö–≤–∞—Ç–∞—è –ù–∏–∫–∞ –∑–∞ —Ä—É–∫–∞–≤):<br>–û–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç! –î—Ä–∞–∫–æ–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç, —á—Ç–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞ –Ω–µ—Ç!',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo3',
                text: '–í–µ–∫–∏ –¥—Ä–∞–∫–æ–Ω–∞ –≤–∑–¥—Ä–∞–≥–∏–≤–∞—é—Ç. –ò–∑ –Ω–æ–∑–¥—Ä–µ–π –≤—ã—Ä—ã–≤–∞—é—Ç—Å—è –∫–ª—É–±—ã –ø–∞—Ä–∞ –∏ –ø–µ—Ä–≤—ã–µ –∏—Å–∫—Ä—ã –ø–ª–∞–º–µ–Ω–∏. –û–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç –ø—É—Å—Ç–æ—Ç—É —Ç–∞–º, –≥–¥–µ –≤–µ–∫–∞–º–∏ –ª–µ–∂–∞–ª–∞ –µ–≥–æ —Å–≤—è—Ç—ã–Ω—è.<br><br><span class="character-name">–ù–ò–ö</span> (—Å–∂–∏–º–∞—è –∫—Ä–∏—Å—Ç–∞–ª–ª):<br>–ö—Ä–∏—Å—Ç–∞–ª–ª... –æ–Ω —Å–≤—è–∑–∞–Ω —Å –Ω–∏–º. –ú–∞–≥–º–∞ –≥–æ—Ä—ã –ø–∏—Ç–∞–ª–∞ –∏ –¥—Ä–∞–∫–æ–Ω–∞, –∏ —Å–∞–º–æ—Ü–≤–µ—Ç.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo3',
                text: '<span class="character-name">–î–†–ê–ö–û–ù</span> (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –≥–ª–∞–∑ ‚Äî —â–µ–ª—å, –ø–æ–ª–Ω—É—é —Ä–∞—Å–∫–∞–ª—ë–Ω–Ω–æ–≥–æ –∑–æ–ª–æ—Ç–∞):<br>*–ù–∏–∑–∫–æ–µ, –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–µ —Ä—ã—á–∞–Ω–∏–µ, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –¥—Ä–æ–∂–∞—Ç –∫–∞–º–Ω–∏ –ø–æ–¥ –Ω–æ–≥–∞–º–∏*<br><br>–ó–ê–ë–†–ê–õ–ò. –ü–û–¢–†–û–ì–ê–õ–ò. –£–ö–†–ê–õ–ò.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo3',
                text: '<span class="character-name">–ù–ò–ö</span> (–æ—Ç—Ç–∞–ª–∫–∏–≤–∞—è –Æ–º–∏ –Ω–∞–∑–∞–¥):<br>–ë–ï–ñ–ò–ú! –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –±–µ–∂–∞—Ç—å!<br><br>–î—Ä–∞–∫–æ–Ω –º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≥–∏, —á–µ—à—É—è –∑–≤–µ–Ω–∏—Ç, –∫–∞–∫ —Å—Ç–∞–ª—å–Ω–∞—è –±—Ä–æ–Ω—è. –ï–≥–æ –ø–∞—Å—Ç—å —Ä–∞–∑–µ–≤–∞–µ—Ç—Å—è, –∏ –≤–Ω—É—Ç—Ä–∏ —É–∂–µ –ø—ã–ª–∞–µ—Ç –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä, –≥–æ—Ç–æ–≤—ã–π –∏–∑–≤–µ—Ä–≥–Ω—É—Ç—å—Å—è –ø–æ—Ç–æ–∫–æ–º –ø–ª–∞–º–µ–Ω–∏.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo4',
                text: '<span class="character-name">–ü–û–ì–û–ù–Ø</span>:<br><br>–ö–∞–º–µ–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã –ø–µ—â–µ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç —Ç—Ä—è—Å—Ç–∏—Å—å. –ò–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –∑–∞–ª–∞ –¥–æ–Ω–æ—Å–∏—Ç—Å—è –≥—Ä–æ—Ö–æ—Ç ‚Äî –¥—Ä–∞–∫–æ–Ω —Å–Ω–æ—Å–∏—Ç —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç—ã –Ω–∞ —Å–≤–æ—ë–º –ø—É—Ç–∏. –ï–≥–æ —à–∞–≥–∏ –æ—Ç–¥–∞—é—Ç—Å—è –≥–ª—É—Ö–∏–º–∏ —É–¥–∞—Ä–∞–º–∏ –ø–æ –∫–∞–º–µ–Ω–Ω–æ–º—É –ø–æ–ª—É, –∏ —Å –∫–∞–∂–¥—ã–º —É–¥–∞—Ä–æ–º –∫ —Å–≤–æ–¥–∞–º –ø–µ—â–µ—Ä—ã –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –æ–±–ª–∞–∫–æ –ø–µ–ø–ª–∞ –∏ –ø—ã–ª–∏.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo4',
                text: '<span class="character-name">–Æ–ú–ò</span> (–∑–∞–¥—ã—Ö–∞—è—Å—å, –æ–≥–ª—è–¥—ã–≤–∞—è—Å—å —á–µ—Ä–µ–∑ –ø–ª–µ—á–æ):<br>–û–Ω –∏–¥—ë—Ç! –Ø —Å–ª—ã—à—É... –∫–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –∫–∞–∫ –æ–±–≤–∞–ª!<br><br><span class="character-name">–ù–ò–ö</span> (—Ç–∞—â–∞ –µ—ë –∑–∞ —Å–æ–±–æ–π):<br>–ù–µ –æ–≥–ª—è–¥—ã–≤–∞–π—Å—è! –ë–µ–≥–∏! –ü–æ–º–Ω–∏ —Ç—É–Ω–Ω–µ–ª—å ‚Äî –≤–ø–µ—Ä–µ–¥–∏ —Ä–∞–∑–≤–∏–ª–∫–∞, –Ω–∞–ª–µ–≤–æ!',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo4',
                text: '–ó–∞ –Ω–∏–º–∏ —Ä–∞–∑–¥–∞—ë—Ç—Å—è –æ–≥–ª—É—à–∏—Ç–µ–ª—å–Ω—ã–π —Ä—ë–≤, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Å—ã–ø–∞—é—Ç—Å—è –º–µ–ª–∫–∏–µ –∫–∞–º–Ω–∏ —Å –ø–æ—Ç–æ–ª–∫–∞. –ü–ª–∞–º—è –≤—ã—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ –ø–∞—Å—Ç–∏ –¥—Ä–∞–∫–æ–Ω–∞, –æ–ø–∞–ª—è—è —Å—Ç–µ–Ω—ã, –æ—Å—Ç–∞–≤–ª—è—è –∑–∞ —Å–æ–±–æ–π –ø–æ–ª–æ—Å—ã —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–∞–º–Ω—è. –¢–µ–ø–ª–æ –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç —Å–∑–∞–¥–∏, –∫–∞–∫ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∞—è—Å—è –≤–æ–ª–Ω–∞.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo4',
                text: '<span class="character-name">–ù–ò–ö</span> (–∫—Ä–∏—á–∏—Ç, –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—è –≥—Ä–æ—Ö–æ—Ç):<br>–û–Ω –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è! –û–Ω –±—É–¥–µ—Ç –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å –Ω–∞—Å –¥–æ —Å–∞–º–æ–≥–æ –≤—ã—Ö–æ–¥–∞! –ö—Ä–∏—Å—Ç–∞–ª–ª –¥–ª—è –Ω–µ–≥–æ ‚Äî —á–∞—Å—Ç—å –µ–≥–æ —Å–∞–º–æ–≥–æ!<br><br><span class="character-name">–Æ–ú–ò</span> (—Å–ø–æ—Ç—ã–∫–∞—è—Å—å):<br>–ú—ã –Ω–µ —É—Å–ø–µ–µ–º! –û–Ω —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π!',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo5',
                text: '<span class="character-name">–°–ü–ê–°–ï–ù–ò–ï</span>:<br><br>–ù–∏–∫ —Ä–µ–∑–∫–æ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤ —É–∑–∫–∏–π –ø—Ä–æ—Ö–æ–¥, –µ–¥–≤–∞ –∑–∞–º–µ—Ç–Ω—ã–π –≤ —Å—Ç–µ–Ω–µ. –Æ–º–∏ –ø—Ä–æ—Ç–∏—Å–∫–∏–≤–∞–µ—Ç—Å—è —Å–ª–µ–¥–æ–º. –û–Ω–∏ –±–µ–≥—É—Ç –ø–æ –Ω–∏–∑–∫–æ–º—É —Ç—É–Ω–Ω–µ–ª—é, –≥–¥–µ –ø–æ—Ç–æ–ª–æ–∫ –ø–æ—á—Ç–∏ –∫–∞—Å–∞–µ—Ç—Å—è –≥–æ–ª–æ–≤—ã, –∞ –ø–æ–¥ –Ω–æ–≥–∞–º–∏ —Ö—Ä—É—Å—Ç–∏—Ç –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–æ–µ —Å—Ç–µ–∫–ª–æ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo5',
                text: '<span class="character-name">–Æ–ú–ò</span> (—à–µ–ø—á–µ—Ç, –∑–∞–¥—ã—Ö–∞—è—Å—å):<br>–ú—ã –µ–≥–æ –ø–æ—Ç–µ—Ä—è–ª–∏?<br><br><span class="character-name">–ù–ò–ö</span> (–ø—Ä–∏—Å–ª—É—à–∏–≤–∞—è—Å—å):<br>–ù–µ—Ç... –û–Ω –≤—Å—ë –µ—â—ë —Ç–∞–º. –°–ª—ã—à–∏—à—å? –†—ã—á–∏—Ç. –ò—â–µ—Ç –Ω–∞—Å. –ù–æ —ç—Ç–æ—Ç –ø—Ä–æ—Ö–æ–¥ –¥–ª—è –Ω–µ–≥–æ —Å–ª–∏—à–∫–æ–º —É–∑–æ–∫.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo5',
                text: '–í–¥–∞–ª–µ–∫–µ —Å–ª—ã—à–µ–Ω —è—Ä–æ—Å—Ç–Ω—ã–π —Ä—ë–≤ –¥—Ä–∞–∫–æ–Ω–∞, –±—å—é—â–µ–≥–æ—Å—è –æ —Å—Ç–µ–Ω—ã —Ç—É–Ω–Ω–µ–ª—è. –ö–∞–º–Ω–∏ —Å—ã–ø–ª—é—Ç—Å—è, –Ω–æ –ø—Ä–æ—Ö–æ–¥ –¥–µ—Ä–∂–∏—Ç—Å—è. –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –æ–Ω–∏ –≤—ã–±–µ–≥–∞—é—Ç –≤ –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –∫–æ—Ä–∏–¥–æ—Ä, –∏ –≤–ø–µ—Ä–µ–¥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–∞–±—ã–π —Å–≤–µ—Ç ‚Äî —Å–≤–µ—Ç –¥–Ω—è, –ø—Ä–æ–Ω–∏–∫–∞—é—â–∏–π —á–µ—Ä–µ–∑ –≤—Ö–æ–¥ –≤ –ø–µ—â–µ—Ä—É.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo5',
                text: '<span class="character-name">–ü–ï–†–ï–î–´–®–ö–ê</span>:<br><br>–°–ø—É—Å—Ç—è —á–∞—Å –±–µ–≥–∞ –ø–æ –∏–∑–≤–∏–ª–∏—Å—Ç—ã–º —Ç—É–Ω–Ω–µ–ª—è–º –ù–∏–∫ –Ω–∞–∫–æ–Ω–µ—Ü –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –ø—Ä–∏—Å–ª–æ–Ω–∏–≤—à–∏—Å—å –∫ —Ö–æ–ª–æ–¥–Ω–æ–π —Å—Ç–µ–Ω–µ. –ó–≤—É–∫–∏ –¥—Ä–∞–∫–æ–Ω–∞ –¥–∞–≤–Ω–æ –∑–∞—Ç–∏—Ö–ª–∏ –≤–¥–∞–ª–µ–∫–µ.<br><br><span class="character-name">–Æ–ú–ò</span> (–æ–ø—É—Å–∫–∞—è—Å—å –Ω–∞ –∫–æ–ª–µ–Ω–∏):<br>–ú—ã... –º—ã –æ—Ç–æ—Ä–≤–∞–ª–∏—Å—å –æ—Ç –Ω–µ–≥–æ...',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo8',
                text: '<span class="character-name">–ö–†–ò–°–¢–ê–õ–õ</span>:<br><br>–ù–∏–∫ –¥–æ—Å—Ç–∞—ë—Ç –∏–∑ —Å—É–º–∫–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª. –î–∞–∂–µ –≤ —Ç–µ–º–Ω–æ—Ç–µ —Ç—É–Ω–Ω–µ–ª—è –æ–Ω —Å–≤–µ—Ç–∏—Ç—Å—è –º—è–≥–∫–∏–º –æ—Ä–∞–Ω–∂–µ–≤—ã–º —Å–≤–µ—Ç–æ–º, –æ—Ç–±—Ä–∞—Å—ã–≤–∞—è –Ω–∞ —Å—Ç–µ–Ω—ã –ø—Ä–∏—á—É–¥–ª–∏–≤—ã–µ —Ç–µ–Ω–∏.<br><br><span class="character-name">–ù–ò–ö</span> (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –∫–∞—Å–∞—è—Å—å –∫—Ä–∏—Å—Ç–∞–ª–ª–∞):<br>–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —ç—Ç–æ... –ß—É–≤—Å—Ç–≤—É–µ—à—å —Ç–µ–ø–ª–æ? –ö–∞–∫ –±—É–¥—Ç–æ –¥–µ—Ä–∂–∏—à—å –º–∞–ª–µ–Ω—å–∫–æ–µ —Å–æ–ª–Ω—Ü–µ –≤ —Ä—É–∫–µ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo8',
                text: '<span class="character-name">–Æ–ú–ò</span> (–∑–∞–≤–æ—Ä–æ–∂—ë–Ω–Ω–æ):<br>–û–Ω... –∂–∏–≤–æ–π? –ò–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –º–∞–≥–º—ã?<br><br><span class="character-name">–ù–ò–ö</span> (–≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∞—è):<br>–ù–µ—Ç, —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–∞–º–µ–Ω—å. –°–º–æ—Ç—Ä–∏ ‚Äî –≤–Ω—É—Ç—Ä–∏ —á—Ç–æ-—Ç–æ –¥–≤–∏–∂–µ—Ç—Å—è, –∫–∞–∫ —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–æ–µ –∑–æ–ª–æ—Ç–æ. –ì–æ–≤–æ—Ä—è—Ç, —Ç–∞–∫–∏–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∫–ª—é—á–æ–º...',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo8',
                text: '<span class="character-name">–ù–ò–ö</span> (–∑–∞–º–æ–ª–∫–∞–µ—Ç, –∑–∞—Ç–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç–∏—à–µ):<br>...–∫–ª—é—á–æ–º –∫ —á–µ–º—É-—Ç–æ –±–æ–ª–µ–µ –¥—Ä–µ–≤–Ω–µ–º—É, —á–µ–º –¥—Ä–∞–∫–æ–Ω—ã. –ù–æ –æ–± —ç—Ç–æ–º –ø–æ–∑–∂–µ. –°–µ–π—á–∞—Å –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—ã—Ö–æ–¥.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo6',
                text: '<span class="character-name">–ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –ü–£–¢–ò</span>:<br><br>–û–Ω–∏ –∏–¥—É—Ç –¥–∞–ª—å—à–µ –ø–æ —Ç—É–Ω–Ω–µ–ª—é, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å—ë —à–∏—Ä–µ –∏ –ø—Ä–æ—Ö–ª–∞–¥–Ω–µ–µ. –í–ª–∞–∂–Ω—ã–π –≤–æ–∑–¥—É—Ö –ø–∞—Ö–Ω–µ—Ç –º—Ö–æ–º –∏ —Å—ã—Ä–æ—Å—Ç—å—é ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ —Ç–æ–≥–æ, —á—Ç–æ –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º –µ—Å—Ç—å –≤–æ–¥–∞.<br><br><span class="character-name">–Æ–ú–ò</span> (–ø—Ä–∏—Å–ª—É—à–∏–≤–∞—è—Å—å):<br>–¢—ã —Å–ª—ã—à–∏—à—å? –ö–∞–∫ –±—É–¥—Ç–æ... –∂—É—Ä—á–∞–Ω–∏–µ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo6',
                text: '–¢—É–Ω–Ω–µ–ª—å –≤–µ–¥—ë—Ç –∏—Ö –≤–Ω–∏–∑, –≤ –µ—â—ë –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–µ —Å–ª–æ–∏ –≥–æ—Ä—ã. –°—Ç–µ–Ω—ã –ø–æ–∫—Ä—ã—Ç—ã –±–ª–µ—Å—Ç—è—â–∏–º–∏ –º–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–º–∏ –æ—Ç–ª–æ–∂–µ–Ω–∏—è–º–∏, –∞ –ø–æ–¥ –Ω–æ–≥–∞–º–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–ª–µ–¥—ã –≤–ª–∞–≥–∏. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–∞–¥–∞—Ç—å, –∏ –∂–∞—Ä –ø–µ—â–µ—Ä—ã –¥—Ä–∞–∫–æ–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –¥–∞–ª–µ–∫–æ –ø–æ–∑–∞–¥–∏.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo6',
                text: '<span class="character-name">–ù–ò–ö</span> (–æ—Å–º–∞—Ç—Ä–∏–≤–∞—è —Ä–∞–∑–≤–∏–ª–∫—É):<br>–ù–∞–ø—Ä–∞–≤–æ —Ç—É–Ω–Ω–µ–ª—å —Å—É–∂–∞–µ—Ç—Å—è, –Ω–∞–ª–µ–≤–æ ‚Äî —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è. –ò –æ—Ç—Ç—É–¥–∞ –∏–¥—ë—Ç —Ç–æ—Ç —Å–∞–º—ã–π –∑–≤—É–∫ –≤–æ–¥—ã.<br><br><span class="character-name">–Æ–ú–ò</span> (—É–∫–∞–∑—ã–≤–∞—è –Ω–∞–ª–µ–≤–æ):<br>–¢—É–¥–∞. –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–¥–∞, –∑–Ω–∞—á–∏—Ç, –µ—Å—Ç—å –∏ –≤—ã—Ö–æ–¥ –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo7',
                text: '<span class="character-name">–ü–û–î–ó–ï–ú–ù–û–ï –û–ó–ï–†–û</span>:<br><br>–¢—É–Ω–Ω–µ–ª—å –≤–Ω–µ–∑–∞–ø–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –æ–≥—Ä–æ–º–Ω—É—é –ø–µ—â–µ—Ä—É, –ø–æ—Ç–æ–ª–æ–∫ –∫–æ—Ç–æ—Ä–æ–π —Ç–µ—Ä—è–µ—Ç—Å—è –≤ —Ç–µ–º–Ω–æ—Ç–µ. –ù–æ —Å–∞–º–æ–µ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–µ ‚Äî –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–µ—â–µ—Ä—ã –ª–µ–∂–∏—Ç –æ–∑–µ—Ä–æ –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ —á–∏—Å—Ç–æ–π –≤–æ–¥—ã, –æ—Å–≤–µ—â—ë–Ω–Ω–æ–µ –≥–æ–ª—É–±–æ–≤–∞—Ç—ã–º —Å–≤–µ—Ç–æ–º, –∏—Å—Ö–æ–¥—è—â–∏–º –æ—Ç –±–∏–æ–ª—é–º–∏–Ω–µ—Å—Ü–µ–Ω—Ç–Ω—ã—Ö –≥—Ä–∏–±–æ–≤ –Ω–∞ —Å—Ç–µ–Ω–∞—Ö.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo7',
                text: '–í–æ–¥–∞ –≤ –æ–∑–µ—Ä–µ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞, —á—Ç–æ –≤–∏–¥–Ω–æ –¥–Ω–æ, —É—Å—ã–ø–∞–Ω–Ω–æ–µ –±–µ–ª—ã–º –ø–µ—Å–∫–æ–º –∏ –≥–ª–∞–¥–∫–∏–º–∏ –∫–∞–º–Ω—è–º–∏. –° –ø–æ—Ç–æ–ª–∫–∞ —Å–≤–∏—Å–∞—é—Ç —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç—ã, —Å –∫–æ–Ω—á–∏–∫–æ–≤ –∫–æ—Ç–æ—Ä—ã—Ö –∫–∞–ø–∞–µ—Ç –≤–æ–¥–∞, —Å–æ–∑–¥–∞–≤–∞—è —Ç–∏—Ö—É—é, —É–º–∏—Ä–æ—Ç–≤–æ—Ä—è—é—â—É—é –º—É–∑—ã–∫—É.<br><br><span class="character-name">–Æ–ú–ò</span> (–∑–∞–≤–æ—Ä–æ–∂—ë–Ω–Ω–æ):<br>–≠—Ç–æ... –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ...',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo7',
                text: '<span class="character-name">–ù–ò–ö</span> (–ø–æ–¥—Ö–æ–¥—è –∫ –∫—Ä–∞—é –≤–æ–¥—ã):<br>–°–º–æ—Ç—Ä–∏ ‚Äî –Ω–∞ —Ç–æ–π —Å—Ç–æ—Ä–æ–Ω–µ. –í–∏–¥–∏—à—å –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ?<br><br>–í —Å–ø–æ–∫–æ–π–Ω–æ–π –≤–æ–¥–µ –æ–∑–µ—Ä–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ª–∞–±—ã–π –ª—É—á —Å–≤–µ—Ç–∞, –ø—Ä–æ–±–∏–≤–∞—é—â–∏–π—Å—è —Å–∫–≤–æ–∑—å —Ç—Ä–µ—â–∏–Ω—É –≤ –¥–∞–ª—å–Ω–µ–º –∫–æ–Ω—Ü–µ –ø–µ—â–µ—Ä—ã.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo7',
                text: '<span class="character-name">–Æ–ú–ò</span> (–≤–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω–æ):<br>–≠—Ç–æ... –¥–Ω–µ–≤–Ω–æ–π —Å–≤–µ—Ç! –í—ã—Ö–æ–¥!<br><br><span class="character-name">–ù–ò–ö</span> (—É–ª—ã–±–∞—è—Å—å):<br>–û–∑–µ—Ä–æ –Ω–µ —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–ª–æ –Ω–∞–º –ø—É—Ç—å, –Ω–æ –∏ –¥–∞–ª–æ –Ω–∞–¥–µ–∂–¥—É. –í–æ–¥–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ—Ä–æ–≥—É –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo9',
                text: '<span class="character-name">–í–´–•–û–î –ò–ó –ü–ï–©–ï–†–´</span>:<br><br>–ù–∏–∫ –∏ –Æ–º–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –∫–∞—Ä–∞–±–∫–∞—Ç—å—Å—è –ø–æ —É–∑–∫–æ–º—É –ø—Ä–æ—Ö–æ–¥—É, –∫–æ—Ç–æ—Ä—ã–π –≤–µ–¥—ë—Ç –≤–≤–µ—Ä—Ö. –°–≤–µ—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å—ë —è—Ä—á–µ, –∞ –≤–æ–∑–¥—É—Ö ‚Äî —Å–≤–µ–∂–µ–µ. –û–Ω–∏ —Å–ª—ã—à–∞—Ç —à—É–º –≤–µ—Ç—Ä–∞ –∏ —á—É–≤—Å—Ç–≤—É—é—Ç —Ö–æ–ª–æ–¥–Ω—ã–π –≥–æ—Ä–Ω—ã–π –≤–æ–∑–¥—É—Ö.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo9',
                text: '–ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –æ–Ω–∏ –¥–æ—Å—Ç–∏–≥–∞—é—Ç —É–∑–∫–æ–≥–æ –≤—ã—Ö–æ–¥–∞, —Å–∫–≤–æ–∑—å –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–Ω–æ –Ω–µ–±–æ. –ù–∏–∫ –ø–æ–º–æ–≥–∞–µ—Ç –Æ–º–∏ –≤—ã–±—Ä–∞—Ç—å—Å—è –Ω–∞—Ä—É–∂—É, –∞ –∑–∞—Ç–µ–º –∏ —Å–∞–º –≤—ã–ª–µ–∑–∞–µ—Ç –∏–∑ —Ç–µ–º–Ω–æ—Ç—ã –ø–µ—â–µ—Ä—ã.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo10',
                text: '<span class="character-name">–ì–û–†–ù–´–ô –°–ö–õ–û–ù</span>:<br><br>–û–Ω–∏ —Å—Ç–æ—è—Ç –Ω–∞ —Å–∫–ª–æ–Ω–µ –≥–æ—Ä—ã, –Ω–∞–¥ –ø—Ä–æ–ø–∞—Å—Ç—å—é. –í–Ω–∏–∑—É, –≤ –¥–æ–ª–∏–Ω–µ, –≤–∏–¥–Ω–∞ –¥–µ—Ä–µ–≤–Ω—è ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–µ –¥–æ–º–∏–∫–∏, –¥—ã–º –∏–∑ —Ç—Ä—É–±, –æ—Å–≤–µ—â—ë–Ω–Ω—ã–µ –æ–∫–Ω–∞. –ü–æ—Å–ª–µ –¥–æ–ª–≥–∏—Ö —á–∞—Å–æ–≤ –≤ —Ç–µ–º–Ω–æ—Ç–µ –ø–µ—â–µ—Ä—ã —ç—Ç–æ—Ç –≤–∏–¥ –∫–∞–∂–µ—Ç—Å—è –Ω–µ—Ä–µ–∞–ª—å–Ω—ã–º.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo10',
                text: '<span class="character-name">–Æ–ú–ò</span> (–≤–¥—ã—Ö–∞—è —Ö–æ–ª–æ–¥–Ω—ã–π –≤–æ–∑–¥—É—Ö):<br>–ú—ã... –º—ã –≤—ã–±—Ä–∞–ª–∏—Å—å. –Ø –Ω–µ –≤–µ—Ä–∏–ª–∞, —á—Ç–æ –º—ã —Å–º–æ–∂–µ–º...<br><br><span class="character-name">–ù–ò–ö</span> (—Å–º–æ—Ç—Ä—è –Ω–∞ –¥–µ—Ä–µ–≤–Ω—é):<br>–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –¥–æ–±—Ä–∞—Ç—å—Å—è —Ç—É–¥–∞. –ö—Ä–∏—Å—Ç–∞–ª–ª —É –Ω–∞—Å, –Ω–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ.',
                hasChoices: false
            },
            {
                video: 'cutsceneVideo11',
                text: '<span class="character-name">–§–ò–ù–ê–õ–¨–ù–´–ô –í–ò–î</span>:<br><br>–ù–∏–∫ –∏ –Æ–º–∏ —Å—Ç–æ—è—Ç –Ω–∞ —Å–∫–ª–æ–Ω–µ –≥–æ—Ä—ã, —Å–º–æ—Ç—Ä—è –Ω–∞ –¥–µ—Ä–µ–≤–Ω—é –≤–Ω–∏–∑—É. –ö—Ä–∏—Å—Ç–∞–ª–ª –≤ —Ä—É–∫–µ –ù–∏–∫–∞ –º—è–≥–∫–æ —Å–≤–µ—Ç–∏—Ç—Å—è –≤ —Å—É–º–µ—Ä–∫–∞—Ö. –ò—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–µ—â–µ—Ä–µ –¥—Ä–∞–∫–æ–Ω–∞ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å, –Ω–æ –Ω–æ–≤–æ–µ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...',
                hasChoices: false
            }
        ];
        
        // –°–æ–±—ã—Ç–∏—è –º–∏–Ω–∏-–∏–≥—Ä—ã
        this.events = {
    5: {  // –î–û–ë–ê–í–õ–ï–ù–û –ù–û–í–û–ï –°–û–ë–´–¢–ò–ï –° –ú–ï–ß–û–ú
        type: 'sword_choice', 
        done: false,
        title: '–ù–ï–õ–ï–ü–´–ô –í–´–ë–û–†',
        description: '–í—ã –≤—Å–ø–æ–º–∏–Ω–∞–µ—Ç–µ –ø—Ä–æ –º–µ—á, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—à–ª–∏ –≤ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å. –ú–æ–∂–µ—Ç, —Å—Ç–æ–∏—Ç –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?',
        risky: {
            name: '–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –£–î–ê–†–ò–¢–¨ –ú–ï–ß–û–ú',
            description: '–ê–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑—É–º–Ω–∞—è, –Ω–æ —Å–º–µ–ª–∞—è –∏–¥–µ—è',
            details: [
                '–®–∞–Ω—Å –Ω–∞ —É—Å–ø–µ—Ö: 1%',
                '–ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –ò–ù–°–¢–ê–ù–¢-–ü–û–ë–ï–î–ê!',
                '–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ: –î—Ä–∞–∫–æ–Ω –ü–†–û–°–´–ü–ê–ï–¢–°–Ø –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!',
                '+50% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ'
            ],
            outcome: 'üé≤ 1% –Ω–∞ —á—É–¥–æ, 99% –Ω–∞ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É'
        },
        safe: {
            name: '–û–°–¢–ê–í–ò–¢–¨ –ú–ï–ß –í –ü–û–ö–û–ï',
            description: '–†–∞–∑—É–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ',
            details: [
                '–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥',
                '+1 –æ–±—ã—á–Ω—ã–π —à–∞–≥ –≤–ø–µ—Ä—ë–¥',
                '-10% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ—Å–æ–∑–Ω–∞–Ω–∏–µ —Å–≤–æ–µ–π –≥–ª—É–ø–æ—Å—Ç–∏)',
                '–ú–µ—á –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ'
            ],
            outcome: 'üß† –ú—É–¥—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ'
        }
    },
    10: { 
        type: 'crack', 
        done: false,
        title: '–¢–†–ï–©–ò–ù–ê –° –ú–ê–ì–ú–û–ô',
        description: '–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –≥–ª—É–±–æ–∫–∞—è —Ç—Ä–µ—â–∏–Ω–∞, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è –∫—Ä–∞—Å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –º–∞–≥–º—ã. –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å, –∫–∞–∫ –µ—ë –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å.',
        risky: {
            name: '–ü–ï–†–ï–ü–†–´–ì–ù–£–¢–¨ –ß–ï–†–ï–ó –¢–†–ï–©–ò–ù–£',
            description: '–û–ß–ï–ù–¨ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–π, –Ω–æ –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±',
            details: [
                '–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: 70%',
                '–ü—Ä–∏ —É—Å–ø–µ—Ö–µ: +3 —à–∞–≥–∞ –≤–ø–µ—Ä—ë–¥!',
                '–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ: –î—Ä–∞–∫–æ–Ω –ü–†–û–°–´–ü–ê–ï–¢–°–Ø –æ—Ç –≤—Å–ø–ª–µ—Å–∫–∞ –º–∞–≥–º—ã!',
                '+5% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ'
            ],
            outcome: 'üé≤ 70% –Ω–∞ –ë–û–õ–¨–®–û–ô –í–´–ò–ì–†–´–®, 30% –Ω–∞ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É'
        },
        safe: {
            name: '–û–ë–û–ô–¢–ò –ü–û –ö–†–ê–Æ',
            description: '–ú–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω–æ –Ω–∞–¥—ë–∂–Ω—ã–π –ø—É—Ç—å –ø–æ –∫—Ä–∞—é —Ç—Ä–µ—â–∏–Ω—ã',
            details: [
                '–ê–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ',
                '–ë–µ–∑ —Ä–∏—Å–∫–∞ —Ä–∞–∑–±—É–¥–∏—Ç—å –¥—Ä–∞–∫–æ–Ω–∞',
                '-5% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –æ–∫—É–ø–∞–µ—Ç—Å—è)',
                '–®–∞–≥ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è - –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ'
            ],
            outcome: 'üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å'
        }
    },
    20: { 
        type: 'stalactites', 
        done: false,
        title: '–†–ê–°–ö–ê–õ–Å–ù–ù–´–ï –°–¢–ê–õ–ê–ö–¢–ò–¢–´',
        description: '–ü–æ—Ç–æ–ª–æ–∫ —É—Å—ã–ø–∞–Ω –Ω–∞–≥—Ä–µ—Ç—ã–º–∏ —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç–∞–º–∏. –û–¥–∏–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π —à–∞–≥ - –∏ –≥—Ä–æ—Ö–æ—Ç –ø–∞–¥–∞—é—â–µ–≥–æ –∫–∞–º–Ω—è —Ä–∞–∑–±—É–¥–∏—Ç –¥—Ä–∞–∫–æ–Ω–∞!',
        risky: {
            name: '–ë–´–°–¢–†–û –ü–†–û–ë–ï–ñ–ê–¢–¨ –ü–û–î –ù–ò–ú–ò',
            description: '–°—ç–∫–æ–Ω–æ–º–∏—Ç—å –≤—Ä–µ–º—è, –Ω–æ —Ä–∏—Å–∫–æ–≤–∞—Ç—å',
            details: [
                '–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: 50%',
                '–ü—Ä–∏ —É—Å–ø–µ—Ö–µ: +3 —à–∞–≥–∞ –≤–ø–µ—Ä—ë–¥!',
                '–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ: +40% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                '–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ: –î—Ä–∞–∫–æ–Ω –ü–†–û–°–´–ü–ê–ï–¢–°–Ø!'
            ],
            outcome: '‚ö° 50/50 - –ª–∏–±–æ –±–æ–ª—å—à–æ–π –≤—ã–∏–≥—Ä—ã—à, –ª–∏–±–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞'
        },
        safe: {
            name: '–¢–ò–•–û –ü–†–û–ô–¢–ò –ú–ï–ñ–î–£ –ù–ò–ú–ò',
            description: '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –∏ –±–µ–∑ —Ä–∏—Å–∫–∞',
            details: [
                '–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥',
                '+1 –æ–±—ã—á–Ω—ã–π —à–∞–≥ –≤–ø–µ—Ä—ë–¥',
                '–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è',
                '–ù–µ—Ç —Ä–∏—Å–∫–∞ —Ä–∞–∑–±—É–¥–∏—Ç—å –¥—Ä–∞–∫–æ–Ω–∞'
            ],
            outcome: '‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å'
        }
    },
    25: { 
        type: 'fork', 
        done: false,
        title: '–†–ê–ó–í–ò–õ–ö–ê –£ –¢–ï–ü–õ–û–í–û–ì–û –ò–°–¢–û–ß–ù–ò–ö–ê',
        description: '–î–≤–µ —Ç—Ä–æ–ø—ã –≤–µ–¥—É—Ç –∫ —Ü–µ–ª–∏. –ü—Ä–∞–≤–∞—è ‚Äî –∫–æ—Ä–æ—á–µ, –Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ä—è–¥–æ–º —Å –≥–µ–æ—Ç–µ—Ä–º–∞–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º. –õ–µ–≤–∞—è ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, –Ω–æ –¥–ª–∏–Ω–Ω–µ–µ.',
        risky: {
            name: '–ü–†–ê–í–ê–Ø –¢–†–û–ü–ê (–ß–ï–†–ï–ó –ò–°–¢–û–ß–ù–ò–ö)',
            description: '–ë–ª–∏–∂–µ –∫ —Ç–µ–ø–ª—É –¥—Ä–∞–∫–æ–Ω–∞, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ',
            details: [
                '–ö–æ—Ä–æ—Ç–∫–∏–π –ø—É—Ç—å: +2 —à–∞–≥–∞ –∑–∞ —Ä–∞–∑',
                '–ù–æ –±–ª–∏–∂–µ –∫ –¥—Ä–∞–∫–æ–Ω—É: +20% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                '–†–∏—Å–∫ –≤—ã—à–µ –æ–±—ã—á–Ω–æ–≥–æ',
                '–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏'
            ],
            outcome: 'üìà +2 —à–∞–≥–∞, –Ω–æ +20% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'
        },
        safe: {
            name: '–õ–ï–í–ê–Ø –¢–†–û–ü–ê (–í –û–¢–î–ê–õ–ï–ù–ò–ò)',
            description: '–î–∞–ª—å—à–µ –æ—Ç —Ç–µ–ø–ª–∞ –¥—Ä–∞–∫–æ–Ω–∞, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ',
            details: [
                '–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç',
                '+1 –æ–±—ã—á–Ω—ã–π —à–∞–≥ –≤–ø–µ—Ä—ë–¥',
                '–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è',
                '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫'
            ],
            outcome: 'üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ'
        }
    }
};
        
        this.yumiStates = {
            sitting: { image: 'img/Yumi sitting.svg', className: 'float', description: '–Æ–º–∏ —Å–∏–¥–∏—Ç –∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç' },
            pointing: { image: 'img/Yumi pointing.svg', className: 'pulse', description: '–Æ–º–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ' },
            panicking: { image: 'img/Yumi panicking.svg', className: 'shake', description: '–Æ–º–∏ –≤ –ø–∞–Ω–∏–∫–µ!' },
            whispering: { image: 'img/Yumi whispering.svg', className: 'stealth-glow', description: '–Æ–º–∏ —à–µ–ø—á–µ—Ç —Å–æ–≤–µ—Ç' },
            success: { image: 'img/Yumi pointing.svg', className: 'success-glow', description: '–Æ–º–∏ —Ä–∞–¥—É–µ—Ç—Å—è —É—Å–ø–µ—Ö—É!' },
            danger: { image: 'img/Yumi panicking.svg', className: 'danger-glow', description: '–Æ–º–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏!' },
            warning: { image: 'img/Yumi whispering.svg', className: 'warning-glow', description: '–Æ–º–∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–∏—á–∞–µ—Ç' }
        };
        
        this.risks = { sleeping: 10, restless: 60, awake: 90 };
        this.elements = {};
        this.stateHistory = [];
        
        this.init();
    }
    
    initAudio() {
        try {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.log('Web Audio API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        }
        
        this.loadAudioSettings();
        this.createAmbientMusic();
    }
    
    createAmbientMusic() {
        this.stopBackgroundMusic();
        
        if (!this.musicEnabled) return;
        
        try {
            this.backgroundMusic = new Audio();
            this.backgroundMusic.src = 'audio/Moist Soul - Inner Beauty [audiovk.com].mp3';
            this.backgroundMusic.loop = true;
            this.backgroundMusic.volume = this.musicVolume;
            this.backgroundMusic.preload = 'auto';
            
            const playPromise = this.backgroundMusic.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('–≠–º–±–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω');
                    })
                    .catch(error => {
                        const startOnInteraction = () => {
                            if (this.musicEnabled && this.backgroundMusic) {
                                this.backgroundMusic.play()
                                    .then(() => {
                                        console.log('–≠–º–±–∏–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è');
                                    })
                                    .catch(e => console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç–º–±–∏–µ–Ω—Ç'));
                            }
                            document.removeEventListener('click', startOnInteraction);
                            document.removeEventListener('keydown', startOnInteraction);
                        };
                        
                        document.addEventListener('click', startOnInteraction);
                        document.addEventListener('keydown', startOnInteraction);
                    });
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–∏–µ–Ω—Ç–∞:', error);
        }
    }
    
    stopBackgroundMusic() {
        if (this.backgroundMusic) {
            this.backgroundMusic.pause();
            this.backgroundMusic.currentTime = 0;
            this.backgroundMusic = null;
        }
    }
    
    loadAudioSettings() {
        const savedMusic = localStorage.getItem('dragonGameMusicEnabled');
        const savedVolume = localStorage.getItem('dragonGameMusicVolume');
        
        if (savedMusic !== null) {
            this.musicEnabled = savedMusic === 'true';
        }
        
        if (savedVolume !== null) {
            this.musicVolume = parseFloat(savedVolume);
        }
    }
    
    init() {
        this.setupElements();
        this.setupEvents();
        this.setupVideoHandlers();
        this.updateUI();
        this.setYumiState('sitting');
    }
    
    setupElements() {
        this.elements = {
            titleScreen: document.getElementById('titleScreen'),
            cutsceneScreen: document.getElementById('cutsceneScreen'),
            gameScene: document.getElementById('gameScene'),
            minigameIntro: document.getElementById('minigameIntro'),
            startMinigameBtn: document.getElementById('startMinigameBtn'),
            finalScreen: document.getElementById('finalScreen'),
            returnButton: document.getElementById('returnButton'),
            
            cutsceneVideo1: document.getElementById('cutsceneVideo1'),
            cutsceneVideo2: document.getElementById('cutsceneVideo2'),
            cutsceneVideo3: document.getElementById('cutsceneVideo3'),
            cutsceneVideo4: document.getElementById('cutsceneVideo4'),
            cutsceneVideo5: document.getElementById('cutsceneVideo5'),
            cutsceneVideo6: document.getElementById('cutsceneVideo6'),
            cutsceneVideo7: document.getElementById('cutsceneVideo7'),
            cutsceneVideo8: document.getElementById('cutsceneVideo8'),
            cutsceneVideo9: document.getElementById('cutsceneVideo9'),
            cutsceneVideo10: document.getElementById('cutsceneVideo10'),
            cutsceneVideo11: document.getElementById('cutsceneVideo11'),
            cutsceneText: document.getElementById('cutsceneText'),
            cutsceneNextBtn: document.getElementById('cutsceneNextBtn'),
            dialogueChoices: document.getElementById('dialogueChoices'),
            
            dragonSleepVideo: document.getElementById('dragonSleepVideo'),
            dragonRestlessVideo: document.getElementById('dragonRestlessVideo'),
            dragonAwakeVideo: document.getElementById('dragonAwakeVideo'),
            startButton: document.getElementById('startButton'),
            stepButton: document.getElementById('stepButton'),
            waitButton: document.getElementById('waitButton'),
            stoneButton: document.getElementById('stoneButton'),
            soundToggle: document.getElementById('soundToggle'),
            musicToggle: document.getElementById('musicToggle'),
            musicControls: document.getElementById('musicControls'),
            volumeSlider: document.getElementById('volumeSlider'),
            volumeValue: document.getElementById('volumeValue'),
            dragonStatus: document.getElementById('dragonStatus'),
            stepCounter: document.getElementById('stepCounter'),
            alertnessFill: document.getElementById('alertnessFill'),
            alertnessPercent: document.getElementById('alertnessPercent'),
            hintText: document.getElementById('hintText'),
            eventOverlay: document.getElementById('eventOverlay'),
            eventTitle: document.getElementById('eventTitle'),
            eventDescription: document.getElementById('eventDescription'),
            eventChoice1: document.getElementById('eventChoice1'),
            eventChoice2: document.getElementById('eventChoice2'),
            stoneResultOverlay: document.getElementById('stoneResultOverlay'),
            stoneResultBox: document.getElementById('stoneResultBox'),
            stoneResultTitle: document.getElementById('stoneResultTitle'),
            stoneResultDescription: document.getElementById('stoneResultDescription'),
            stoneContinueBtn: document.getElementById('stoneContinueBtn')
        };
    }
    
    startGame() {
        this.state = 'cutscene';
        this.cutsceneIndex = 0;
        
        this.elements.titleScreen.style.display = 'none';
        this.elements.cutsceneScreen.style.display = 'flex';
        this.elements.gameScene.style.display = 'none';
        this.elements.finalScreen.style.display = 'none';
        
        this.showCutscene();
    }
    
    showCutscene() {
        let cutsceneArray;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π –º–∞—Å—Å–∏–≤ —Å—Ü–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
    if (this.state === 'postMinigame') {
        cutsceneArray = this.postMinigameCutscenes;
    } else {
        cutsceneArray = this.cutscenes;
    }
    
    if (this.cutsceneIndex >= cutsceneArray.length) {
        if (this.state === 'postMinigame') {
            // –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –ø–æ—Å—Ç-–º–∏–Ω–∏-–∏–≥—Ä–æ–≤—ã—Ö —Å—Ü–µ–Ω
            this.showFinalScreen();
            return;
        } else {
            this.showMinigameIntro();
            return;
        }
    }
    
    const cutscene = cutsceneArray[this.cutsceneIndex]
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
        const videos = [
            'cutsceneVideo1', 'cutsceneVideo2', 'cutsceneVideo3', 'cutsceneVideo4',
            'cutsceneVideo5', 'cutsceneVideo6', 'cutsceneVideo7', 'cutsceneVideo8',
            'cutsceneVideo9', 'cutsceneVideo10', 'cutsceneVideo11'
        ];
        
        videos.forEach(video => {
            if (this.elements[video]) {
                this.elements[video].classList.remove('active');
                this.elements[video].pause();
            }
        });
        
         // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω–æ–µ –≤–∏–¥–µ–æ
    const newVideo = this.elements[cutscene.video];
    if (newVideo) {
        newVideo.classList.add('active');
        
        // –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –∏ –ù–ï –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ!
        // –í–∏–¥–µ–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å
        if (newVideo.paused) {
            const playPromise = newVideo.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log(`–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤–∏–¥–µ–æ: ${cutscene.video}`);
                }).catch(e => {
                    console.log(`–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ ${cutscene.video}:`, e.name);
                });
            }
        }
    }
    
    this.elements.cutsceneText.innerHTML = cutscene.text;
    
    if (cutscene.hasChoices && cutscene.choices) {
        this.elements.dialogueChoices.style.display = 'grid';
        this.showCutsceneChoices(cutscene.choices);
    } else {
        this.elements.dialogueChoices.style.display = 'none';
    }
}

    
    showCutsceneChoices(choices) {
        this.elements.dialogueChoices.innerHTML = '';
        
        choices.forEach((choice, index) => {
            const button = document.createElement('button');
            button.className = 'dialogue-choice';
            button.innerHTML = choice.text;
            button.addEventListener('click', () => {
                this.selectCutsceneChoice(choice);
            });
            this.elements.dialogueChoices.appendChild(button);
        });
    }
    
    selectCutsceneChoice(choice) {
        console.log('–í—ã–±—Ä–∞–Ω –æ—Ç–≤–µ—Ç:', choice.text, '–≠—Ñ—Ñ–µ–∫—Ç:', choice.effect);
        
        if (choice.effect.includes('–ù–∞—á–∞–ª—å–Ω–∞—è –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -')) {
            const percent = parseInt(choice.effect.match(/\d+/)[0]);
            this.alertness = Math.max(0, this.alertness - percent);
        }
        
        this.nextCutscene();
    }
    
    nextCutscene() {
    this.cutsceneIndex++;
    this.playPixelSound('click');
    
    // –í–ê–ñ–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ
    // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ
    this.showCutscene();
}
    
    showMinigameIntro() {
        this.state = 'minigame';
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
        const videos = [
            'cutsceneVideo1', 'cutsceneVideo2', 'cutsceneVideo3', 'cutsceneVideo4',
            'cutsceneVideo5', 'cutsceneVideo6', 'cutsceneVideo7', 'cutsceneVideo8',
            'cutsceneVideo9', 'cutsceneVideo10', 'cutsceneVideo11'
        ];
        
        videos.forEach(video => {
            if (this.elements[video]) {
                this.elements[video].pause();
                this.elements[video].classList.remove('active');
            }
        });
        
        this.elements.cutsceneScreen.style.display = 'none';
        this.elements.gameScene.style.display = 'flex';
        this.elements.minigameIntro.style.display = 'flex';
        this.elements.finalScreen.style.display = 'none';
        
        this.elements.dragonSleepVideo.classList.add('active');
        this.elements.dragonSleepVideo.play().catch(e => console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ –¥—Ä–∞–∫–æ–Ω–∞"));
    }
    
    startMinigame() {
        this.elements.minigameIntro.style.display = 'none';
        this.resetMinigame();
    }
    
    resetMinigame() {
        this.step = 0;
        this.alertness = 0;
        this.dragonState = 'sleeping';
        this.hasStone = false;
        this.stoneUsed = false;
        this.canAct = true;
        this.videoPlaying = false;
        this.justRestless = false;
        this.pauseMode = false;
        this.awakeCount = 0;
        this.firstVideoPlayed = false;
        this.stateHistory = ['sleeping'];
        
        if (this.awakeBlockTimer) {
            clearTimeout(this.awakeBlockTimer);
            this.awakeBlockTimer = null;
        }
        
        Object.keys(this.events).forEach(key => {
            this.events[key].done = false;
        });
        
        this.elements.stoneButton.style.display = 'none';
        this.elements.eventOverlay.style.display = 'none';
        this.elements.stoneResultOverlay.style.display = 'none';
        
        this.setYumiState('sitting');
        this.showHint('–¢–∏—Ö–æ... –ù–∞—á–∏–Ω–∞–µ–º –ø—É—Ç—å...');
        this.updateUI();
    }
    
    winGame() {
        this.showHint('üéâ –ö–†–ò–°–¢–ê–õ–õ –£–ö–†–ê–î–ï–ù!');
        this.playPixelSound('success');
        this.stopBackgroundMusic();
        
        setTimeout(() => {
            // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞—Ç-—Å—Ü–µ–Ω–µ
            this.elements.gameScene.style.opacity = '0';
            this.elements.gameScene.classList.add('fade-transition');
            
            setTimeout(() => {
                this.state = 'postMinigame';
                this.cutsceneIndex = 0;
                
                this.elements.gameScene.style.display = 'none';
                this.elements.cutsceneScreen.style.display = 'flex';
                this.elements.cutsceneScreen.style.opacity = '0';
                this.elements.cutsceneScreen.classList.add('fade-transition');
                
                setTimeout(() => {
                    this.elements.cutsceneScreen.classList.remove('fade-transition');
                    this.elements.cutsceneScreen.classList.add('fade-in');
                    this.elements.cutsceneScreen.style.opacity = '1';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ü–µ–Ω—É –ø–æ—Å–ª–µ –º–∏–Ω–∏-–∏–≥—Ä—ã
                    this.showCutscene();
                }, 50);
            }, 500);
        }, 1500);
    }
    
    showFinalScreen() {
        // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É
        this.elements.cutsceneScreen.classList.add('fade-transition');
        this.elements.cutsceneScreen.style.opacity = '0';
        
        setTimeout(() => {
            this.elements.cutsceneScreen.style.display = 'none';
            this.elements.finalScreen.style.display = 'flex';
            this.elements.finalScreen.style.opacity = '0';
            this.elements.finalScreen.classList.add('fade-transition');
            
            setTimeout(() => {
                this.elements.finalScreen.classList.remove('fade-transition');
                this.elements.finalScreen.classList.add('fade-in');
                this.elements.finalScreen.style.opacity = '1';
            }, 50);
        }, 500);
    }
    
    returnToMain() {
        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        this.playPixelSound('menu_click');
        window.location.href = 'index1.html';
    }
    
    setYumiState(stateKey) {
        if (this.currentYumiState === stateKey) return;
        
        const state = this.yumiStates[stateKey];
        if (!state) return;
        
        const yumiImage = document.getElementById('yumiImage');
        if (yumiImage) {
            yumiImage.classList.add('changing');
            
            setTimeout(() => {
                yumiImage.src = state.image;
                yumiImage.alt = state.description;
                yumiImage.className = 'yumi-img ' + state.className + ' scale-up';
                
                setTimeout(() => {
                    yumiImage.classList.remove('scale-up');
                    yumiImage.classList.remove('changing');
                }, 500);
                
                this.currentYumiState = stateKey;
            }, 300);
        }
    }
    
    playPixelSound(type) {
        if (!this.soundEnabled || !this.audioContext) return;
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        let frequency = 440, duration = 0.1;
        
        switch(type) {
            case 'click': frequency = 220 + Math.random() * 110; duration = 0.05; break;
            case 'step': frequency = 150 + Math.random() * 50; duration = 0.08; break;
            case 'success': frequency = 880; duration = 0.2; break;
            case 'fail': frequency = 110; duration = 0.3; break;
            case 'stone': frequency = 300; duration = 0.15; break;
            case 'stone_throw': frequency = 400; duration = 0.3; break;
            case 'stone_success': frequency = 660; duration = 0.5; break;
            case 'stone_fail': frequency = 120; duration = 0.6; break;
            case 'dragon_wake': frequency = 60; duration = 0.8; break;
            case 'dragon_sleep': frequency = 80; duration = 0.5; break;
            case 'hover': frequency = 330; duration = 0.03; break;
            case 'menu_click': frequency = 550; duration = 0.1; break;
        }
        
        oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + duration);
    }
    
    setupVideoHandlers() {
        const dragonVideos = [this.elements.dragonSleepVideo, this.elements.dragonRestlessVideo, this.elements.dragonAwakeVideo];
        
        dragonVideos.forEach(video => {
            if (!video) return;
            
            video.muted = true;
            
            video.addEventListener('ended', () => {
                this.videoPlaying = false;
                
                if (video === this.elements.dragonRestlessVideo) {
                    this.dragonState = 'sleeping';
                    this.showVideo('sleeping');
                    this.stateHistory.push('sleeping');
                    this.showHint('–î—Ä–∞–∫–æ–Ω —É—Å–ø–æ–∫–æ–∏–ª—Å—è –∏ —Å–Ω–æ–≤–∞ –∑–∞—Å–Ω—É–ª...');
                    this.canAct = true;
                } else if (video === this.elements.dragonAwakeVideo) {
                    video.currentTime = 0;
                    video.play().catch(e => console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è'));
                    this.showHint('‚ö†Ô∏è –î–†–ê–ö–û–ù –ë–û–î–†–°–¢–í–£–ï–¢! –õ—é–±–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ! (–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ 5 —Å–µ–∫)');
                    this.canAct = false;
                }
                
                this.updateUI();
            });
        });
        
        this.elements.dragonSleepVideo.addEventListener('loadeddata', () => {
            this.showVideo('sleeping');
        });
    }
    
    setupEvents() {
        this.elements.startButton.addEventListener('click', () => {
            this.playPixelSound('menu_click');
            this.startGame();
        });
        
        this.elements.cutsceneNextBtn.addEventListener('click', () => {
            this.playPixelSound('click');
            this.nextCutscene();
        });
        
        this.elements.startMinigameBtn.addEventListener('click', () => {
            this.playPixelSound('menu_click');
            this.startMinigame();
        });
        
        this.elements.returnButton.addEventListener('click', () => {
            this.returnToMain();
        });
        
        this.elements.stepButton.addEventListener('click', () => {
            this.playPixelSound('click');
            this.makeStep();
        });
        
        this.elements.waitButton.addEventListener('click', () => {
            this.playPixelSound('click');
            this.waitTurn();
        });
        
        this.elements.stoneButton.addEventListener('click', () => {
            this.playPixelSound('stone_throw');
            this.useStone();
        });
        
        this.elements.soundToggle.addEventListener('click', () => {
            this.toggleSound();
        });
        
        this.elements.musicToggle.addEventListener('click', () => {
            this.toggleMusic();
        });
        
        this.elements.stoneContinueBtn.addEventListener('click', () => {
            this.closeStoneResult();
            this.handleNextTurn();
        });
        
        this.elements.volumeSlider.addEventListener('input', (e) => {
            const newVolume = parseInt(e.target.value);
            this.changeVolume(newVolume);
        });
        
        this.elements.eventChoice1.addEventListener('click', () => {
            this.playPixelSound('click');
            this.handleEventChoice(1);
        });
        
        this.elements.eventChoice2.addEventListener('click', () => {
            this.playPixelSound('click');
            this.handleEventChoice(2);
        });
        
        const buttons = [
            this.elements.startButton, this.elements.stepButton, 
            this.elements.waitButton, this.elements.stoneButton, this.elements.soundToggle, 
            this.elements.musicToggle, this.elements.eventChoice1, this.elements.eventChoice2, 
            this.elements.stoneContinueBtn, this.elements.cutsceneNextBtn, 
            this.elements.startMinigameBtn, this.elements.returnButton
        ];
        
        buttons.forEach(button => {
            if (button) button.addEventListener('mouseenter', () => this.playPixelSound('hover'));
        });
        
        document.addEventListener('keydown', (e) => {
            if (this.state === 'cutscene' || this.state === 'postMinigame') {
                if (e.code === 'Enter' || e.code === 'Space') {
                    e.preventDefault();
                    this.playPixelSound('click');
                    this.nextCutscene();
                }
            }
            
            if (this.state === 'minigame' && !this.pauseMode && this.elements.minigameIntro.style.display !== 'flex') {
                if (e.code === 'Space' || e.code === 'ArrowRight' || e.code === 'KeyD') {
                    e.preventDefault(); this.playPixelSound('click'); this.makeStep();
                } else if (e.code === 'ArrowUp' || e.code === 'KeyW') {
                    e.preventDefault(); this.playPixelSound('click'); this.waitTurn();
                } else if (e.code === 'KeyS' && this.hasStone && !this.stoneUsed) {
                    e.preventDefault(); this.playPixelSound('stone_throw'); this.useStone();
                } else if (e.code === 'Digit1' && this.elements.eventOverlay.style.display === 'flex') {
                    e.preventDefault(); this.playPixelSound('click'); this.handleEventChoice(1);
                } else if (e.code === 'Digit2' && this.elements.eventOverlay.style.display === 'flex') {
                    e.preventDefault(); this.playPixelSound('click'); this.handleEventChoice(2);
                } else if (e.code === 'KeyM') {
                    e.preventDefault(); this.toggleSound();
                } else if (e.code === 'KeyN') {
                    e.preventDefault(); this.toggleMusic();
                } else if (e.code === 'ArrowUp' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault(); this.increaseVolume();
                } else if (e.code === 'ArrowDown' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault(); this.decreaseVolume();
                } else if (e.code === 'Enter' && this.elements.stoneResultOverlay.style.display === 'flex') {
                    e.preventDefault(); this.closeStoneResult(); this.handleNextTurn();
                }
            }
            
            // –ë—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (F12)
            if (e.code === 'F12') {
                e.preventDefault();
                if (window.game) {
                    console.log('–ë—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ F12!');
                    window.game.step = 30; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
                    window.game.winGame();
                }
            }
        });
    }
    
    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        this.elements.soundToggle.textContent = this.soundEnabled ? 'üîä –í–ö–õ' : 'üîá –í–´–ö–õ';
        this.elements.soundToggle.style.background = this.soundEnabled ? 
            'rgba(0,0,0,0.8)' : 'rgba(255,0,0,0.8)';
        this.elements.soundToggle.title = this.soundEnabled ? 
            '–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: –í–ö–õ' : '–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: –í–´–ö–õ';
        
        if (this.soundEnabled) this.playPixelSound('click');
    }
    
    toggleMusic() {
        this.musicEnabled = !this.musicEnabled;
        
        if (this.musicEnabled) {
            this.elements.musicToggle.textContent = 'üéµ';
            this.elements.musicToggle.title = '–≠–º–±–∏–µ–Ω—Ç –ø–µ—â–µ—Ä—ã: –í–ö–õ';
            this.elements.musicToggle.style.color = '#00ccff';
            
            this.createAmbientMusic();
        } else {
            this.elements.musicToggle.textContent = 'üîá';
            this.elements.musicToggle.title = '–≠–º–±–∏–µ–Ω—Ç –ø–µ—â–µ—Ä—ã: –í–´–ö–õ';
            this.elements.musicToggle.style.color = '#ff0000';
            
            this.stopBackgroundMusic();
        }
        
        localStorage.setItem('dragonGameMusicEnabled', this.musicEnabled);
        if (this.soundEnabled) this.playPixelSound('click');
    }
    
    changeVolume(newVolumePercent) {
        this.musicVolume = newVolumePercent / 100;
        
        if (this.backgroundMusic) {
            this.backgroundMusic.volume = this.musicVolume;
        }
        
        this.updateVolumeDisplay();
        
        localStorage.setItem('dragonGameMusicVolume', this.musicVolume);
        
        if (this.soundEnabled) this.playPixelSound('click');
    }
    
    updateVolumeDisplay() {
        const volumePercent = Math.round(this.musicVolume * 100);
        if (this.elements.volumeValue) {
            this.elements.volumeValue.textContent = volumePercent + '%';
        }
        if (this.elements.volumeSlider) {
            this.elements.volumeSlider.value = volumePercent;
        }
    }
    
    increaseVolume() {
        let newVolume = parseInt(this.elements.volumeSlider.value) + 5;
        if (newVolume > 100) newVolume = 100;
        this.changeVolume(newVolume);
    }
    
    decreaseVolume() {
        let newVolume = parseInt(this.elements.volumeSlider.value) - 5;
        if (newVolume < 0) newVolume = 0;
        this.changeVolume(newVolume);
    }
    
    showVideo(state) {
        this.elements.dragonSleepVideo.classList.remove('active');
        this.elements.dragonRestlessVideo.classList.remove('active');
        this.elements.dragonAwakeVideo.classList.remove('active');
        
        this.elements.dragonSleepVideo.pause();
        this.elements.dragonRestlessVideo.pause();
        this.elements.dragonAwakeVideo.pause();
        
        let video;
        switch(state) {
            case 'sleeping': video = this.elements.dragonSleepVideo; break;
            case 'restless': video = this.elements.dragonRestlessVideo; break;
            case 'awake': video = this.elements.dragonAwakeVideo; break;
        }
        
        if (video) {
            video.classList.add('active');
            video.currentTime = 0;
            
            const statusMap = {
                sleeping: { text: '–ì–õ–£–ë–û–ö–û –°–ü–ò–¢', color: '#4CAF50' },
                restless: { text: '–í–û–†–û–ß–ê–ï–¢–°–Ø', color: '#FF9800' },
                awake: { text: '–ë–û–î–†–°–¢–í–£–ï–¢! –û–ü–ê–°–ù–û!', color: '#F44336' }
            };
            
            if (statusMap[state]) {
                this.elements.dragonStatus.textContent = statusMap[state].text;
                this.elements.dragonStatus.style.color = statusMap[state].color;
            }
            
            this.dragonState = state;
            
            if (state === 'sleeping') {
                this.awakeCount = 0;
                if (this.awakeBlockTimer) {
                    clearTimeout(this.awakeBlockTimer);
                    this.awakeBlockTimer = null;
                }
            } else if (state === 'awake') {
                this.awakeCount++;
                this.canAct = false;
                
                if (this.awakeBlockTimer) {
                    clearTimeout(this.awakeBlockTimer);
                }
                
                this.awakeBlockTimer = setTimeout(() => {
                    this.unlockAfterAwake();
                }, this.awakeBlockDuration);
                
            } else {
                this.awakeCount = 0;
                if (this.awakeBlockTimer) {
                    clearTimeout(this.awakeBlockTimer);
                    this.awakeBlockTimer = null;
                }
            }
            
            if (state === 'sleeping') {
                video.loop = true;
                this.videoPlaying = false;
                this.canAct = true;
                video.play().catch(e => console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ —Å–Ω–∞'));
                this.playPixelSound('dragon_sleep');
            } else if (state === 'restless') {
                video.loop = false;
                this.videoPlaying = true;
                this.canAct = false;
                
                video.play().then(() => {
                    this.showHint('–î—Ä–∞–∫–æ–Ω –≤–æ—Ä–æ—á–∞–µ—Ç—Å—è... –ó–∞–º—Ä–∏!');
                    this.playPixelSound('dragon_sleep');
                    
                    if (!this.firstVideoPlayed) {
                        video.addEventListener('ended', () => {
                            this.firstVideoPlayed = true;
                            this.videoPlaying = false;
                            this.canAct = true;
                            this.dragonState = 'sleeping';
                            this.showVideo('sleeping');
                        }, { once: true });
                    } else {
                        video.addEventListener('ended', () => {
                            this.videoPlaying = false;
                            this.canAct = true;
                            this.dragonState = 'sleeping';
                            this.showVideo('sleeping');
                        }, { once: true });
                    }
                }).catch(e => {
                    this.videoPlaying = false;
                    this.canAct = true;
                    this.updateUI();
                });
                
            } else if (state === 'awake') {
                video.loop = true;
                this.videoPlaying = false;
                
                video.play().then(() => {
                    this.showHint('‚ö†Ô∏è –î–†–ê–ö–û–ù –ë–û–î–†–°–¢–í–£–ï–¢! –õ—é–±–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ! (–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ 8 —Å–µ–∫)');
                    this.playPixelSound('dragon_wake');
                    
                    this.showAwakeCountdown();
                    
                }).catch(e => {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è:', e);
                    this.videoPlaying = false;
                    this.updateUI();
                });
            }
            
            this.updateUI();
        }
    }
    
    unlockAfterAwake() {
        if (this.dragonState === 'awake') {
            this.canAct = true;
            this.showHint('‚ö†Ô∏è –î—Ä–∞–∫–æ–Ω –≤—Å—ë –µ—â—ë –±–æ–¥—Ä—Å—Ç–≤—É–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å...');
            this.updateUI();
            this.awakeBlockTimer = null;
        }
    }
    
    showAwakeCountdown() {
        if (this.dragonState !== 'awake' || !this.awakeBlockTimer) return;
        
        let secondsLeft = Math.ceil(this.awakeBlockDuration / 1000);
        
        const countdownInterval = setInterval(() => {
            if (this.dragonState !== 'awake' || !this.awakeBlockTimer) {
                clearInterval(countdownInterval);
                return;
            }
            
            secondsLeft--;
            
            if (secondsLeft <= 0) {
                clearInterval(countdownInterval);
                this.showHint('‚ö†Ô∏è –î—Ä–∞–∫–æ–Ω –≤—Å—ë –µ—â—ë –±–æ–¥—Ä—Å—Ç–≤—É–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å...');
            } else {
                this.showHint(`‚ö†Ô∏è –î–†–ê–ö–û–ù –ë–û–î–†–°–¢–í–£–ï–¢! –õ—é–±–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ! (–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ ${secondsLeft} —Å–µ–∫)`);
            }
            
            this.updateUI();
        }, 1000);
    }
    
    waitTurn() {
        if (!this.canAct || this.state !== 'minigame' || this.pauseMode) {
            return;
        }
        
        this.canAct = false;
        this.setYumiState('sitting');
        
        let alertnessDecrease = 10;
        let sleepChance = 0.3;
        
        if (this.dragonState === 'awake') {
            alertnessDecrease = 5;
            sleepChance = 0.4;
            
            if (this.awakeCount >= 2) {
                sleepChance = 0.7;
            }
            
            this.showHint('–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –∂–¥—ë–º... –î—Ä–∞–∫–æ–Ω –±–æ–¥—Ä—Å—Ç–≤—É–µ—Ç. –®–∞–Ω—Å —É—Å–Ω—É—Ç—å: ' + Math.round(sleepChance * 100) + '%');
        } 
        else if (this.dragonState === 'restless') {
            alertnessDecrease = 8;
            sleepChance = 0.5;
            this.showHint('–ñ–¥—ë–º, –ø–æ–∫–∞ –¥—Ä–∞–∫–æ–Ω —É—Å–ø–æ–∫–æ–∏—Ç—Å—è...');
        }
        else {
            alertnessDecrease += Math.random() * 5;
            this.showHint(`–í—ã–∂–∏–¥–∞–µ–º... –ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -${Math.round(alertnessDecrease)}%`);
        }
        
        this.alertness = Math.max(0, this.alertness - alertnessDecrease);
        
        if ((this.dragonState === 'awake' || this.dragonState === 'restless') && 
            Math.random() < sleepChance) {
            
            this.dragonState = 'sleeping';
            this.awakeCount = 0;
            
            if (this.awakeBlockTimer) {
                clearTimeout(this.awakeBlockTimer);
                this.awakeBlockTimer = null;
            }
            
            this.showVideo('sleeping');
            this.stateHistory.push('sleeping');
            this.justRestless = false;
            
            if (this.dragonState === 'awake') {
                this.showHint('üéâ –î—Ä–∞–∫–æ–Ω —Å–Ω–æ–≤–∞ –∑–∞—Å–Ω—É–ª! –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å!');
                this.playPixelSound('dragon_sleep');
            } else {
                this.showHint('–î—Ä–∞–∫–æ–Ω —É—Å–ø–æ–∫–æ–∏–ª—Å—è –∏ —Å–Ω–æ–≤–∞ –∑–∞—Å–Ω—É–ª...');
            }
        }
        
        this.justRestless = false;
        this.playPixelSound('click');
        this.stateHistory.push('wait');
        
        this.updateUI();
        this.handleNextTurn();
    }
    
    handleNextTurn() {
        if (this.alertness >= 100) {
            setTimeout(() => this.loseGame(), 1000);
            return;
        }
        
        if (this.events[this.step] && !this.events[this.step].done) {
            this.showEvent(this.events[this.step]);
            return;
        }
        
        this.canAct = true;
        this.pauseMode = false;
        
        this.changeDragonState();
        
        this.updateUI();
    }
    
    useStone() {
        if (!this.canAct || !this.hasStone || this.stoneUsed || this.pauseMode) return;
        
        this.canAct = false;
        this.pauseMode = true;
        this.stoneUsed = true;
        this.elements.stoneButton.style.display = 'none';
        
        this.showHint('–ë—Ä–æ—Å–∞–µ–º –∫–∞–º–µ–Ω—å...');
        this.createStoneThrowEffect();
        
        setTimeout(() => {
            const success = Math.random() > 0.5;
            
            if (success) {
                this.alertness = Math.max(0, this.alertness - 50);
                this.dragonState = 'sleeping';
                this.showVideo('sleeping');
                this.stateHistory.push('sleeping');
                this.justRestless = false;
                
                this.showStoneResult(
                    'üéØ –£–°–ü–ï–•!',
                    '–ö–∞–º–µ–Ω—å —É–¥–∞—Ä–∏–ª—Å—è –≤–¥–∞–ª–µ–∫–µ! –î—Ä–∞–∫–æ–Ω –æ—Ç–≤–ª–µ–∫—Å—è –Ω–∞ –∑–≤—É–∫ –∏ –Ω–µ –∑–∞–º–µ—Ç–∏–ª –≤–∞—Å.\n\n–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∞ –Ω–∞ 50%!',
                    true
                );
                
                this.playPixelSound('stone_success');
                
            } else {
                this.alertness = Math.min(100, this.alertness + 30);
                this.dragonState = 'awake';
                this.showVideo('awake');
                this.stateHistory.push('awake');
                
                this.showStoneResult(
                    'üí• –ü–†–û–í–ê–õ!',
                    '–î—Ä–∞–∫–æ–Ω –∑–∞–º–µ—Ç–∏–ª –¥–≤–∏–∂–µ–Ω–∏–µ! –ö–∞–º–µ–Ω—å —É–ø–∞–ª —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ, –∏ –¥—Ä–∞–∫–æ–Ω –ü–†–û–°–ù–£–õ–°–Ø.\n\n–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ 30%!',
                    false
                );
                
                this.playPixelSound('stone_fail');
                this.shakeScreen();
            }
            
            if (this.alertness >= 100) {
                setTimeout(() => {
                    this.closeStoneResult();
                    this.loseGame();
                }, 2000);
                return;
            }
            
            this.updateUI();
        }, 1500);
    }
    
    createStoneThrowEffect() {
        const effect = document.createElement('div');
        effect.className = 'stone-throw-effect';
        effect.textContent = 'ü™®';
        effect.style.color = '#ffffff';
        
        this.elements.gameScene.appendChild(effect);
        
        setTimeout(() => {
            if (effect.parentNode) effect.parentNode.removeChild(effect);
        }, 1500);
    }
    
    showStoneResult(title, description, isSuccess) {
        this.elements.stoneResultTitle.textContent = title;
        this.elements.stoneResultDescription.textContent = description;
        
        if (isSuccess) {
            this.elements.stoneResultBox.className = 'stone-result-box result-success';
        } else {
            this.elements.stoneResultBox.className = 'stone-result-box result-fail';
        }
        
        this.elements.stoneResultOverlay.style.display = 'flex';
    }
    
    closeStoneResult() {
        this.elements.stoneResultOverlay.style.display = 'none';
        this.pauseMode = false;
    }
    
    showEvent(event) {
        this.canAct = false;
        this.pauseMode = true;
        this.elements.eventOverlay.style.display = 'flex';
        
        this.elements.eventTitle.textContent = event.title;
        this.elements.eventDescription.textContent = event.description;
        
        const comparisonHTML = `
            <div class="choice-column risky">
                <div class="choice-header">
                    ${event.risky.name}
                    <span class="risk-badge">–†–ò–°–ö</span>
                </div>
                <div class="choice-details">
                    <div style="color: #ff9966; margin-bottom: 10px;">${event.risky.description}</div>
                    <ul>
                        ${event.risky.details.map(detail => `<li>${detail}</li>`).join('')}
                    </ul>
                </div>
                <div class="choice-outcome">
                    üìä –ò–¢–û–ì: ${event.risky.outcome}
                </div>
            </div>
            
            <div class="choice-column safe">
                <div class="choice-header">
                    ${event.safe.name}
                    <span class="safe-badge">–ë–ï–ó–û–ü–ê–°–ù–û</span>
                </div>
                <div class="choice-details">
                    <div style="color: #88ff88; margin-bottom: 10px;">${event.safe.description}</div>
                    <ul>
                        ${event.safe.details.map(detail => `<li>${detail}</li>`).join('')}
                    </ul>
                </div>
                <div class="choice-outcome">
                    üìä –ò–¢–û–ì: ${event.safe.outcome}
                </div>
            </div>
        `;
        
        const choicesComparison = document.getElementById('choicesComparison');
        if (choicesComparison) choicesComparison.innerHTML = comparisonHTML;
        
        if (this.elements.eventChoice1 && this.elements.eventChoice2) {
            this.elements.eventChoice1.textContent = `–í–´–ë–†–ê–¢–¨: ${event.risky.name}`;
            this.elements.eventChoice2.textContent = `–í–´–ë–†–ê–¢–¨: ${event.safe.name}`;
        }
    }
    
    handleEventChoice(choice) {
        const event = this.events[this.step];
        if (!event) {
            console.log('–°–æ–±—ã—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è —à–∞–≥–∞:', this.step);
            return;
        }
        
        event.done = true;
        
        this.elements.eventOverlay.style.display = 'none';
        this.canAct = false;
        
        if (event.type === 'crack') {
            if (choice === 1) {
                this.showHint('–ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É—Ç—å...');
                this.playPixelSound('step');
                
                setTimeout(() => {
                    const success = Math.random() > 0.3;
                    
                    if (success) {
                        this.step += 3;
                        this.alertness = Math.min(100, this.alertness + 5);
                        this.showHint('üéØ –ò–î–ï–ê–õ–¨–ù–´–ô –ü–†–´–ñ–û–ö! –ü—Ä—è–º–æ —á–µ—Ä–µ–∑ —Ç—Ä–µ—â–∏–Ω—É! +3 —à–∞–≥–∞ –≤–ø–µ—Ä–µ–¥!');
                        this.playPixelSound('success');
                        this.elements.gameScene.classList.add('pulse-success');
                        setTimeout(() => this.elements.gameScene.classList.remove('pulse-success'), 500);
                        
                        setTimeout(() => {
                            this.showResultMessage(
                                'üéØ –ò–î–ï–ê–õ–¨–ù–´–ô –ü–†–´–ñ–û–ö!',
                                '–í—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É–ª–∏ —Ç—Ä–µ—â–∏–Ω—É!\n\n+3 —à–∞–≥–∞ –≤–ø–µ—Ä–µ–¥!\n+5% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                                'success'
                            );
                        }, 1500);
                        
                    } else {
                        this.alertness = Math.min(100, this.alertness + 20);
                        this.showHint('üí• –ü–†–û–í–ê–õ! –í—ã —Å–ø–æ—Ç–∫–Ω—É–ª–∏—Å—å –ø—Ä–∏ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–∏! –î—Ä–∞–∫–æ–Ω –ü–†–û–°–´–ü–ê–ï–¢–°–Ø!');
                        this.dragonState = 'awake';
                        this.showVideo('awake');
                        this.stateHistory.push('awake');
                        this.playPixelSound('dragon_wake');
                        this.shakeScreen();
                        this.elements.gameScene.classList.add('pulse-fail');
                        setTimeout(() => this.elements.gameScene.classList.remove('pulse-fail'), 500);
                        
                        setTimeout(() => {
                            this.showResultMessage(
                                'üí• –ü–†–û–í–ê–õ!',
                                '–í—ã —Å–ø–æ—Ç–∫–Ω—É–ª–∏—Å—å –ø—Ä–∏ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–∏!\n\n–î—Ä–∞–∫–æ–Ω –ü–†–û–°–ù–£–õ–°–Ø!\n+20% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                                'fail'
                            );
                        }, 2000);
                    }
                }, 1500);
                return;
            } else {
                this.alertness = Math.max(0, this.alertness - 5);
                this.showHint('üõ°Ô∏è –û–±–æ—à–ª–∏ —Ç—Ä–µ—â–∏–Ω—É –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É—Ç—å. -5% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.');
                this.playPixelSound('click');
                
                setTimeout(() => {
                    this.showResultMessage(
                        'üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–´–ô –ü–£–¢–¨',
                        '–í—ã –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –æ–±–æ—à–ª–∏ —Ç—Ä–µ—â–∏–Ω—É.\n\n–®–∞–≥ –Ω–µ –ø–æ—Ç—Ä–∞—á–µ–Ω!\n-5% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                        'safe'
                    );
                }, 1000);
            }
        } else if (event.type === 'stalactites') {
            if (choice === 1) {
                this.showHint('–ë–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ —á–µ—Ä–µ–∑ —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç—ã...');
                this.playPixelSound('step');
                
                setTimeout(() => {
                    const success = Math.random() > 0.5;
                    
                    if (success) {
                        this.step += 3;
                        this.alertness = Math.min(100, this.alertness + 10);
                        this.showHint('üéØ –ë–´–°–¢–†–´–ô –ü–†–û–ë–ï–ì! –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–±–µ–∂–∞–ª–∏! +3 —à–∞–≥–∞ –≤–ø–µ—Ä–µ–¥!');
                        this.playPixelSound('success');
                        this.elements.gameScene.classList.add('pulse-success');
                        setTimeout(() => this.elements.gameScene.classList.remove('pulse-success'), 500);
                        
                        setTimeout(() => {
                            this.showResultMessage(
                                'üéØ –ë–´–°–¢–†–´–ô –ü–†–û–ë–ï–ì!',
                                '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–±–µ–∂–∞–ª–∏ —á–µ—Ä–µ–∑ —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç—ã!\n\n+3 —à–∞–≥–∞ –≤–ø–µ—Ä–µ–¥!\n+10% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                                'success'
                            );
                        }, 1500);
                        
                    } else {
                        this.alertness = Math.min(100, this.alertness + 40);
                        this.showHint('üí• –ü–†–û–í–ê–õ! –ó–∞–¥–µ–ª–∏ —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç! –ì–†–û–•–û–¢! –î—Ä–∞–∫–æ–Ω –ü–†–û–°–´–ü–ê–ï–¢–°–Ø!');
                        this.dragonState = 'awake';
                        this.showVideo('awake');
                        this.stateHistory.push('awake');
                        this.playPixelSound('dragon_wake');
                        this.shakeScreen();
                        this.elements.gameScene.classList.add('pulse-fail');
                        setTimeout(() => this.elements.gameScene.classList.remove('pulse-fail'), 500);
                        
                        setTimeout(() => {
                            this.showResultMessage(
                                'üí• –ü–†–û–í–ê–õ!',
                                '–í—ã –∑–∞–¥–µ–ª–∏ —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç!\n\n–î—Ä–∞–∫–æ–Ω –ü–†–û–°–ù–£–õ–°–Ø!\n+40% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                                'fail'
                            );
                        }, 2000);
                    }
                }, 1500);
                return;
            } else {
                this.step += 1;
                this.showHint('üõ°Ô∏è –¢–∏—Ö–æ –ø—Ä–æ—à–ª–∏ –º–µ–∂–¥—É —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç–∞–º–∏. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É—Ç—å. +1 —à–∞–≥.');
                this.playPixelSound('step');
                
                setTimeout(() => {
                    this.showResultMessage(
                        'üõ°Ô∏è –¢–ò–•–ò–ô –ü–†–û–•–û–î',
                        '–í—ã –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –ø—Ä–æ—à–ª–∏ –º–µ–∂–¥—É —Å—Ç–∞–ª–∞–∫—Ç–∏—Ç–∞–º–∏.\n\n+1 —à–∞–≥ –≤–ø–µ—Ä–µ–¥\n–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å',
                        'safe'
                    );
                }, 1000);
            }
        } else if (event.type === 'fork') {
            if (choice === 1) {
                this.step += 2;
                this.alertness = Math.min(100, this.alertness + 20);
                this.showHint('üìà –ü–æ—à–ª–∏ –ø—Ä–∞–≤–æ–π —Ç—Ä–æ–ø–æ–π. –ë–ª–∏–∂–µ –∫ –¥—Ä–∞–∫–æ–Ω—É, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ! +2 —à–∞–≥–∞, –Ω–æ +20% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.');
                this.playPixelSound('step');
                
                setTimeout(() => {
                    this.showResultMessage(
                        'üìà –ö–û–†–û–¢–ö–ò–ô –ü–£–¢–¨',
                        '–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø—Ä–∞–≤—É—é —Ç—Ä–æ–ø—É.\n\n+2 —à–∞–≥–∞ –≤–ø–µ—Ä–µ–¥!\n+20% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–±–ª–∏–∂–µ –∫ –¥—Ä–∞–∫–æ–Ω—É)',
                        'risky'
                    );
                }, 1000);
                
            } else {
                this.step += 1;
                this.showHint('üõ°Ô∏è –ü–æ—à–ª–∏ –ª–µ–≤–æ–π —Ç—Ä–æ–ø–æ–π. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É—Ç—å. +1 —à–∞–≥.');
                this.playPixelSound('step');
                
                setTimeout(() => {
                    this.showResultMessage(
                        'üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –¢–†–û–ü–ê',
                        '–í—ã –≤—ã–±—Ä–∞–ª–∏ –ª–µ–≤—É—é —Ç—Ä–æ–ø—É.\n\n+1 —à–∞–≥ –≤–ø–µ—Ä–µ–¥\n–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å',
                        'safe'
                    );
                }, 1000);
            }
        } else if (event.type === 'sword_choice') {
        if (choice === 1) {
            this.showHint('‚öîÔ∏è –î–æ—Å—Ç–∞—ë–º –º–µ—á... –≠—Ç–æ –ø–ª–æ—Ö–∞—è –∏–¥–µ—è...');
            this.playPixelSound('dragon_wake');
            
            setTimeout(() => {
                // 1% —à–∞–Ω—Å –Ω–∞ —É—Å–ø–µ—Ö (—á—É–¥–æ)
                const success = Math.random() < 0.01;
                
                if (success) {
                    // –ù–ï–í–ï–†–û–Ø–¢–ù–û–ï –ß–£–î–û!
                    this.step = this.maxSteps; // –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø–æ–±–µ–¥–∞
                    this.showHint('üéâ –ù–ï–í–û–ó–ú–û–ñ–ù–û! –ú–ï–ß –°–†–ê–ë–û–¢–ê–õ!');
                    this.playPixelSound('success');
                    this.elements.gameScene.classList.add('pulse-success');
                    setTimeout(() => this.elements.gameScene.classList.remove('pulse-success'), 500);
                    
                    setTimeout(() => {
                        this.showResultMessage(
                            'üåü –ù–ï–í–ï–†–û–Ø–¢–ù–û–ï –ß–£–î–û!',
                            '–í—ã –¥–æ—Å—Ç–∞—ë—Ç–µ –º–µ—á...\n\n–û–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–≤–µ—Ç–∏—Ç—å—Å—è –¥—Ä–µ–≤–Ω–µ–π –º–∞–≥–∏–µ–π!\n\n–û–¥–∏–Ω —É–¥–∞—Ä ‚Äî –∏ –¥—Ä–∞–∫–æ–Ω –º–∏—Ä–Ω–æ –∑–∞—Å—ã–ø–∞–µ—Ç!\n\nüéØ –ò–ù–°–¢–ê–ù–¢-–ü–û–ë–ï–î–ê!\n\n(–®–∞–Ω—Å –±—ã–ª 1 –∏–∑ 100!)',
                            'success'
                        );
                        
                        setTimeout(() => {
                            this.finishEvent(event);
                            this.winGame();
                        }, 3000);
                    }, 1500);
                    
                } else {
                    // –ü—Ä–æ–≤–∞–ª (99% —Å–ª—É—á–∞–µ–≤)
                    this.alertness = Math.min(100, this.alertness + 50);
                    this.showHint('üíÄ –î–†–ê–ö–û–ù –ü–†–û–°–´–ü–ê–ï–¢–°–Ø –û–¢ –ë–õ–ï–°–ö–ê –°–¢–ê–õ–ò!');
                    this.dragonState = 'awake';
                    this.showVideo('awake');
                    this.stateHistory.push('awake');
                    this.shakeScreen();
                    this.elements.gameScene.classList.add('pulse-fail');
                    setTimeout(() => this.elements.gameScene.classList.remove('pulse-fail'), 500);
                    
                    setTimeout(() => {
                        this.showResultMessage(
                            'üíÄ –°–ê–ú–ê–Ø –ì–õ–£–ü–ê–Ø –ò–î–ï–Ø –í –ò–°–¢–û–†–ò–ò',
                            '–í—ã –¥–æ—Å—Ç–∞—ë—Ç–µ –º–µ—á...\n\n–î—Ä–∞–∫–æ–Ω –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –æ—Ç –±–ª–µ—Å–∫–∞ —Å—Ç–∞–ª–∏.\n\n–û–Ω —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤–∞—Å —Å —Ç–∞–∫–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º,\n–±—É–¥—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–°–µ—Ä—å—ë–∑–Ω–æ? –ú–ï–ß–û–ú?"\n\nüéØ +50% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\nüß† –î—Ä–∞–∫–æ–Ω —Ç–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞–µ—Ç –≤–∞—Å –∏–¥–∏–æ—Ç–∞–º–∏',
                            'fail'
                        );
                        
                        if (this.alertness >= 100) {
                            setTimeout(() => {
                                this.finishEvent(event);
                                this.loseGame();
                            }, 2000);
                            return;
                        }
                    }, 2000);
                }
            }, 1500);
            return;
        } else {
            this.step += 1;
            this.alertness = Math.max(0, this.alertness - 10);
            this.showHint('üß† –û—Å—Ç–∞–≤–ª—è–µ–º –º–µ—á –≤ –ø–æ–∫–æ–µ. –£–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. -10% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.');
            this.playPixelSound('click');
            
            setTimeout(() => {
                this.showResultMessage(
                    'üß† –ú–£–î–†–û–ï –†–ï–®–ï–ù–ò–ï',
                    '–í—ã –æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –º–µ—á –≤ –Ω–æ–∂–Ω–∞—Ö.\n\n+1 —à–∞–≥ –≤–ø–µ—Ä—ë–¥\n-10% –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ—Å–æ–∑–Ω–∞–ª–∏ —Å–≤–æ—é –≥–ª—É–ø–æ—Å—Ç—å)\n\n–ú–µ—á –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º,\n–∂–¥—É —Å–≤–æ–µ–≥–æ —á–∞—Å–∞...',
                    'safe'
                );
            }, 1000);
        }
    }
        
        setTimeout(() => {
            this.finishEvent(event);
        }, 1500);
    }
    
    showResultMessage(title, description, type) {
        this.pauseMode = true;
        
        const resultOverlay = document.createElement('div');
        resultOverlay.className = 'event-overlay';
        resultOverlay.id = 'eventResultOverlay';
        resultOverlay.style.display = 'flex';
        
        let borderColor, titleColor;
        switch(type) {
            case 'success':
                borderColor = '#4CAF50';
                titleColor = '#4CAF50';
                break;
            case 'fail':
                borderColor = '#F44336';
                titleColor = '#F44336';
                break;
            case 'risky':
                borderColor = '#FF9800';
                titleColor = '#FF9800';
                break;
            case 'safe':
                borderColor = '#4CAF50';
                titleColor = '#4CAF50';
                break;
            default:
                borderColor = '#ff6600';
                titleColor = '#ffcc00';
        }
        
        resultOverlay.innerHTML = `
            <div class="event-box" style="border-color: ${borderColor}; max-width: 500px;">
                <div class="event-title pixel-text" style="color: ${titleColor};">${title}</div>
                <div class="event-description" style="white-space: pre-line; font-size: 1rem;">
                    ${description}
                </div>
                <button class="choice-btn btn-safe" id="continueEventBtn" style="margin-top: 20px;">
                    –ü–†–û–î–û–õ–ñ–ò–¢–¨
                </button>
            </div>
        `;
        
        this.elements.gameScene.appendChild(resultOverlay);
        
        setTimeout(() => {
            const continueBtn = document.getElementById('continueEventBtn');
            if (continueBtn) {
                continueBtn.addEventListener('click', () => {
                    this.playPixelSound('click');
                    resultOverlay.remove();
                    this.pauseMode = false;
                    this.handleNextTurn();
                });
            }
            
            const keyHandler = (e) => {
                if (e.code === 'Enter' || e.code === 'Space') {
                    e.preventDefault();
                    this.playPixelSound('click');
                    resultOverlay.remove();
                    this.pauseMode = false;
                    document.removeEventListener('keydown', keyHandler);
                    this.handleNextTurn();
                }
            };
            
            document.addEventListener('keydown', keyHandler);
        }, 100);
    }
    
    finishEvent(event) {
        if (event) {
            event.done = true;
        }
        
        this.justRestless = false;
        
        if (this.step >= this.maxSteps) {
            this.winGame();
            return;
        }
        
        this.canAct = true;
        this.pauseMode = false;
        
        this.handleNextTurn();
    }
    
    changeDragonState() {
        const states = ['sleeping', 'restless', 'awake'];
        
        if (this.dragonState === 'awake' && this.awakeCount >= 3) {
            this.dragonState = 'sleeping';
            this.awakeCount = 0;
            
            if (this.awakeBlockTimer) {
                clearTimeout(this.awakeBlockTimer);
                this.awakeBlockTimer = null;
            }
            
            this.showVideo('sleeping');
            this.stateHistory.push('sleeping');
            this.showHint('–î—Ä–∞–∫–æ–Ω —É—Å—Ç–∞–ª –∏ —Å–Ω–æ–≤–∞ –∑–∞—Å–Ω—É–ª...');
            return;
        }
        
        if (this.dragonState === 'awake') {
            let sleepChance = 0.3;
            
            if (this.awakeCount >= 2) {
                sleepChance = 0.7;
            }
            
            if (Math.random() < sleepChance) {
                this.dragonState = 'sleeping';
                this.awakeCount = 0;
                
                if (this.awakeBlockTimer) {
                    clearTimeout(this.awakeBlockTimer);
                    this.awakeBlockTimer = null;
                }
                
                this.showVideo('sleeping');
                this.stateHistory.push('sleeping');
                this.justRestless = false;
                this.showHint('–î—Ä–∞–∫–æ–Ω, –ø–æ—Ö–æ–∂–µ, —Å–Ω–æ–≤–∞ –∑–∞—Å—ã–ø–∞–µ—Ç...');
                this.playPixelSound('dragon_sleep');
                return;
            }
        }
        
        let weights;
        
        if (this.alertness < 30) weights = [85, 12, 3];
        else if (this.alertness < 60) weights = [60, 30, 10];
        else if (this.alertness < 80) weights = [40, 40, 20];
        else weights = [20, 40, 40];
        
        if (this.awakeCount >= 1) {
            weights[2] = Math.max(5, weights[2] - 20);
            weights[0] += 10;
            weights[1] += 10;
        }
        
        if (this.stateHistory.length >= 2) {
            const lastState = this.stateHistory[this.stateHistory.length - 1];
            const secondLastState = this.stateHistory[this.stateHistory.length - 2];
            
            if (lastState === secondLastState) {
                const stateIndex = states.indexOf(lastState);
                if (stateIndex !== -1) {
                    weights[stateIndex] = Math.max(10, weights[stateIndex] - 20);
                    
                    const remainingStates = states.filter((_, i) => i !== stateIndex);
                    const weightToAdd = 20 / remainingStates.length;
                    remainingStates.forEach(state => {
                        const idx = states.indexOf(state);
                        weights[idx] += weightToAdd;
                    });
                }
            }
        }
        
        weights[0] = Math.max(15, Math.min(90, weights[0]));
        weights[1] = Math.max(5, Math.min(50, weights[1]));
        weights[2] = Math.max(3, Math.min(40, weights[2]));
        
        const total = weights.reduce((a, b) => a + b, 0);
        const normalizedWeights = weights.map(w => (w / total) * 100);
        
        let random = Math.random() * 100;
        let chosen = states[0];
        
        for (let i = 0; i < normalizedWeights.length; i++) {
            random -= normalizedWeights[i];
            if (random <= 0) {
                chosen = states[i];
                break;
            }
        }
        
        this.stateHistory.push(chosen);
        if (this.stateHistory.length > 8) this.stateHistory.shift();
        
        this.showVideo(chosen);
    }
    
    makeStep() {
        if (!this.canAct || this.state !== 'minigame' || this.pauseMode || this.dragonState !== 'sleeping') {
            console.log('makeStep blocked:', { 
                canAct: this.canAct, 
                state: this.state, 
                pauseMode: this.pauseMode,
                dragonState: this.dragonState 
            });
            return;
        }
        
        this.canAct = false;
        this.setYumiState('pointing');
        
        let alertnessIncrease = 0;
        
        switch(this.dragonState) {
            case 'sleeping': alertnessIncrease = 8; break;
            case 'restless': alertnessIncrease = 15; break;
            case 'awake': alertnessIncrease = 25; break;
        }
        
        alertnessIncrease += (Math.random() * 8) - 3;
        
        let risk = Math.random() * 100;
        let baseRisk = this.risks[this.dragonState];
        
        if (this.alertness > 50) baseRisk += (this.alertness - 50) / 2;
        
        const lastActions = this.stateHistory.slice(-3);
        const recentSteps = lastActions.filter(action => action === 'step').length;
        if (recentSteps > 1) baseRisk += recentSteps * 10;
        
        this.showHint(`–î–µ–ª–∞–µ–º —à–∞–≥... –†–∏—Å–∫ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è: ${Math.round(baseRisk)}%`);
        this.stateHistory.push('step');
        
        setTimeout(() => {
            let resultMessage = '';
            
            if (risk <= baseRisk) {
                resultMessage = '–®—É–º! –î—Ä–∞–∫–æ–Ω –∑–∞–º–µ—Ç–∏–ª –¥–≤–∏–∂–µ–Ω–∏–µ!';
                alertnessIncrease += 20 + (Math.random() * 15);
                
                if (this.alertness + alertnessIncrease >= 80 || risk <= baseRisk * 0.5) {
                    this.dragonState = 'awake';
                    this.showVideo('awake');
                    this.stateHistory.push('awake');
                    this.playPixelSound('dragon_wake');
                    this.shakeScreen();
                    resultMessage = 'üí• –ì–†–û–ú–ö–ò–ô –®–£–ú! –î—Ä–∞–∫–æ–Ω –ü–†–û–°–´–ü–ê–ï–¢–°–Ø!';
                    alertnessIncrease = Math.min(100, this.alertness + 40) - this.alertness;
                } else if (this.alertness + alertnessIncrease >= 50) {
                    this.dragonState = 'restless';
                    this.showVideo('restless');
                    this.stateHistory.push('restless');
                    this.playPixelSound('dragon_sleep');
                    resultMessage = '‚ö†Ô∏è –®–æ—Ä–æ—Ö! –î—Ä–∞–∫–æ–Ω –≤–æ—Ä–æ—á–∞–µ—Ç—Å—è...';
                }
            } else {
                resultMessage = '–¢–∏—Ö–∏–π —à–∞–≥... –£—Å–ø–µ—Ö!';
                alertnessIncrease = Math.max(3, alertnessIncrease * 0.5);
            }
            
            this.alertness = Math.min(100, Math.max(0, this.alertness + alertnessIncrease));
            
            if (risk > baseRisk) {
                this.step++;
                this.showHint(`${resultMessage} +1 —à–∞–≥. –ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å +${Math.round(alertnessIncrease)}%`);
                
                if (this.step >= this.maxSteps) {
                    this.winGame();
                    return;
                }
                
                if (this.events[this.step] && !this.events[this.step].done) {
                    this.showEvent(this.events[this.step]);
                } else {
                    this.handleNextTurn();
                }
                
                if (this.step === 15 && !this.hasStone) {
                    this.hasStone = true;
                    this.elements.stoneButton.style.display = 'block';
                    
                    setTimeout(() => {
                        this.showResultMessage(
                            'üéâ –í–ê–ñ–ù–ê–Ø –ù–ê–•–û–î–ö–ê!',
                            '–í—ã –Ω–∞—à–ª–∏ –Ω–µ–±–æ–ª—å—à–æ–π –∫–∞–º–µ–Ω—å!\n\n–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç–≤–ª–µ—á—å –¥—Ä–∞–∫–æ–Ω–∞,\n–±—Ä–æ—Å–∏–≤ –∫–∞–º–µ–Ω—å –≤ –¥—Ä—É–≥—É—é —Å—Ç–æ—Ä–æ–Ω—É.\n\n–ö–Ω–æ–ø–∫–∞ –∫–∞–º–Ω—è —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞!',
                            'success'
                        );
                    }, 500);
                    return;
                }
            } else {
                this.showHint(`${resultMessage} –ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å +${Math.round(alertnessIncrease)}%`);
                
                if (this.alertness >= 100) {
                    setTimeout(() => this.loseGame(), 1500);
                    return;
                }
            }
            
            this.playPixelSound(risk > baseRisk ? 'step' : 'fail');
            this.updateUI();
        }, 1000);
    }
    
    shakeScreen() {
        this.elements.gameScene.classList.add('shake');
        setTimeout(() => this.elements.gameScene.classList.remove('shake'), 500);
    }
    
    showHint(text) {
    // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–µ—á –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ü–ï–†–í–û–ô, –¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞!
    if (text.includes('‚öîÔ∏è') || text.includes('–º–µ—á') || text.toLowerCase().includes('–º–µ—á–∞')) {
        const swordReactions = [
            'ü§¶ –ú–µ—á? –ü–†–û–¢–ò–í –î–†–ê–ö–û–ù–ê?',
            '‚öîÔ∏è –¢—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –æ–Ω –Ω–∞—Å –°–ñ–ï–ì?',
            'üò± –û –ë–û–ñ–ï, –ù–ï–¢! –°–ü–†–Ø–ß–¨ –≠–¢–û!',
            'üó°Ô∏è –≠—Ç–æ—Ç –º–µ—á –≥–æ–¥–∏—Ç—Å—è —Ä–∞–∑–≤–µ —á—Ç–æ –º–∞—Å–ª–æ –Ω–∞ —Ö–ª–µ–± –Ω–∞–º–∞–∑–∞—Ç—å!',
            'ü§î –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –¥—Ä–∞–∫–æ–Ω—ã –ª—é–±—è—Ç, –∫–æ–≥–¥–∞ –∏—Ö —Ç—ã–∫–∞—é—Ç –æ—Å—Ç—Ä—ã–º?'
        ];
        
        const reaction = swordReactions[Math.floor(Math.random() * swordReactions.length)];
        this.elements.hintText.textContent = reaction;
        this.setYumiState('panicking');
        this.elements.hintText.style.color = '#FF3333';
        this.elements.hintText.style.textShadow = '0 0 10px #FF3333';
        return; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç
    }
    
    // –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
    this.elements.hintText.textContent = text;
    
    let newState = 'sitting';
    let textColor = 'white';
    let textShadow = 'none';
    
    const lowerText = text.toLowerCase();
    
    if (lowerText.includes('üéØ') || lowerText.includes('—É—Å–ø–µ—Ö') || lowerText.includes('–∏–¥–µ–∞–ª—å–Ω—ã–π') || 
        lowerText.includes('–ø–æ–±–µ–¥–∞') || lowerText.includes('–æ—Ç–ª–∏—á–Ω–æ')) {
        newState = 'success';
        textColor = '#4CAF50';
        textShadow = '0 0 10px #4CAF50';
    } 
    else if (lowerText.includes('üí•') || lowerText.includes('–ø—Ä–æ–≤–∞–ª') || lowerText.includes('–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞') || 
             lowerText.includes('–æ–ø–∞—Å–Ω–æ—Å—Ç—å') || lowerText.includes('–¥—Ä–∞–∫–æ–Ω –ø—Ä–æ—Å–Ω—É–ª—Å—è')) {
        newState = 'danger';
        textColor = '#F44336';
        textShadow = '0 0 10px #F44336';
    }
    else if (lowerText.includes('‚ö°') || lowerText.includes('—Ä–∏—Å–∫') || lowerText.includes('–≤–Ω–∏–º–∞–Ω–∏–µ') || 
             lowerText.includes('–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ') || lowerText.includes('–∑–∞–º—Ä–∏')) {
        newState = 'warning';
        textColor = '#FF9800';
        textShadow = '0 0 10px #FF9800';
    }
    else if (lowerText.includes('üõ°Ô∏è') || lowerText.includes('–±–µ–∑–æ–ø–∞—Å–Ω–æ') || lowerText.includes('—Ç–∏—Ö–æ') || 
             lowerText.includes('—à–µ–ø–æ—Ç') || lowerText.includes('–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å')) {
        newState = 'whispering';
        textColor = '#00ccff';
        textShadow = '0 0 10px #00ccff';
    }
    else if (lowerText.includes('—à–∞–≥') || lowerText.includes('–∏–¥—ë–º') || lowerText.includes('–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ') ||
             lowerText.includes('–≤–ø–µ—Ä—ë–¥') || lowerText.includes('–ø—É—Ç—å')) {
        newState = 'pointing';
        textColor = '#FFCC00';
        textShadow = '0 0 10px #FFCC00';
    }
    else if (lowerText.includes('–∂–¥—ë–º') || lowerText.includes('–ø–µ—Ä–µ–¥—ã—à–∫–∞') || lowerText.includes('–Ω–∞–±–ª—é–¥–∞–µ–º') ||
             lowerText.includes('—Å–ø–∏—Ç') || lowerText.includes('—Ç–∏—à–∏–Ω–∞')) {
        newState = 'sitting';
        textColor = '#ffffff';
        textShadow = 'none';
    }
    
    this.setYumiState(newState);
    this.elements.hintText.style.color = textColor;
    this.elements.hintText.style.textShadow = textShadow;
}
    
    updateUI() {
        this.elements.stepCounter.textContent = `${this.step}/${this.maxSteps}`;
        
        this.elements.alertnessFill.style.width = `${this.alertness}%`;
        this.elements.alertnessPercent.textContent = `${Math.round(this.alertness)}%`;
        
        if (this.alertness < 30) {
            this.elements.alertnessPercent.style.color = '#4CAF50';
            this.elements.alertnessFill.style.background = 'linear-gradient(90deg, #006600, #00cc00)';
        } else if (this.alertness < 70) {
            this.elements.alertnessPercent.style.color = '#FF9800';
            this.elements.alertnessFill.style.background = 'linear-gradient(90deg, #996600, #ff9900)';
        } else {
            this.elements.alertnessPercent.style.color = '#F44336';
            this.elements.alertnessFill.style.background = 'linear-gradient(90deg, #660000, #ff3300)';
        }
        
        const risk = this.risks[this.dragonState];
        const adjustedRisk = risk + (this.alertness > 50 ? (this.alertness - 50) / 2 : 0);
        
        const isAwakeBlocked = this.dragonState === 'awake' && !this.canAct;
        
        if (this.dragonState === 'restless') {
            this.elements.stepButton.title = '–ù–µ–ª—å–∑—è –¥–≤–∏–≥–∞—Ç—å—Å—è - –¥—Ä–∞–∫–æ–Ω –≤–æ—Ä–æ—á–∞–µ—Ç—Å—è!';
            this.elements.waitButton.title = '–ñ–¥–∞—Ç—å (—à–∞–Ω—Å —É—Å–Ω—É—Ç—å 50%)';
            this.elements.waitButton.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
            this.elements.waitButton.innerHTML = '‚è∏Ô∏è –ñ–î–ê–¢–¨';
        } else if (this.dragonState === 'awake') {
            if (isAwakeBlocked) {
                this.elements.stepButton.title = '–ë–õ–û–ö–ò–†–û–í–ê–ù–û! –î—Ä–∞–∫–æ–Ω —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—Å–Ω—É–ª—Å—è!';
                this.elements.waitButton.title = '–ë–õ–û–ö–ò–†–û–í–ê–ù–û! –ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–∫–∞ –¥—Ä–∞–∫–æ–Ω —É—Å–ø–æ–∫–æ–∏—Ç—Å—è';
                this.elements.waitButton.style.background = 'linear-gradient(135deg, #FF3333, #CC0000)';
                this.elements.waitButton.innerHTML = '‚è∏Ô∏è –ë–õ–û–ö–ò–†–û–í–ê–ù–û';
            } else {
                this.elements.stepButton.title = '–û–ü–ê–°–ù–û! –î—Ä–∞–∫–æ–Ω –±–æ–¥—Ä—Å—Ç–≤—É–µ—Ç! –†–∏—Å–∫ 90%+';
                this.elements.waitButton.title = '–ñ–¥–∞—Ç—å (—à–∞–Ω—Å —É—Å–Ω—É—Ç—å 40-70%)';
                this.elements.waitButton.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
                this.elements.waitButton.innerHTML = '‚è∏Ô∏è –ñ–î–ê–¢–¨ (–®–ê–ù–° –£–°–ù–£–¢–¨)';
            }
        } else {
            this.elements.stepButton.title = `–†–∏—Å–∫: ${Math.round(adjustedRisk)}%`;
            this.elements.waitButton.title = '–ü–æ–¥–æ–∂–¥–∞—Ç—å –∏ —É—Å–ø–æ–∫–æ–∏—Ç—å –¥—Ä–∞–∫–æ–Ω–∞';
            this.elements.waitButton.style.background = 'linear-gradient(135deg, #8B4513, #A0522D)';
            this.elements.waitButton.innerHTML = '‚è∏Ô∏è –ü–û–î–û–ñ–î–ê–¢–¨';
        }
        
        this.elements.stepButton.disabled = !this.canAct || this.pauseMode || this.dragonState !== 'sleeping';
        this.elements.waitButton.disabled = !this.canAct || this.pauseMode;
        this.elements.stoneButton.disabled = !this.canAct || this.stoneUsed || this.pauseMode || this.dragonState !== 'sleeping';
        
        if (adjustedRisk <= 30) {
            this.elements.stepButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
        } else if (adjustedRisk <= 60) {
            this.elements.stepButton.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
        } else {
            this.elements.stepButton.style.background = 'linear-gradient(135deg, #F44336, #C62828)';
        }
        
        if (isAwakeBlocked) {
            this.elements.stepButton.style.background = 'linear-gradient(135deg, #666666, #333333)';
            this.elements.waitButton.style.background = 'linear-gradient(135deg, #FF3333, #CC0000)';
            this.elements.stoneButton.style.background = 'linear-gradient(135deg, #666666, #333333)';
        }
    }
    
    loseGame() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∏–≥—Ä–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
    this.canAct = false;
    this.pauseMode = true;
    
    this.dragonState = 'awake';
    this.showVideo('awake');
    this.showHint('üíÄ –î–†–ê–ö–û–ù –ü–†–û–°–ù–£–õ–°–Ø! –ü–†–û–ò–ì–†–´–®!');
    this.playPixelSound('dragon_wake');
    this.shakeScreen();
    this.stopBackgroundMusic();
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
    this.elements.stepButton.disabled = true;
    this.elements.waitButton.disabled = true;
    this.elements.stoneButton.disabled = true;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–æ—à–∫–æ –ø–æ—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(() => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–æ –ª–∏ —É–∂–µ –æ–∫–æ—à–∫–æ
        if (document.getElementById('defeatOverlay')) {
            return;
        }
        
        const defeatOverlay = document.createElement('div');
        defeatOverlay.id = 'defeatOverlay';
        defeatOverlay.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        `;
        
        defeatOverlay.innerHTML = `
            <div style="
                background: linear-gradient(135deg, rgba(60, 0, 0, 0.95), rgba(30, 0, 0, 0.95));
                border: 4px solid #ff3300;
                border-radius: 15px;
                padding: 30px;
                max-width: 600px;
                width: 90%;
                text-align: center;
                box-shadow: 0 0 50px rgba(255, 51, 0, 0.7);
            ">
                <div style="
                    color: #ff3300;
                    font-size: 2.2rem;
                    margin-bottom: 20px;
                    text-shadow: 0 0 10px #ff3300;
                    font-family: 'Orbitron', sans-serif;
                    font-weight: bold;
                ">
                    üêâ –ü–û–†–ê–ñ–ï–ù–ò–ï! üêâ
                </div>
                
                <div style="
                    font-size: 3rem;
                    margin: 20px 0;
                ">
                    üíÄ
                </div>
                
                <div style="
                    color: #ff9966;
                    font-size: 1.1rem;
                    margin-bottom: 10px;
                    font-family: 'Press Start 2P', monospace;
                ">
                    –î—Ä–∞–∫–æ–Ω –ø—Ä–æ—Å–Ω—É–ª—Å—è –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª –≤–∞—Å!
                </div>
                
                <div style="
                    background: rgba(0, 0, 0, 0.5);
                    border: 2px solid rgba(255, 51, 0, 0.3);
                    border-radius: 10px;
                    padding: 15px;
                    margin: 20px 0;
                    font-family: 'Press Start 2P', monospace;
                ">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #ff9966;">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                        <span style="color: #ff3333; font-weight: bold;">${this.step}/${this.maxSteps}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #ff9966;">–ë–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                        <span style="color: #ff3333; font-weight: bold;">${Math.round(this.alertness)}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #ff9966;">–°—Ç–∞—Ç—É—Å:</span>
                        <span style="color: #ff3333; font-weight: bold;">–û–ë–ù–ê–†–£–ñ–ï–ù</span>
                    </div>
                </div>
                
                <div style="
                    color: #ffcc99;
                    font-size: 0.9rem;
                    margin: 20px 0;
                    padding: 15px;
                    background: rgba(255, 51, 0, 0.1);
                    border-radius: 8px;
                    border-left: 4px solid #ff3300;
                    font-family: 'Press Start 2P', monospace;
                ">
                    "–û–≥–Ω–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ –¥—Ä–∞–∫–æ–Ω–∞ –æ–ø–∞–ª–∏–ª–æ –≤–∞—à–∏ –ø–ª–∞–Ω—ã..."
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button id="retryBtn" style="
                        flex: 1;
                        padding: 15px;
                        background: linear-gradient(135deg, #ff3300, #cc0000);
                        border: 3px solid #ff9966;
                        color: white;
                        font-family: 'Press Start 2P', monospace;
                        font-size: 0.9rem;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    ">
                        üîÑ –ü–û–í–¢–û–†–ò–¢–¨
                    </button>
                    <button id="menuBtn" style="
                        flex: 1;
                        padding: 15px;
                        background: linear-gradient(135deg, #333333, #666666);
                        border: 3px solid #999999;
                        color: white;
                        font-family: 'Press Start 2P', monospace;
                        font-size: 0.9rem;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    ">
                        üè† –ú–ï–ù–Æ
                    </button>
                </div>
                
                <div style="
                    color: #ff9966;
                    font-size: 0.8rem;
                    margin-top: 15px;
                    padding-top: 10px;
                    border-top: 1px solid rgba(255, 102, 0, 0.3);
                    font-family: 'Press Start 2P', monospace;
                ">
                    –°–æ–≤–µ—Ç: –ë—É–¥—å—Ç–µ —Ç–∏—à–µ –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –¥—Ä–∞–∫–æ–Ω–∞
                </div>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        this.elements.gameScene.appendChild(defeatOverlay);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ this –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö
        const game = this;
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
        const restartGame = () => {
            game.playPixelSound('menu_click');
            
            // –£–¥–∞–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–π
            if (defeatOverlay.parentNode) {
                defeatOverlay.parentNode.removeChild(defeatOverlay);
            }
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –º–∏–Ω–∏-–∏–≥—Ä—É
            game.restartMinigame();
        };
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –º–µ–Ω—é
        const goToMenu = () => {
            game.playPixelSound('menu_click');
            
            // –£–¥–∞–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–π
            if (defeatOverlay.parentNode) {
                defeatOverlay.parentNode.removeChild(defeatOverlay);
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é
            game.state = 'menu';
            game.elements.gameScene.style.display = 'none';
            game.elements.titleScreen.style.display = 'flex';
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É
            game.createAmbientMusic();
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –î–û –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ DOM
        setTimeout(() => {
            const retryBtn = document.getElementById('retryBtn');
            const menuBtn = document.getElementById('menuBtn');
            
            if (retryBtn) {
                retryBtn.addEventListener('click', restartGame);
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                retryBtn.addEventListener('mouseenter', () => {
                    retryBtn.style.transform = 'translateY(-2px)';
                    retryBtn.style.boxShadow = '0 5px 15px rgba(255, 51, 0, 0.5)';
                    retryBtn.style.background = 'linear-gradient(135deg, #ff5500, #ff3300)';
                });
                retryBtn.addEventListener('mouseleave', () => {
                    retryBtn.style.transform = '';
                    retryBtn.style.boxShadow = '';
                    retryBtn.style.background = 'linear-gradient(135deg, #ff3300, #cc0000)';
                });
                retryBtn.addEventListener('mousedown', () => {
                    retryBtn.style.transform = 'translateY(1px)';
                });
                retryBtn.addEventListener('mouseup', () => {
                    retryBtn.style.transform = 'translateY(-2px)';
                });
            }
            
            if (menuBtn) {
                menuBtn.addEventListener('click', goToMenu);
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                menuBtn.addEventListener('mouseenter', () => {
                    menuBtn.style.transform = 'translateY(-2px)';
                    menuBtn.style.boxShadow = '0 5px 15px rgba(102, 102, 102, 0.5)';
                    menuBtn.style.background = 'linear-gradient(135deg, #444444, #666666)';
                });
                menuBtn.addEventListener('mouseleave', () => {
                    menuBtn.style.transform = '';
                    menuBtn.style.boxShadow = '';
                    menuBtn.style.background = 'linear-gradient(135deg, #333333, #666666)';
                });
                menuBtn.addEventListener('mousedown', () => {
                    menuBtn.style.transform = 'translateY(1px)';
                });
                menuBtn.addEventListener('mouseup', () => {
                    menuBtn.style.transform = 'translateY(-2px)';
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
            const keyHandler = (e) => {
                if (e.code === 'KeyR' || e.code === 'Digit1') {
                    e.preventDefault();
                    restartGame();
                    document.removeEventListener('keydown', keyHandler);
                } else if (e.code === 'KeyM' || e.code === 'Digit2' || e.code === 'Escape') {
                    e.preventDefault();
                    goToMenu();
                    document.removeEventListener('keydown', keyHandler);
                }
            };
            
            document.addEventListener('keydown', keyHandler);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
            defeatOverlay._keyHandler = keyHandler;
            
        }, 100);
        
    }, 1000);
}
    
    restartMinigame() {
    // –£–¥–∞–ª—è–µ–º –æ–∫–æ—à–∫–æ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
    const defeatOverlay = document.getElementById('defeatOverlay');
    if (defeatOverlay) {
        // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à
        if (defeatOverlay._keyHandler) {
            document.removeEventListener('keydown', defeatOverlay._keyHandler);
        }
        if (defeatOverlay.parentNode) {
            defeatOverlay.parentNode.removeChild(defeatOverlay);
        }
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    this.step = 0;
    this.alertness = 0;
    this.dragonState = 'sleeping';
    this.hasStone = false;
    this.stoneUsed = false;
    this.canAct = true;
    this.videoPlaying = false;
    this.justRestless = false;
    this.pauseMode = false;
    this.awakeCount = 0;
    this.firstVideoPlayed = false;
    this.stateHistory = ['sleeping'];
    
    if (this.awakeBlockTimer) {
        clearTimeout(this.awakeBlockTimer);
        this.awakeBlockTimer = null;
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
    Object.keys(this.events).forEach(key => {
        this.events[key].done = false;
    });
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º UI
    this.elements.stoneButton.style.display = 'none';
    this.elements.eventOverlay.style.display = 'none';
    this.elements.stoneResultOverlay.style.display = 'none';
    
    this.setYumiState('sitting');
    this.showHint('–¢–∏—Ö–æ... –ù–∞—á–∏–Ω–∞–µ–º –ø—É—Ç—å...');
    this.showVideo('sleeping');
    
    this.updateUI();
}
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    const game = new DragonStealthGame();
    window.game = game;
    
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    const images = [
        'img/Yumi sitting.svg',
        'img/Yumi pointing.svg',
        'img/Yumi panicking.svg',
        'img/Yumi whispering.svg'
    ];
    
    images.forEach(src => {
        const img = new Image();
        img.src = src;
    });
    
    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const unlockAudio = () => {
        if (game.musicEnabled && (!game.backgroundMusic || game.backgroundMusic.paused)) {
            game.createAmbientMusic();
        }
        document.removeEventListener('click', unlockAudio);
        document.removeEventListener('keydown', unlockAudio);
    };
    
    document.addEventListener('click', unlockAudio);
    document.addEventListener('keydown', unlockAudio);
});
</script>
</body>
</html>